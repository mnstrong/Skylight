<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#667eea">
    <title>Skylight</title>
    <script src="config.js"></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Jost:ital,wght@0,100..900;1,100..900&family=Noticia+Text:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Color+Emoji&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@twemoji/api@latest/dist/twemoji.min.js" crossorigin="anonymous"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: "Jost", "Noto Color Emoji", sans-serif;
        background: #ffffff;
        height: 100vh;
        overflow: hidden;
        font-size: 18px;
    }

    .jost-<uniquifier> {
    font-family: "Jost", sans-serif;
    font-optical-sizing: auto;
    font-weight: <weight>;
    font-style: normal;
    }

    .jost-<uniquifier> {
    font-family: "Jost", sans-serif;
    font-optical-sizing: auto;
    font-weight: <weight>;
    font-style: normal;
    }

    /* Navigation visibility controls */
    #todayNav,
    .today-nav {
        display: none !important;
    }

    #todayNav.active,
    .today-nav.active {
        display: flex !important;
    }

    #monthNav,
    .month-nav {
        display: none !important;
    }

    #monthNav.active,
    .month-nav.active {
        display: flex !important;
    }

    #weekNav,
    .week-nav {
        display: none !important;
    }

    #weekNav.active,
    .week-nav.active {
        display: flex !important;
    }

    .month-nav-btn {
        background: #E8EBF0;
        color: #5C6370;
        border: none;
        padding: 12px 18px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 17px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
        min-width: 40px;
    }

    .week-nav-btn, .month-display, .week-display {
        background: #E8EBF0;
        color: #5C6370;
        border: none;
        padding: 12px 18px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 17px;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s;
        min-width: 40px;
    }
    
    .month-display {
        padding-right: 30px;
    }

    .middle {
        min-width: 180px !important;
        margin: 0 8px;
    }

    .container {
        display: grid;
        grid-template-columns: 120px 1fr;
        grid-template-rows: 120px 1fr;
        height: 100vh;
        gap: 0px;
        padding: 0;
    }

    .nav-sidebar {
        grid-row: 1 / -1;
        background: #E8EBF0;
        border-radius: 0;
        padding: 15px 0px;
        display: flex;
        flex-direction: column;
    }
    
    .nav-sidebar > * {
        margin-bottom: 20px;
    }
    
    .nav-sidebar > *:last-child {
        margin-bottom: 0;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px 0px;
        border-radius: 0px;
        cursor: pointer;
        transition: all 0.3s;
        text-decoration: none;
        color: #5C6370;
        font-size: 14px;
        font-weight: 600;
        gap: 8px;
    }

    .nav-item:hover {
        background: #D5D9E0;
        transform: scale(1.05);
    }

    .nav-item.active {
        background: white;
        color: #667eea;
    }

    .nav-icon {
        font-size: 32px;
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    /* Icons using images - place your icon files in the same directory as index.html */
    .icon-calendar::before { 
        content: '';
        display: block;
        width: 32px;
        height: 32px;
        background-image: url('calendar-icon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .icon-tasks::before { 
        content: '';
        display: block;
        width: 32px;
        height: 32px;
        background-image: url('tasks-icon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .icon-rewards::before { 
        content: '';
        display: block;
        width: 32px;
        height: 32px;
        background-image: url('rewards-icon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .icon-meals::before { 
        content: '';
        display: block;
        width: 32px;
        height: 32px;
        background-image: url('meals-icon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .icon-photos::before { 
        content: '';
        display: block;
        width: 32px;
        height: 32px;
        background-image: url('photos-icon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }
    .icon-lists::before { 
        content: '';
        display: block;
        width: 32px;
        height: 32px;
        background-image: url('lists-icon.png');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
    }

    .header {
        grid-column: 2 / -1;
        background: white;
        border-radius: 0;
        padding: 25px 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 20px;
        font-family: "Noticia Text", serif;
        font-weight: 400;
        font-style: normal;
        }

    .header-right {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .date-time-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .date-weather-line {
        display: flex;
        align-items: baseline;
        font-size: 42px;
        font-weight: 400;
        color: #333;
    }
    
    .date-weather-line > * {
        margin-right: 45px;
    }
    
    .date-weather-line > *:last-child {
        margin-right: 0;
    }

    .time-line {
        font-size: 32px;
        font-weight: 400;
        color: #333;
    }

    .weather-inline {
        font-size: 32px;
        color: #666;
    }

    .person-avatars {
        display: flex;
        gap: 8px;
    }

    .person-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: white;
        font-size: 18px;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .person-avatar:hover {
        transform: scale(1.1);
    }

    .main-content {
        grid-column: 2 / -1;
        background: white;
        border-radius: 0;
        padding: 20px;
        overflow-y: auto;
    }

    .family-pills {
        display: flex;
        margin-bottom: 20px;
        flex-wrap: wrap;
        margin-left: -10px;
        margin-top: -10px;
    }
    
    .family-pills > * {
        margin-left: 10px;
        margin-top: 10px;
    }

    .family-pill {
        padding: 12px 20px;
        border-radius: 25px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
        min-width: 150px;
    }

    .family-pill:hover {
        transform: scale(1.05);
    }

    .family-pill-progress {
        position: absolute;
        left: 0;
        top: 0;
        height: 100%;
        transition: width 0.3s ease;
        opacity: 0.3;
    }

    .family-pill-content {
        display: flex;
        align-items: center;
        gap: 10px;
        position: relative;
        z-index: 1;
    }

    .family-pill-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
    }

    .family-pill-info {
        display: flex;
        flex-direction: column;
        align-items: flex-start;
    }

    .family-pill-name {
        font-size: 14px;
        line-height: 1;
    }

    .family-pill-tasks {
        font-size: 11px;
        opacity: 0.8;
        line-height: 1;
        margin-top: 2px;
    }

    .date-display {
        font-size: 28px;
        font-weight: 600;
        color: #667eea;
    }

    .time-display {
        font-size: 42px;
        font-weight: 700;
        color: #333;
    }

    .weather-display {
        text-align: right;
        font-size: 18px;
        color: #555;
    }

    .sidebar {
        background: white;
        border-radius: 15px;
        padding: 20px;
        overflow-y: auto;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: none;
    }

    .main-calendar {
        background: transparent;
        border-radius: 0;
        padding: 0;
        overflow-y: auto;
        box-shadow: none;
    }

    .right-panel {
        background: white;
        border-radius: 15px;
        padding: 20px;
        overflow-y: auto;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        display: none;
    }

    .section-title {
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 15px;
        color: #333;
        border-bottom: 2px solid #667eea;
        padding-bottom: 8px;
    }

    .family-members {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 20px;
    }

    .member {
        padding: 10px;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .member:hover {
        transform: translateX(5px);
    }

    .calendar-header {
        display: none;
    }

    .today-nav {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .today-nav-btn {
        background: #E8EBF0;
        color: #5C6370;
        border: none;
        padding: 12px 18px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 17px;
        font-weight: 600;
        transition: background 0.2s;
    }

    .today-nav-btn:hover {
        background: #D5D9E0;
    }

    .nav-btn {
        background: #E8EBF0;
        color: #5C6370;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
    }

    .nav-btn:hover {
        background: #D5D9E0;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }

    .week-view, .day-view {
        display: none;
    }

    .week-view.active, .day-view.active {
        display: block;
    }
    
    .simple-week-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 20px;
        padding: 20px;
    }
    
    .simple-week-day {
        background: white;
        border-radius: 15px;
        padding: 30px;
        min-height: 300px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        display: flex;
        flex-direction: column;
        cursor: pointer;
        transition: transform 0.2s;
    }
    
    .simple-week-day:hover {
        transform: translateY(-5px);
    }
    
    .simple-week-day-header {
        font-size: 28px;
        font-weight: 400;
        color: #000;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .simple-week-day-header .week-day-name {
        font-size: 18px;
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.8;
    }
    
    .simple-week-day-header .week-day-number {
        font-size: 32px;
        font-weight: 700;
    }
    
    .simple-week-day-header.today .week-day-number {
        background: #FF6B6B;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .simple-week-add-btn {
        color: #999;
        font-size: 16px;
        font-weight: 400;
        margin-top: auto;
    }
    
    .simple-week-next-week {
        background: #E8EBF0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 600;
        color: #5C6370;
    }
```

.week-view-grid {
display: grid;
grid-template-columns: 100px repeat(7, 1fr);
grid-template-rows:
auto        /* day headers */
auto        /* all-day events */
1fr;        /* timed events */
background: white;
border-radius: 12px;
overflow: hidden;
}

.week-view-grid-8col {
display: grid;
grid-template-columns: 100px repeat(7, 1fr) 200px;
background: white;
border-radius: 12px;
overflow: hidden;
}

.week-allday-gutter {
grid-row: 2;
}

.week-allday-container {
grid-row: 2;
}

.week-allday-container-8col {
grid-column: 2 / 10;
display: grid;
grid-template-columns: repeat(8, 1fr);
gap: 0;
padding: 10px 0;
background: #fafafa;
border-bottom: 2px solid #e0e0e0;
min-height: 40px;
}

.week-day-label-serif {
font-family: “Noticia Text”, serif;
font-size: 20px;
font-weight: 400;
color: #000;
text-align: left;
padding-left: 10px;
}

.week-day-header-cell.today .week-day-label-serif {
color: white;
}

.week-day-header-cell.next-week-header {
background: #f9f9f9;
padding: 15px 10px;
text-align: left;
display: flex;
flex-direction: column;
justify-content: flex-start;
align-items: flex-start;
}

.next-week-dates-small {
font-family: “Jost”, sans-serif;
font-size: 14px;
font-weight: 400;
color: #666;
margin-top: 5px;
padding-left: 10px;
}

.week-next-week-column {
grid-column: 9;
background: #fafafa;
border-left: 1px solid #e0e0e0;
}

```
    .week-time-gutter {
        grid-column: 1;
        grid-row: 1;
        background: #f9f9f9;
        border-right: 1px solid #e0e0e0;
    }
    
    .week-allday-gutter {
        grid-column: 1;
        background: #f9f9f9;
        border-right: 1px solid #e0e0e0;
        padding: 10px;
        font-size: 11px;
        color: #666;
        text-align: right;
        display: flex;
        align-items: center;
        justify-content: flex-end;
    }
    
    .week-allday-container {
        background: #fafafa;
        border-bottom: 2px solid #e0e0e0;
        min-height: 40px;
    }
    
    .week-allday-event {
        border-radius: 6px;
        padding: 6px 10px;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        min-height: 32px;
    }
    
    .week-allday-event:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        z-index: 10;
    }
    
    .week-allday-event .week-event-title {
        font-size: 12px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .week-allday-event .week-event-initial {
        width: 20px;
        height: 20px;
        font-size: 10px;
    }
    
    .week-day-header-cell {
        padding: 20px 10px;
        text-align: center;
        background: white;
        border-bottom: 2px solid #e0e0e0;
        border-right: 1px solid #e0e0e0;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
    }
    
    .week-day-header-cell.today {
        background: white;
    }
    
    .week-day-header-cell .week-day-name {
        font-size: 15px;
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.8;
    }
    
    .week-day-header-cell .week-day-number {
        font-size: 32px;
        font-weight: 700;
    }
    
    .week-day-header-cell > * {
        margin-right: 10px;
    }
    
    .week-day-header-cell > *:last-child {
        margin-right: 0;
    }
    
    .week-day-header-cell.today .week-day-number {
        background: #FF6B6B;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .week-time-labels {
        grid-column: 1;
        grid-row: 3;
        display: flex;
        flex-direction: column;
        background: white;
        border-right: 1px solid #e0e0e0;
    }
    
    .week-time-label {
        height: 60px;
        padding: 5px 10px;
        font-size: 14px;
        color: #666;
        text-align: right;
        border-bottom: 1px solid #e0e0e0;
        display: flex;
        align-items: flex-start;
        justify-content: flex-end;
    }
    
    .week-day-column-container {
        position: relative;
        min-height: 840px;
        border-right: 1px solid #e0e0e0;
        background: white;
        grid-row: 3;
    }
    
    .week-hour-line {
        height: 60px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .week-events-layer {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
    }
    
    .week-event-block {
        position: absolute;
        border-radius: 8px;
        padding: 8px 10px;
        cursor: pointer;
        pointer-events: auto;
        overflow: hidden;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        transition: transform 0.2s, box-shadow 0.2s;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    
    .week-event-block:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        z-index: 10;
    }
    
    .week-event-content {
        flex: 1;
        min-width: 0;
    }
    
    .week-event-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 3px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .week-event-time {
        font-size: 14px;
        color: #666;
        white-space: nowrap;
    }
    
    .week-event-initial {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
        margin-left: 8px;
    }
    
    .current-time-indicator {
        position: absolute;
        left: 0;
        right: 0;
        height: 2px;
        background: #FF6B6B;
        z-index: 100;
        pointer-events: none;
    }
    
    .current-time-indicator::before {
        content: '';
        position: absolute;
        left: -6px;
        top: -5px;
        width: 12px;
        height: 12px;
        background: #FF6B6B;
        border-radius: 50%;
    }

    .week-grid {
        display: grid;
        grid-template-columns: 80px repeat(7, 1fr);
        gap: 10px;
    }

    .time-slot {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
        color: #666;
        text-align: right;
    }

    .week-day-column {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 5px;
        min-height: 50px;
        position: relative;
    }

    .week-day-header {
        text-align: center;
        font-weight: 600;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 8px;
        margin-bottom: 5px;
    }

    .week-day-header.today {
        background: #667eea;
        color: white;
    }

    .event-block {
        background: #667eea;
        color: white;
        padding: 5px 8px;
        border-radius: 5px;
        margin: 2px 0;
        font-size: 12px;
        cursor: pointer;
        transition: transform 0.2s;
    }

    .event-block:hover {
        transform: scale(1.05);
    }

    .day-view-container {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 20px;
        height: 100%;
    }

    .day-view-mini-calendar {
        background: #f9f9f9;
        padding: 20px;
        border-radius: 12px;
    }

    .mini-cal-header {
        display: none;
    }

    .mini-cal-nav {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 18px;
        color: #667eea;
        padding: 5px;
    }

    .mini-cal-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 5px;
    }

    .mini-day-header {
        text-align: center;
        font-size: 11px;
        font-weight: 600;
        color: #666;
        padding: 5px 0;
    }

    .mini-day-cell {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        font-size: 13px;
        cursor: pointer;
        transition: background 0.2s;
    }

    .mini-day-cell:hover {
        background: #e0e0e0;
    }

    .mini-day-cell.today {
        background: #FF6B6B;
        color: white;
        font-weight: 600;
    }

    .mini-day-cell.selected {
        background: #FF6B6B;
        color: white;
        font-weight: 600;
    }

    .mini-day-cell.other-month {
        opacity: 0.3;
    }

    .mini-day-cell.has-events {
        position: relative;
    }

    .mini-day-cell.has-events::after {
        content: '';
        position: absolute;
        bottom: 2px;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 4px;
        background: #667eea;
        border-radius: 50%;
    }

    .mini-day-cell.selected.has-events::after,
    .mini-day-cell.today.has-events::after {
        background: white;
    }

    .week-days-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 10px;
    }
    
    .week-day-box {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.2s;
        min-height: 100px;
        display: flex;
        align-items: flex-start;
    }
    
    .week-day-box:hover {
        background: #f5f5f5;
        border-color: #667eea;
    }
    
    .week-day-box.selected {
        background: #667eea;
        border-color: #667eea;
    }
    
    .week-day-box.selected .week-day-label {
        color: white;
    }
    
    .week-day-box.today {
        border-color: #FF6B6B;
        border-width: 3px;
    }
    
    .week-day-label {
        font-family: "Noticia Text", serif;
        font-size: 18px;
        font-weight: 400;
        color: #000;
        text-align: left;
    }
    
    .next-week-box {
        cursor: default;
        background: #f9f9f9;
        border: 2px solid #e0e0e0;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
    }
    
    .next-week-box:hover {
        background: #f9f9f9;
        border-color: #e0e0e0;
    }
    
    .next-week-title {
        font-family: "Noticia Text", serif;
        font-size: 18px;
        font-weight: 400;
        color: #000;
        margin-bottom: 8px;
    }
    
    .next-week-dates {
        font-family: "Jost", sans-serif;
        font-size: 14px;
        font-weight: 400;
        color: #666;
    }

    .day-view-events-container {
        display: flex;
        flex-direction: column;
    }

    .day-view-header {
        padding: 20px 0;
        margin-bottom: 20px;
    }

    .day-view-date-large {
        font-size: 32px;
        font-weight: 700;
        color: #333;
    }

    .day-view-events {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .day-event-item {
        background: #f9f9f9;
        border-left: 4px solid #667eea;
        padding: 15px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .event-time-block {
        font-weight: 600;
        color: #667eea;
        min-width: 80px;
    }

    .event-details {
        flex: 1;
        margin-left: 15px;
    }

    .event-title-large {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .event-meta {
        color: #666;
        font-size: 14px;
    }

    .floating-add-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #4A90E2;
        color: white;
        border: none;
        font-size: 32px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s, box-shadow 0.2s;
        z-index: 100;
    }

    .floating-add-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(74, 144, 226, 0.6);
    }

    .floating-add-btn.active {
        display: flex;
    }
    
    .floating-add-task-btn {
        position: fixed;
        bottom: 30px;
        right: 30px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #4A90E2;
        color: white;
        border: none;
        font-size: 32px;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(74, 144, 226, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s, box-shadow 0.2s;
        z-index: 100;
    }
    
    .floating-add-task-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 16px rgba(74, 144, 226, 0.6);
    }
    
    .floating-add-task-btn.active {
        display: flex;
    }
    
    /* Task Modal Styling */
    .task-modal {
        max-width: 500px;
        padding: 0;
        border-radius: 20px;
        max-height: 90vh;
    }
    
    .task-modal-header {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px 25px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .task-modal-back {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        padding: 5px;
        color: #333;
    }
    
    .task-modal-header h2 {
        font-size: 24px;
        font-weight: 600;
        margin: 0;
    }
    
    .task-modal-body {
        padding: 25px;
        overflow-y: auto;
        max-height: calc(90vh - 100px);
    }
    
    .task-form-group {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 20px;
        padding-bottom: 20px;
        border-bottom: 1px solid #f0f0f0;
    }
    
    .task-form-icon {
        font-size: 20px;
        width: 30px;
        flex-shrink: 0;
        color: #666;
    }
    
    .task-form-label {
        flex: 1;
        font-size: 16px;
        color: #333;
    }
    
    .task-input {
        flex: 1;
        border: none;
        background: none;
        font-size: 16px;
        outline: none;
        color: #333;
    }
    
    .task-input::placeholder {
        color: #999;
    }
    
    .task-input-inline {
        border: none;
        background: none;
        font-size: 16px;
        outline: none;
        color: #333;
        text-align: right;
    }
    
    .task-input-small {
        width: 60px;
        border: none;
        background: none;
        font-size: 16px;
        outline: none;
        color: #333;
        text-align: center;
    }
    
    .task-dropdown-btn {
        background: none;
        border: none;
        font-size: 14px;
        color: #999;
        cursor: pointer;
        padding: 5px;
        transition: color 0.2s;
    }
    
    .task-dropdown-btn:hover {
        color: #667eea;
    }
    
    .emoji-picker-container {
        position: relative;
    }
    
    .emoji-picker-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        padding: 15px;
        margin-top: 5px;
        z-index: 1000;
        display: none;
        max-width: 320px;
    }
    
    .emoji-picker-dropdown.active {
        display: block;
    }
    
    .emoji-search-input {
        width: 100%;
        padding: 10px 15px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        margin-bottom: 10px;
        outline: none;
        transition: border-color 0.2s;
    }
    
    .emoji-search-input:focus {
        border-color: #667eea;
    }
    
    .emoji-search-input::placeholder {
        color: #999;
    }
    
    .emoji-picker-grid {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 8px;
        max-height: 250px;
        overflow-y: auto;
        scrollbar-width: thin;
        scrollbar-color: #CBD5E0 #F7FAFC;
    }
    
    .emoji-picker-grid::-webkit-scrollbar {
        width: 6px;
    }
    
    .emoji-picker-grid::-webkit-scrollbar-track {
        background: #F7FAFC;
        border-radius: 10px;
    }
    
    .emoji-picker-grid::-webkit-scrollbar-thumb {
        background: #CBD5E0;
        border-radius: 10px;
    }
    
    .emoji-picker-item {
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
    }
    
    .emoji-picker-item:hover {
        background: #f0f0f0;
        transform: scale(1.1);
    }
    
    .emoji-picker-item.hidden {
        display: none;
    }
    
    /* Twemoji image styling */
    img.emoji {
        height: 1em;
        width: 1em;
        margin: 0 0.05em 0 0.1em;
        vertical-align: -0.1em;
        display: inline-block;
    }
    
    .emoji-picker-item img.emoji {
        height: 24px;
        width: 24px;
        margin: 0;
        vertical-align: middle;
    }
    
    /* Reward card emoji sizing */
    .reward-emoji img.emoji {
        height: 48px;
        width: 48px;
    }
    
    /* Confetti Animation */
    @keyframes confetti-fall {
        0% {
            transform: translateY(-10vh) rotate(0deg);
            opacity: 1;
        }
        100% {
            transform: translateY(110vh) rotate(720deg);
            opacity: 0;
        }
    }
    
    .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        z-index: 99999;
        pointer-events: none;
        will-change: transform;
    }
    
    .confetti-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        pointer-events: none;
        z-index: 99999;
    }
    
    /* Rewards Page Styling */
    .rewards-container {
        display: flex;
        gap: 20px;
        padding: 20px 0;
        overflow-x: auto;
        scrollbar-width: thin;
        scrollbar-color: #CBD5E0 #F7FAFC;
    }
    
    .rewards-container::-webkit-scrollbar {
        height: 10px;
    }
    
    .rewards-container::-webkit-scrollbar-track {
        background: #F7FAFC;
        border-radius: 10px;
    }
    
    .rewards-container::-webkit-scrollbar-thumb {
        background: #CBD5E0;
        border-radius: 10px;
    }
    
    .rewards-person-column {
        min-width: 350px;
        max-width: 350px;
        flex-shrink: 0;
        border-radius: 15px;
        padding: 20px;
    }
    
    .rewards-person-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .rewards-person-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 700;
        color: white;
    }
    
    .rewards-person-info {
        flex: 1;
    }
    
    .rewards-person-name {
        font-size: 28px;
        font-weight: 600;
        color: #000;
        margin-bottom: 5px;
    }
    
    .rewards-person-total-stars {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 16px;
        color: #666;
    }
    
    .reward-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .reward-emoji {
        font-size: 48px;
        text-align: center;
        margin-bottom: 15px;
    }
    
    .reward-title {
        font-size: 20px;
        font-weight: 600;
        color: #000;
        text-align: center;
        margin-bottom: 15px;
    }
    
    .reward-progress-container {
        position: relative;
        margin-bottom: 10px;
    }
    
    .reward-progress-bar {
        width: 100%;
        height: 40px;
        background: rgba(0,0,0,0.1);
        border-radius: 20px;
        overflow: hidden;
        position: relative;
    }
    
    .reward-progress-fill {
        height: 100%;
        border-radius: 20px;
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding-right: 15px;
    }
    
    .reward-progress-text {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        font-size: 14px;
        font-weight: 600;
        color: #000;
        display: flex;
        align-items: center;
        gap: 5px;
        z-index: 1;
    }
    
    .reward-redeem-btn {
        width: 100%;
        padding: 12px;
        border-radius: 20px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        color: white;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .reward-redeem-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .reward-redeem-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    
    .reward-redeem-btn:disabled:hover {
        transform: none;
        box-shadow: none;
    }
    
    /* Task Detail Modal (centered popup) */
    .task-detail-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }
    
    .task-detail-modal.active {
        display: flex;
    }
    
    .task-detail-content {
        background: white;
        border-radius: 20px;
        padding: 40px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    .task-detail-title {
        font-size: 32px;
        font-weight: 600;
        text-align: center;
        margin-bottom: 30px;
        color: #000;
    }
    
    .task-detail-actions {
        display: flex;
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .task-detail-btn {
        flex: 1;
        padding: 15px;
        border-radius: 12px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        transition: transform 0.2s;
    }
    
    .task-detail-btn:hover {
        transform: translateY(-2px);
    }
    
    .task-detail-edit {
        background: #f0f0f0;
        color: #333;
    }
    
    .task-detail-delete {
        background: #f0f0f0;
        color: #dc3545;
    }
    
    .task-detail-info {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .task-detail-row {
        display: flex;
        align-items: center;
        gap: 15px;
        font-size: 16px;
        color: #333;
    }
    
    .task-detail-icon {
        font-size: 20px;
        width: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .task-detail-label {
        color: #666;
    }
    
    .task-detail-assigned {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .task-detail-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 14px;
    }
    
    .task-detail-complete-btn {
        width: 100%;
        padding: 18px;
        border-radius: 25px;
        border: none;
        font-size: 18px;
        font-weight: 600;
        color: white;
        cursor: pointer;
        margin-top: 20px;
        transition: transform 0.2s;
    }
    
    .task-detail-complete-btn:hover {
        transform: translateY(-2px);
    }
    
    /* Edit Side Panel */
    .edit-side-panel {
        position: fixed;
        top: 0;
        right: -600px;
        width: 500px;
        height: 100vh;
        background: white;
        box-shadow: -4px 0 20px rgba(0,0,0,0.15);
        z-index: 2001;
        transition: right 0.3s ease;
        overflow-y: auto;
        border-radius: 30px 0 0 30px;
    }
    
    .edit-side-panel.active {
        right: 0;
    }
    
    .edit-panel-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.3);
        z-index: 2000;
    }
    
    .edit-panel-overlay.active {
        display: block;
    }
    
    .edit-panel-header {
        display: flex;
        align-items: center;
        gap: 20px;
        padding: 30px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .edit-panel-back {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 20px;
        transition: background 0.2s;
    }
    
    .edit-panel-back:hover {
        background: #e0e0e0;
    }
    
    .edit-panel-title {
        font-size: 28px;
        font-weight: 600;
        color: #000;
    }
    
    .edit-panel-body {
        padding: 30px;
    }
    
    .edit-form-group {
        margin-bottom: 25px;
    }
    
    .edit-form-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
        display: block;
    }
    
    .edit-form-input {
        width: 100%;
        padding: 15px;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        font-size: 16px;
        outline: none;
        transition: border-color 0.2s;
    }
    
    .edit-form-input:focus {
        border-color: #4A90E2;
    }
    
    .edit-profile-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-top: 10px;
    }
    
    .edit-profile-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }
    
    .edit-profile-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        font-weight: 700;
        color: white;
        transition: all 0.2s;
        border: 3px solid transparent;
    }
    
    .edit-profile-item:hover .edit-profile-avatar {
        transform: scale(1.05);
    }
    
    .edit-profile-avatar.selected {
        box-shadow: 0 0 0 3px white;
    }
    
    .edit-profile-name {
        font-size: 12px;
        color: #666;
    }
    
    .edit-type-toggle {
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    .edit-type-btn {
        flex: 1;
        padding: 12px;
        border-radius: 20px;
        border: 2px solid #e0e0e0;
        background: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .edit-type-btn.active {
        background: #000;
        color: white;
        border-color: #000;
    }
    
    .edit-toggle-row {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px 0;
    }
    
    .edit-toggle-label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
        color: #333;
    }
    
    .edit-toggle-icon {
        font-size: 20px;
    }
    
    .edit-save-btn {
        width: 100%;
        padding: 18px;
        border-radius: 25px;
        border: none;
        font-size: 18px;
        font-weight: 600;
        color: white;
        background: #4A90E2;
        cursor: pointer;
        margin-top: 20px;
        transition: transform 0.2s;
    }
    
    .edit-save-btn:hover {
        transform: translateY(-2px);
    }
    
    .edit-delete-btn {
        width: 100%;
        padding: 15px;
        border-radius: 20px;
        border: none;
        font-size: 16px;
        font-weight: 600;
        color: #dc3545;
        background: #f0f0f0;
        cursor: pointer;
        margin-top: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    /* Rewards Page Styling */
    .rewards-container {
        display: flex;
        gap: 20px;
        padding: 20px 0;
        overflow-x: auto;
        scrollbar-width: thin;
        scrollbar-color: #CBD5E0 #F7FAFC;
    }
    
    .rewards-container::-webkit-scrollbar {
        height: 10px;
    }
    
    .rewards-container::-webkit-scrollbar-track {
        background: #F7FAFC;
        border-radius: 10px;
    }
    
    .rewards-container::-webkit-scrollbar-thumb {
        background: #CBD5E0;
        border-radius: 10px;
    }
    
    .rewards-person-column {
        min-width: 450px;
        max-width: 450px;
        min-height: 500px;
        flex-shrink: 0;
        border-radius: 15px;
        padding: 30px;
        margin-right: 20px;
    }
    
    .rewards-person-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .rewards-person-avatar {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        font-weight: 700;
        color: white;
    }
    
    .rewards-person-info {
        flex: 1;
    }
    
    .rewards-person-name {
        font-size: 28px;
        font-weight: 600;
        color: #000;
        margin-bottom: 5px;
    }
    
    .rewards-person-total-stars {
        font-size: 17px;
        color: #666;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .rewards-list {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .reward-card {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .reward-icon {
        font-size: 60px;
        text-align: center;
        margin-bottom: 15px;
    }
    
    .reward-title {
        font-size: 22px;
        font-weight: 600;
        color: #000;
        text-align: center;
        margin-bottom: 15px;
    }
    
    .reward-progress-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .reward-progress-bar {
        flex: 1;
        height: 28px;
        background: rgba(0,0,0,0.1);
        border-radius: 14px;
        overflow: hidden;
        position: relative;
    }
    
    .reward-progress-fill {
        height: 100%;
        border-radius: 14px;
        transition: width 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 14px;
        font-weight: 600;
    }
    
    .reward-stars-text {
        font-size: 17px;
        color: #666;
        white-space: nowrap;
        display: flex;
        align-items: center;
        gap: 3px;
    }
    
    .reward-redeem-btn {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 20px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        color: white;
    }
    
    .reward-redeem-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .reward-redeem-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }
    
    .task-profile-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        margin-bottom: 20px;
        padding: 0 20px;
    }
    
    .task-profile-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        cursor: pointer;
    }
    
    .task-profile-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        font-weight: 700;
        color: white;
        transition: transform 0.2s;
        border: 3px solid transparent;
        box-shadow: 0 0 0 3px transparent;
    }
    
    .task-profile-item:hover .task-profile-avatar {
        transform: scale(1.1);
    }
    
    .task-profile-avatar.selected {
        box-shadow: 0 0 0 3px white;
    }
    
    .task-profile-name {
        font-size: 12px;
        color: #666;
    }
    
    .task-profile-add {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: #999;
        cursor: pointer;
    }
    
    .task-type-toggle {
        display: flex;
        gap: 0;
        margin-bottom: 25px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .task-type-btn {
        flex: 1;
        padding: 12px 20px;
        background: white;
        border: none;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .task-type-btn.active {
        background: #000;
        color: white;
    }
    
    .task-toggle {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
    }
    
    .task-toggle input {
        opacity: 0;
        width: 0;
        height: 0;
    }
    
    .task-toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.3s;
        border-radius: 28px;
    }
    
    .task-toggle-slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
    }
    
    .task-toggle input:checked + .task-toggle-slider {
        background-color: #4A90E2;
    }
    
    .task-toggle input:checked + .task-toggle-slider:before {
        transform: translateX(22px);
    }
    
    .task-select {
        padding: 8px 12px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        font-size: 16px;
        outline: none;
        background: white;
    }
    
    .task-nav-btn {
        background: #f0f0f0;
        border: none;
        padding: 8px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
    }
    
    .task-submit-btn {
        width: 100%;
        padding: 15px;
        background: #A8D5E2;
        border: none;
        border-radius: 12px;
        font-size: 18px;
        font-weight: 600;
        color: white;
        cursor: pointer;
        margin-top: 20px;
    }
    
    .task-submit-btn:hover {
        background: #92C7D6;
    }

    .day-header {
        text-align: left;
        font-family: Georgia, 'Times New Roman', Times, serif;
        font-weight: 400;
        padding: 12px;
        padding-left: 15px;
        color: #000;
        font-size: 18px;
    }

    .day-cell {
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        padding: 8px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        height: 145px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    .day-cell:hover {
        background: #f5f5f5;
    }

    .day-cell.today .day-number {
        background: #FF6B6B;
        color: white;
        width: 38px;
        height: 38px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .day-cell.other-month {
        opacity: 0.3;
    }

    .day-number {
        font-weight: 600;
        margin-bottom: 4px;
        align-self: flex-end;
        font-size: 20px;
    }

    .day-events {
        display: flex;
        flex-direction: column;
        gap: 3px;
        margin-top: 5px;
        overflow: hidden;
        flex: 1;
    }

    .day-event-item {
        font-size: 13px;
        padding: 4px 6px;
        line-height: 1.3;
        word-wrap: break-word;
        overflow-wrap: break-word;
        border-radius: 4px;
        margin-bottom: 2px;
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .day-event-time {
        font-weight: 600;
        font-size: 12px;
        white-space: nowrap;
    }
    
    .day-event-title {
        flex: 1;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    .event-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        display: inline-block;
        margin: 2px;
        display: none;
    }

    .task-list {
        list-style: none;
    }

    .task-item {
        display: flex;
        align-items: center;
        padding: 10px;
        margin-bottom: 8px;
        background: #f9f9f9;
        border-radius: 8px;
        gap: 10px;
    }

    .task-item input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .task-item.completed {
        text-decoration: line-through;
        opacity: 0.6;
    }

    .add-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        width: 100%;
        margin-top: 10px;
        font-size: 16px;
    }

    .add-btn:hover {
        background: #5568d3;
    }

    .google-sync-btn {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin-bottom: 20px;
        display: none;
        align-items: center;
        gap: 8px;
    }

    .google-sync-btn:hover {
        background: #f5f5f5;
    }

    .google-sync-btn.connected {
        background: #4CAF50;
        color: white;
        border-color: #4CAF50;
    }

    .meal-plan {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .meal-day {
        background: #f9f9f9;
        padding: 12px;
        border-radius: 8px;
        border-left: 4px solid #667eea;
    }

    .meal-day-name {
        font-weight: 600;
        color: #667eea;
        margin-bottom: 5px;
    }

    input, textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-bottom: 10px;
        font-family: inherit;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
    }

    .close-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        cursor: pointer;
        margin-top: 10px;
    }

    .tabs {
        display: none;
        gap: 10px;
        margin-bottom: 20px;
    }

    .tab {
        padding: 12px 18px;
        background: #E8EBF0;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 17px;
        font-weight: 600;
    }

    .tab.active {
        background: #667eea;
        color: white;
    }

    /* View selector dropdown styling */
    .view-selector,
    select.view-selector,
    #mainViewSelector {
        padding: 12px 18px !important;
        border: none !important;
        border-radius: 20px !important;
        background-color: #E8EBF0 !important;
        font-size: 17px !important;
        cursor: pointer !important;
        font-family: "Jost", sans-serif;
        font-weight: 600 !important;
        color: #5C6370 !important;
    }

    .schedule-view {
        display: none;
    }

    .schedule-view.active {
        display: block;
    }

    .schedule-container {
        display: flex;
        gap: 20px;
        overflow-x: auto;
        padding: 20px 0;
        scrollbar-width: thin;
        scrollbar-color: #CBD5E0 #F7FAFC;
    }
    
    .schedule-container::-webkit-scrollbar {
        height: 10px;
    }
    
    .schedule-container::-webkit-scrollbar-track {
        background: #F7FAFC;
        border-radius: 10px;
    }
    
    .schedule-container::-webkit-scrollbar-thumb {
        background: #CBD5E0;
        border-radius: 10px;
    }
    
    .schedule-container::-webkit-scrollbar-thumb:hover {
        background: #A0AEC0;
    }

    .schedule-day-column {
        background: transparent;
        border-radius: 0;
        padding: 15px;
        min-height: 600px;
        min-width: 400px;
        max-width: 400px;
        flex-shrink: 0;
    }

    .schedule-day-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .schedule-add-btn {
        background: none;
        border: none;
        color: #000;
        font-family: "Jost", sans-serif;
        font-size: 14px;
        font-weight: 400;
        cursor: pointer;
        padding: 5px 10px;
        transition: opacity 0.2s;
    }
    
    .schedule-add-btn:hover {
        opacity: 0.7;
    }

    .schedule-day-title {
        font-size: 18px;
        font-weight: 400;
        color: #000;
        text-align: left;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .schedule-day-title .week-day-name {
        font-size: 15px;
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.8;
    }
    
    .schedule-day-title .week-day-number {
        font-size: 32px;
        font-weight: 700;
    }
    
    .schedule-day-title.today .week-day-number {
        background: #FF6B6B;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .schedule-next-week-box {
        background: transparent;
        border: none;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: flex-start;
    }
    
    .schedule-next-week-title {
        font-family: "Noticia Text", serif;
        font-size: 18px;
        font-weight: 400;
        color: #000;
        padding-bottom: 0;
        border-bottom: none;
        margin-bottom: 15px;
        width: 100%;
    }
    
    .schedule-next-week-dates {
        font-family: "Jost", sans-serif;
        font-size: 14px;
        font-weight: 400;
        color: #666;
    }

    .schedule-event-list {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }
    
    /* Day View Styles */
    .day-view-container {
        max-width: 800px;
        margin: 0 auto;
        padding: 40px 20px;
    }
    
    .day-view-header {
        margin-bottom: 40px;
        display: flex;
        align-items: center;
        gap: 20px;
    }
    
    .day-view-title {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .day-view-title .week-day-name {
        font-size: 24px;
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.8;
    }
    
    .day-view-title .week-day-number {
        font-size: 48px;
        font-weight: 700;
    }
    
    .day-view-title.today .week-day-number {
        background: #FF6B6B;
        color: white;
        width: 70px;
        height: 70px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .day-view-month {
        font-size: 20px;
        font-weight: 400;
        color: #666;
    }
    
    .day-view-events {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }
    
    .day-view-event {
        background: white;
        padding: 24px;
        border-radius: 12px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: transform 0.2s;
        display: flex;
        flex-direction: column;
        position: relative;
    }
    
    .day-view-event:hover {
        transform: translateY(-3px);
    }
    
    .day-view-event-time {
        font-size: 16px;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 10px;
    }
    
    .day-view-event-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .day-view-event-member {
        font-size: 16px;
        color: #666;
    }
    
    .day-view-event-dot {
        position: absolute;
        top: 24px;
        right: 24px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 700;
        color: white;
    }

    .schedule-event {
        background: white;
        padding: 18px;
        border-radius: 12px;
        border-left: 4px solid #667eea;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        transition: transform 0.2s;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .schedule-event:hover {
        transform: translateX(5px);
    }
    
    .schedule-event-content {
        flex: 1;
    }

    .schedule-event-time {
        font-size: 14px;
        font-weight: 600;
        color: #667eea;
        margin-bottom: 8px;
    }

    .schedule-event-title {
        font-size: 17px;
        font-weight: 600;
        margin-bottom: 5px;
    }

    .schedule-event-member {
        font-size: 15px;
        color: #666;
    }
    
    .schedule-event-dot {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
        margin-left: 10px;
    }
    
    .day-event-dot {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
        margin-left: 15px;
    }
    
    /* Chores View Styling */
    .chores-container {
        display: flex;
        padding: 20px 0;
        overflow-x: auto;
        scrollbar-width: thin;
        scrollbar-color: #CBD5E0 #F7FAFC;
    }
    
    .chores-container > * {
        margin-right: 20px;
    }
    
    .chores-container > *:last-child {
        margin-right: 0;
    }

    .chores-container::-webkit-scrollbar {
        height: 10px;
    }

    .chores-container::-webkit-scrollbar-track {
        background: #F7FAFC;
        border-radius: 10px;
    }

    .chores-container::-webkit-scrollbar-thumb {
        background: #CBD5E0;
        border-radius: 10px;
    }

    .chores-container::-webkit-scrollbar-thumb:hover {
        background: #A0AEC0;
    }
    
    .chore-person-card {
        border-radius: 15px;
        padding: 30px;
        min-height: 500px;
        min-width: 450px;
        max-width: 450px;
        flex-shrink: 0;
        margin-right: 20px;
    }
    
    .chore-person-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .chore-person-avatar {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        font-weight: 700;
        color: white;
    }
    
    .chore-person-info {
        flex: 1;
    }
    
    .chore-person-name {
        font-size: 28px;
        font-weight: 600;
        color: #000;
        margin-bottom: 5px;
    }
    
    .chore-person-stats {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
    }
    
    .chore-person-progress-text {
        font-size: 17px;
        color: #666;
    }
    
    .chore-person-stars {
        font-size: 17px;
        color: #666;
    }
    
    .chore-progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        overflow: hidden;
    }
    
    .chore-progress-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.3s ease;
    }
    
    .chore-categories {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .chore-category {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .chore-category-header {
        font-size: 22px;
        font-weight: 600;
        color: #000;
        margin-bottom: 5px;
    }
    
    .chore-category-tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }
    
    .chore-category-tab {
        padding: 8px 16px;
        border-radius: 20px;
        border: 1px solid #ddd;
        background: white;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .chore-category-tab.active {
        background: #000;
        color: white;
        border-color: #000;
    }
    
    .chore-items {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .chore-item {
        border-radius: 15px;
        padding: 18px;
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 10px;
    }
    
    .chore-item.completed {
        order: 1;
    }
    
    .chore-item:not(.completed) {
        order: 0;
    }
    
    .chore-item:hover {
        transform: translateX(3px);
    }
    
    .chore-item.completed .chore-item-title {
        opacity: 0.9;
    }
    
    .chore-item-icon {
        font-size: 30px;
        flex-shrink: 0;
    }
    
    .chore-item-content {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .chore-item-title {
        font-size: 18px;
        font-weight: 500;
        color: #000;
        margin-bottom: 2px;
    }
    
    .chore-item-subtitle {
        font-size: 16px;
        color: #666;
    }
    
    .chore-item-subtitle.late {
        color: #FF6B6B;
        font-weight: 600;
    }
    
    .chore-item-stars {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 16px;
        color: #666;
        margin-top: 4px;
    }
    
    .chore-item-checkbox {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.2s;
        font-size: 22px;
        font-weight: 700;
    }
    
    .chore-item-checkbox.checked {
        color: white;
    }
    
    .chore-item-checkbox svg {
        width: 16px;
        height: 16px;
    }
    
    .chore-add-btn {
        background: rgba(255, 255, 255, 0.5);
        border-radius: 12px;
        padding: 15px 18px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
        border: 2px dashed #ddd;
        margin-top: 10px;
        font-size: 17px;
        font-weight: 500;
        color: #666;
    }
    
    .chore-add-btn:hover {
        background: rgba(255, 255, 255, 0.8);
        border-color: #999;
        color: #000;
    }
    
    /* Routine Indicators */
    .routine-indicators {
        display: flex;
        gap: 10px;
        margin: 20px 0;
        justify-content: center;
    }
    
    .routine-indicator {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        padding: 10px;
        border-radius: 50%;
        width: 70px;
        height: 70px;
        background: rgba(255, 255, 255, 0.3);
        cursor: default;
        transition: all 0.2s;
    }
    
    .routine-indicator.has-routine {
        cursor: pointer;
    }
    
    .routine-indicator.has-routine:hover {
        background: rgba(255, 255, 255, 0.5);
        transform: scale(1.05);
    }
    
    .routine-indicator.active {
        background: rgba(255, 255, 255, 0.6);
    }
    
    .routine-indicator-icon {
        font-size: 24px;
    }
    
    .routine-indicator-label {
        font-size: 9px;
        font-weight: 600;
        text-align: center;
        color: #666;
    }
    
    /* Routine Section */
    .routine-section {
        margin-bottom: 20px;
    }
    
    .routine-section-title {
        font-size: 20px;
        font-weight: 600;
        color: #000;
        margin-bottom: 15px;
    }
    
    .routine-tasks {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    .routine-task {
        border-radius: 15px;
        padding: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .routine-task:hover {
        transform: translateX(3px);
    }
    
    .routine-task-icon {
        font-size: 48px;
        flex-shrink: 0;
        line-height: 1;
    }
    
    .routine-task-content {
        flex: 1;
    }
    
    .routine-task-title {
        font-size: 16px;
        font-weight: 500;
        color: #000;
        margin-bottom: 5px;
    }
    
    .routine-task-stars {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 13px;
        color: #666;
    }
    
    /* Meal Planning Styles */
    .meal-plan-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
    }
    
    .meal-plan-nav {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .meal-category-dropdown {
        padding: 10px 20px;
        border: 2px solid #e0e0e0;
        border-radius: 25px;
        font-size: 16px;
        background: white;
        cursor: pointer;
        outline: none;
    }
    
    .meal-grid-container {
        display: grid;
        grid-template-columns: 100px repeat(7, 1fr);
        gap: 0;
    }
    
    .meal-row-label {
        padding: 20px 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 14px;
        writing-mode: vertical-rl;
        text-orientation: mixed;
        background: white;
    }
    
    .meal-day-header {
        text-align: center;
        padding: 15px 10px;
        font-size: 16px;
        color: #000;
        font-weight: 400;
        background: white;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: center;
    }
    
    .meal-day-header .week-day-name {
        font-size: 15px;
        font-weight: 600;
        text-transform: uppercase;
        opacity: 0.8;
        margin-right: 10px;
    }
    
    .meal-day-header .week-day-number {
        font-size: 32px;
        font-weight: 700;
    }
    
    .meal-day-header.today .week-day-number {
        background: #FF6B6B;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .meal-cell {
        min-height: 160px;
        padding: 8px;
        background: white;
        display: flex;
        flex-direction: column;
        gap: 6px;
        aspect-ratio: 1 / 1;
    }
    
    .meal-box {
        background: #FFB3B3;
        border-radius: 12px;
        padding: 12px;
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
        text-align: center;
        font-size: 14px;
        color: #000;
        position: relative;
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 60px;
    }
    
    .meal-box:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .meal-box.empty-box {
        background: rgba(255, 179, 179, 0.15);
        cursor: pointer;
        border: 3px solid transparent;
        transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
    }
    
    .meal-box.empty-box.selected {
        border-color: rgba(255, 179, 179, 1);
    }
    
    .meal-box.empty-box.lunch {
        background: rgba(179, 229, 217, 0.15);
    }
    
    .meal-box.empty-box.lunch.selected {
        border-color: rgba(179, 229, 217, 1);
    }
    
    .meal-box.empty-box.dinner {
        background: rgba(255, 217, 163, 0.15);
    }
    
    .meal-box.empty-box.dinner.selected {
        border-color: rgba(255, 217, 163, 1);
    }
    
    .meal-box.empty-box.snack {
        background: rgba(229, 212, 179, 0.15);
    }
    
    .meal-box.empty-box:hover {
        transform: none;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .recipe-list-item {
        padding: 15px 20px;
        border-bottom: 1px solid #e0e0e0;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: space-between;
        transition: background 0.2s;
    }
    
    .recipe-list-item:hover {
        background: #f8f8f8;
    }
    
    .add-recipe-btn {
        padding: 15px 20px;
        border-bottom: 1px solid #e0e0e0;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 16px;
        color: #4A90E2;
    }
    
    .add-recipe-btn:hover {
        background: #f8f8f8;
    }
    
    .meal-detail-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        align-items: center;
        justify-content: center;
        z-index: 2000;
    }
    
    .meal-detail-modal.active {
        display: flex;
    }
    
    .meal-detail-content {
        background: white;
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
        box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    }
    
    .meal-detail-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e0e0e0;
    }
    
    .meal-detail-title {
        font-size: 24px;
        font-weight: 600;
        color: #000;
    }
    
    .meal-detail-actions {
        display: flex;
        gap: 10px;
    }
    
    .meal-detail-btn {
        padding: 8px 16px;
        border-radius: 8px;
        border: none;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .meal-detail-edit {
        background: #4A90E2;
        color: white;
    }
    
    .meal-detail-delete {
        background: #f0f0f0;
        color: #dc3545;
    }
    
    .meal-detail-info {
        margin-bottom: 20px;
    }
    
    .meal-detail-info-row {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 0;
        color: #666;
    }
    
    .meal-detail-section {
        margin-top: 20px;
    }
    
    .meal-detail-section-title {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
        color: #000;
    }
    
    .meal-detail-text {
        line-height: 1.6;
        color: #333;
        white-space: pre-line;
    }
    
    /* Lists Styles */
    .chores-columns {
        display: flex;
        gap: 20px;
        padding: 20px 0;
        overflow-x: auto;
        scrollbar-width: thin;
        scrollbar-color: #CBD5E0 #F7FAFC;
    }
    
    .chores-columns::-webkit-scrollbar {
        height: 10px;
    }
    
    .chores-columns::-webkit-scrollbar-track {
        background: #F7FAFC;
        border-radius: 10px;
    }
    
    .chores-columns::-webkit-scrollbar-thumb {
        background: #CBD5E0;
        border-radius: 10px;
    }
    
    .chores-columns::-webkit-scrollbar-thumb:hover {
        background: #A0AEC0;
    }
    
    .chore-column {
        border-radius: 15px;
        padding: 30px;
        min-height: 500px;
        min-width: 450px;
        max-width: 450px;
        flex-shrink: 0;
        margin-right: 20px;
    }
    
    .column-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        background: transparent;
    }
    
    .column-header-avatar {
        width: 65px;
        height: 65px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 26px;
        font-weight: 700;
        color: white;
    }
    
    .column-emoji {
        font-size: 30px;
    }
    
    .column-name {
        flex: 1;
        font-size: 28px;
        font-weight: 600;
        color: #000;
    }
    
    .list-card {
        background: transparent;
        border-radius: 15px;
        padding: 20px;
        box-shadow: none;
        margin-bottom: 15px;
    }
    
    .list-card-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 10px;
    }
    
    .list-card-title {
        font-family: "Jost", sans-serif;
        font-size: 22px;
        font-weight: 600;
        color: #000;
    }
    
    .list-card-initial {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
    }
    
    .list-card-count {
        background: rgba(255, 255, 255, 0.5);
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 16px;
        color: #666;
    }
    
    .list-items {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .list-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 18px;
        border-radius: 15px;
        transition: all 0.2s;
        cursor: pointer;
        margin-bottom: 10px;
    }
    
    .list-item:hover {
        transform: translateX(3px);
    }
    
    .list-item-checkbox {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid rgba(255, 255, 255, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        background: rgba(255, 255, 255, 0.3);
        cursor: pointer;
        transition: all 0.2s;
        font-size: 22px;
        font-weight: 700;
        order: 2;
    }
    
    .list-item-checkbox.checked {
        color: white;
    }
    
    .list-item-checkbox.checked::after {
        content: '✓';
        color: white;
    }
    
    .list-item-text {
        flex: 1;
        font-size: 18px;
        font-weight: 500;
        color: #000;
        order: 1;
    }
    
    .list-item-text.completed {
        opacity: 0.9;
    }
    
    .add-item-input {
        width: 100%;
        padding: 15px 18px;
        border: 2px dashed rgba(255, 255, 255, 0.5);
        border-radius: 12px;
        font-size: 16px;
        margin-top: 10px;
        background: rgba(255, 255, 255, 0.5);
        color: #000;
        font-weight: 500;
        transition: all 0.2s;
    }
    
    .add-item-input:focus {
        outline: none;
        border-color: rgba(255, 255, 255, 0.8);
        background: rgba(255, 255, 255, 0.8);
    }
    
    .add-item-input::placeholder {
        color: #666;
    }
    
    .list-add-section-btn {
        width: 100%;
        padding: 15px 18px;
        border-radius: 12px;
        font-size: 16px;
        margin-top: 10px;
        background: transparent;
        color: #666;
        font-weight: 400;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        transition: all 0.2s;
        border: none;
    }
    
    .list-add-section-btn:hover {
        opacity: 0.7;
    }
    
    .list-section {
        margin-bottom: 15px;
    }
    
    .list-section-header {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 15px;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
    }
    
    .list-section-header:hover {
        background: rgba(0, 0, 0, 0.05);
    }
    
    .list-section-title {
        font-size: 16px;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .list-section-count {
        background: rgba(0, 0, 0, 0.15);
        color: #666;
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 15px;
        font-weight: 600;
    }
    
    .list-section-arrow {
        margin-left: auto;
        font-size: 14px;
        transition: transform 0.2s;
    }
    
    .list-section-header.collapsed .list-section-arrow {
        transform: rotate(180deg);
    }
    
    .list-section-items {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 8px;
    }
    
    .list-section-items.collapsed {
        display: none;
    }
    
    /* Calendar Filter Button */
    .calendar-filter-btn {
        padding: 12px 18px;
        border: none;
        border-radius: 20px;
        background-color: #E8EBF0;
        font-size: 17px;
        cursor: pointer;
        font-family: "Jost", sans-serif;
        font-weight: 600;
        color: #5C6370;
        display: flex;
        align-items: center;
        gap: 6px;
        margin-left: 15px;
        transition: background-color 0.2s;
        position: relative;
    }
    
    .calendar-filter-btn:hover {
        background-color: #d9dde5;
    }
    
    .calendar-filter-btn.active {
        background-color: #4A90E2;
        color: white;
    }
    
    .calendar-filter-icon {
        font-size: 14px;
        line-height: 1;
    }
    
    .calendar-filter-dropdown {
        display: none;
        position: absolute;
        top: 100%;
        right: 0;
        margin-top: 8px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.15);
        padding: 20px;
        min-width: 300px;
        z-index: 1000;
    }
    
    .calendar-filter-dropdown.active {
        display: block;
    }
    
    .calendar-filter-header {
        font-size: 16px;
        font-weight: 600;
        color: #000;
        margin-bottom: 15px;
    }
    
    .calendar-filter-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    
    .calendar-filter-item:hover {
        background: #f5f5f5;
    }
    
    .calendar-filter-avatar {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: 700;
        color: white;
        flex-shrink: 0;
    }
    
    .calendar-filter-info {
        flex: 1;
    }
    
    .calendar-filter-name {
        font-size: 15px;
        font-weight: 500;
        color: #000;
    }
    
    .calendar-filter-edit-btn {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        padding: 4px 8px;
        opacity: 0.6;
        transition: opacity 0.2s;
        flex-shrink: 0;
    }
    
    .calendar-filter-edit-btn:hover {
        opacity: 1;
    }
    
    /* Edit Profile Color Picker */
    .color-picker-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    
    .color-picker-scroll {
        flex: 1;
        overflow-x: auto;
        overflow-y: hidden;
        scroll-behavior: smooth;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    
    .color-picker-scroll::-webkit-scrollbar {
        display: none;
    }
    
    .color-picker-grid {
        display: flex;
        gap: 12px;
        padding: 8px 0;
    }
    
    .color-picker-item {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        cursor: pointer;
        flex-shrink: 0;
        border: 3px solid transparent;
        transition: all 0.2s;
        position: relative;
    }
    
    .color-picker-item:hover {
        transform: scale(1.1);
    }
    
    .color-picker-item.selected {
        border-color: #000;
    }
    
    .color-picker-item.selected::after {
        content: '✓';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-size: 20px;
        font-weight: bold;
        text-shadow: 0 0 3px rgba(0,0,0,0.3);
    }
    
    .color-picker-nav {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border: 2px solid #ddd;
        background: white;
        cursor: pointer;
        font-size: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
        transition: all 0.2s;
    }
    
    .color-picker-nav:hover {
        background: #f5f5f5;
        border-color: #bbb;
    }
    
    .calendar-filter-toggle {
        width: 44px;
        height: 24px;
        background: #ddd;
        border-radius: 12px;
        position: relative;
        transition: background 0.3s;
        flex-shrink: 0;
    }
    
    .calendar-filter-toggle.active {
        background: #4A90E2;
    }
    
    .calendar-filter-toggle::after {
        content: '';
        position: absolute;
        width: 20px;
        height: 20px;
        background: white;
        border-radius: 50%;
        top: 2px;
        left: 2px;
        transition: left 0.3s;
    }
    
    .calendar-filter-toggle.active::after {
        left: 22px;
    }
    
    /* Reward Redemption Modal */
    .reward-redemption-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 99999;
        align-items: center;
        justify-content: center;
    }
    
    .reward-redemption-modal.active {
        display: flex;
    }
    
    .reward-redemption-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, rgba(255, 223, 128, 0.4) 0%, rgba(255, 223, 128, 0.2) 30%, rgba(255, 255, 255, 0) 60%);
        animation: gradient-grow-glow 1.2s ease-out forwards;
    }
    
    @keyframes gradient-grow-glow {
        0% {
            transform: scale(0);
            opacity: 0;
        }
        50% {
            opacity: 1;
        }
        100% {
            transform: scale(1.5);
            opacity: 0.8;
        }
    }
    
    .reward-redemption-content {
        position: relative;
        background: white;
        border-radius: 30px;
        padding: 50px 40px;
        max-width: 450px;
        width: 90%;
        box-shadow: 0 20px 60px rgba(0,0,0,0.2), 0 0 100px rgba(255, 223, 128, 0.6);
        text-align: center;
        z-index: 2;
        animation: modal-pop 0.5s ease-out 0.2s both;
    }
    
    @keyframes modal-pop {
        0% {
            transform: scale(0.8);
            opacity: 0;
        }
        50% {
            transform: scale(1.05);
        }
        100% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    .reward-redemption-emoji {
        font-size: 80px;
        margin-bottom: 20px;
        animation: emoji-bounce 0.6s ease-out 0.4s both;
    }
    
    @keyframes emoji-bounce {
        0% {
            transform: translateY(-30px) scale(0);
            opacity: 0;
        }
        50% {
            transform: translateY(10px) scale(1.1);
        }
        100% {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
    }
    
    .reward-redemption-title {
        font-size: 28px;
        font-weight: 600;
        color: #000;
        margin-bottom: 10px;
    }
    
    .reward-redemption-subtitle {
        font-size: 16px;
        color: #666;
        margin-bottom: 30px;
    }
    
    .reward-redemption-done-btn {
        background: #4A90E2;
        color: white;
        border: none;
        padding: 15px 40px;
        border-radius: 25px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s;
        width: 100%;
    }
    
    .reward-redemption-done-btn:hover {
        transform: translateY(-2px);
    }
    
    .reward-redemption-unredeem {
        margin-top: 15px;
        color: #999;
        font-size: 14px;
        cursor: pointer;
        text-decoration: underline;
    }
    
    .reward-redemption-unredeem:hover {
        color: #666;
    }
    
    /* Star confetti animation */
    .star-confetti {
        position: fixed;
        font-size: 80px;
        z-index: 99998;
        pointer-events: none;
        will-change: transform;
        opacity: 1;
    }
    
    @keyframes star-explode {
        0% {
            transform: translate(0, 0) rotate(0deg) scale(0);
            opacity: 1;
        }
        20% {
            opacity: 1;
        }
        100% {
            transform: translate(var(--tx), var(--ty)) rotate(720deg) scale(0.8);
            opacity: 0;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <div class="nav-sidebar">
            <div class="nav-item active" onclick="switchSection('calendar')">
                <div class="nav-icon icon-calendar"></div>
                <div>Calendar</div>
            </div>
            <div class="nav-item" onclick="switchSection('chores')">
                <div class="nav-icon icon-tasks"></div>
                <div>Chores</div>
            </div>
            <div class="nav-item" onclick="switchSection('rewards')">
                <div class="nav-icon icon-rewards"></div>
                <div>Rewards</div>
            </div>
            <div class="nav-item" onclick="switchSection('meals')">
                <div class="nav-icon icon-meals"></div>
                <div>Meals</div>
            </div>
            <div class="nav-item" onclick="switchSection('photos')">
                <div class="nav-icon icon-photos"></div>
                <div>Photos</div>
            </div>
            <div class="nav-item" onclick="switchSection('lists')">
                <div class="nav-icon icon-lists"></div>
                <div>Lists</div>
            </div>
        </div>

```
    <div class="header">
        <div class="header-left">
            <div class="date-time-group">
                <div class="date-weather-line">
                    <span id="dateDisplay"></span>
                    <span class="time-line" id="timeDisplay"></span>
                    <span class="weather-inline" id="weatherDisplay">Loading...</span>                    </div>
                </div>
        </div>
        <div class="header-right">
            <select class="view-selector" id="mainViewSelector" onchange="switchViewFromDropdown(this.value)">
                <option value="month">Month</option>
                <option value="week">Week</option>
                <option value="schedule">Schedule</option>
                <option value="day">Day</option>
            </select>
            <div class="calendar-filter-btn" id="calendarFilterBtn" onclick="toggleCalendarFilter()">
                <span class="calendar-filter-icon">🔍</span>
                <span>Filter</span>
                <div class="calendar-filter-dropdown" id="calendarFilterDropdown" onclick="event.stopPropagation()">
                    <div class="calendar-filter-header">Filter Calendar</div>
                    <div id="calendarFilterList">
                        <!-- Filter items will be populated here -->
                    </div>
                </div>
            </div>
            <div class="today-nav" id="todayNav">
                <button class="today-nav-btn" onclick="navigateDay(-1)"><</button>
                <button class="today-nav-btn today-text" onclick="goToToday()">Today</button>
                <button class="today-nav-btn" onclick="navigateDay(1)">></button>
            </div>
            <div class="month-nav" id="monthNav">
                <button class="month-nav-btn" onclick="navigateView(-1)"><</button>
                <span class="month-display middle" id="monthDisplay"></span>
                <button class="month-nav-btn" onclick="navigateView(1)">></button>
            </div>
            <div class="week-nav" id="weekNav">
                <button class="week-nav-btn" onclick="navigateView(-1)"><</button>
                <span class="week-display middle" id="weekDisplay"></span>
                <button class="week-nav-btn" onclick="navigateView(1)">></button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div id="contentArea"></div>
    </div>

    <div class="sidebar" style="display: none;">
        <div class="section-title">Family Members</div>
        <div class="family-members" id="familyMembers"></div>
        <button class="add-btn" onclick="addFamilyMember()">+ Add Member</button>

        <div class="section-title" style="margin-top: 30px;">Quick Actions</div>
        <button class="add-btn" onclick="openEventModal()">+ Add Event</button>
        <button class="add-btn" onclick="openTaskModal()">+ Add Task</button>
    </div>

    <div class="main-calendar" style="display: none;">
        <div class="tabs">
            <button class="tab active" onclick="switchView('month')">Month</button>
            <button class="tab" onclick="switchView('week')">Week</button>
            <button class="tab" onclick="switchView('schedule')">Schedule</button>
            <button class="tab" onclick="switchView('day')">Day</button>
        </div>
        
        <div class="calendar-header">
            <button class="nav-btn" onclick="navigateView(-1)">←</button>
            <h2 id="monthYear"></h2>
            <button class="nav-btn" onclick="navigateView(1)">→</button>
        </div>
        
        <div class="calendar-grid" id="calendarGrid"></div>
        
        <div class="week-view" id="weekView"></div>
        
        <div class="schedule-view" id="scheduleView">
            <div class="schedule-container" id="scheduleContainer"></div>
        </div>
        
        <div class="day-view" id="dayView"></div>
    </div>

    <div class="right-panel" style="display: none;">
        <div class="section-title">Today's Tasks</div>
        <ul class="task-list" id="taskList"></ul>

        <div class="section-title" style="margin-top: 30px;">This Week's Meals</div>
        <div class="meal-plan" id="mealPlan"></div>
        <button class="add-btn" onclick="openMealModal()">+ Add Meal</button>
    </div>
</div>

<button class="floating-add-btn" id="floatingAddBtn" onclick="openEventModalForCurrentDay()">+</button>

<button class="floating-add-task-btn" id="floatingAddTaskBtn" onclick="handleFloatingAdd()">+</button>

<!-- Add Task Side Panel (replaces centered modal) -->
<div class="edit-panel-overlay" id="taskChorePanelOverlay" onclick="closeModal('taskChoreModal')"></div>
<div class="edit-side-panel" id="taskChoreModal">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeModal('taskChoreModal')">←</button>
        <div class="edit-panel-title">Add Task</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">Title</label>
            <input type="text" class="edit-form-input" id="taskChoreTitle" placeholder="Task title">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Emoji (Optional)</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" class="edit-form-input" id="taskChoreEmoji" placeholder="😊" readonly style="flex: 1;">
                <button class="task-dropdown-btn" onclick="toggleEmojiPicker(event)" style="padding: 15px; font-size: 18px;">▼</button>
            </div>
            <div class="emoji-picker-dropdown" id="emojiPickerDropdown" style="position: relative; margin-top: 10px;">
                <input type="text" class="emoji-search-input" id="emojiSearchInput" placeholder="Search emojis..." onkeyup="filterEmojis()" onclick="event.stopPropagation()">
                <div class="emoji-picker-grid" id="emojiPickerGrid"></div>
            </div>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Profiles</label>
            <div class="edit-profile-grid" id="taskProfileGrid">
                <!-- Profiles will be populated here -->
            </div>
        </div>
        
        <div class="edit-form-group">
            <div class="edit-type-toggle">
                <button class="edit-type-btn active" id="choreTypeBtn" onclick="setTaskType('chore')">Chore</button>
                <button class="edit-type-btn" id="routineTypeBtn" onclick="setTaskType('routine')">Routine</button>
            </div>
        </div>
        
        <div class="edit-form-group">
            <div class="edit-toggle-row">
                <div class="edit-toggle-label">
                    <span class="edit-toggle-icon">📅</span>
                    <span>Date</span>
                </div>
                <label class="task-toggle">
                    <input type="checkbox" id="taskChoreDateToggle" checked onchange="updateAddDateVisibility()">
                    <span class="task-toggle-slider"></span>
                </label>
            </div>
            <input type="date" class="edit-form-input" id="taskChoreDate" style="margin-top: 10px;">
        </div>
        
        <div class="edit-form-group">
            <div class="edit-toggle-row">
                <div class="edit-toggle-label">
                    <span class="edit-toggle-icon">🕐</span>
                    <span>Time</span>
                </div>
                <label class="task-toggle">
                    <input type="checkbox" id="taskChoreTimeToggle" onchange="updateAddTimeVisibility()">
                    <span class="task-toggle-slider"></span>
                </label>
            </div>
            <input type="time" class="edit-form-input" id="taskChoreTime" style="margin-top: 10px; display: none;">
        </div>
        
        <div class="edit-form-group" id="taskStarsSection">
            <label class="edit-form-label">Stars</label>
            <input type="number" class="edit-form-input" id="taskChoreStars" value="5" min="0">
        </div>
        
        <div class="edit-form-group" id="taskRepeatSection" style="display: none;">
            <div class="edit-toggle-row">
                <div class="edit-toggle-label">
                    <span class="edit-toggle-icon">🔄</span>
                    <span>Repeats</span>
                </div>
                <label class="task-toggle">
                    <input type="checkbox" id="taskChoreRepeatToggle" onchange="updateRepeatVisibility()">
                    <span class="task-toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <div id="taskRepeatDetails" style="display: none; margin-top: 15px;">
            <div class="edit-form-group">
                <label class="edit-form-label">Every</label>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="number" class="edit-form-input" id="taskRepeatEvery" value="1" min="1" style="flex: 1;">
                    <button class="task-nav-btn" onclick="changeRepeatEvery(-1)">◀</button>
                    <button class="task-nav-btn" onclick="changeRepeatEvery(1)">▶</button>
                </div>
            </div>
            
            <div class="edit-form-group">
                <label class="edit-form-label">Period</label>
                <select class="edit-form-input" id="taskRepeatUnit">
                    <option value="day">Day(s)</option>
                    <option value="week">Week(s)</option>
                    <option value="month">Month(s)</option>
                </select>
            </div>
        </div>
        
        <button class="edit-save-btn" onclick="saveTaskChore()">Add Task</button>
    </div>
</div>

<!-- Add Event Side Panel -->
<div class="edit-panel-overlay" id="eventPanelOverlay" onclick="closeModal('eventModal')"></div>
<div class="edit-side-panel" id="eventModal">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeModal('eventModal')">←</button>
        <div class="edit-panel-title">Add Event</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">Title</label>
            <input type="text" class="edit-form-input" id="eventTitle" placeholder="Event title">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Start Date</label>
            <input type="date" class="edit-form-input" id="eventDate">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">End Date (Optional)</label>
            <input type="date" class="edit-form-input" id="eventEndDate">
        </div>
        
        <div class="edit-form-group">
            <div class="edit-toggle-row">
                <div class="edit-toggle-label">
                    <span class="edit-toggle-icon">🕐</span>
                    <span>All-Day Event</span>
                </div>
                <label class="task-toggle">
                    <input type="checkbox" id="eventAllDayToggle" checked onchange="updateEventTimeVisibility()">
                    <span class="task-toggle-slider"></span>
                </label>
            </div>
        </div>
        
        <div id="eventTimeSection" style="display: none;">
            <div class="edit-form-group">
                <label class="edit-form-label">Start Time</label>
                <input type="time" class="edit-form-input" id="eventTime">
            </div>
            
            <div class="edit-form-group">
                <label class="edit-form-label">End Time</label>
                <input type="time" class="edit-form-input" id="eventEndTime">
            </div>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Assigned To</label>
            <select class="edit-form-input" id="eventMember">
                <option value="">Select Family Member</option>
            </select>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Notes (Optional)</label>
            <textarea class="edit-form-input" id="eventNotes" placeholder="Add notes..." rows="4" style="resize: vertical;"></textarea>
        </div>
        
        <button class="edit-save-btn" onclick="saveEvent()">Add Event</button>
    </div>
</div>

<div class="modal" id="taskModal" onclick="handleModalBackdropClick(event, 'taskModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2>Add Task</h2>
        <input type="text" id="taskTitle" placeholder="Task Title">
        <input type="date" id="taskDate">
        <select id="taskMember">
            <option value="">Select Family Member</option>
        </select>
        <button class="add-btn" onclick="saveTask()">Save Task</button>
        <button class="close-btn" onclick="closeModal('taskModal')">Cancel</button>
    </div>
</div>

<div class="modal" id="mealModal" onclick="handleModalBackdropClick(event, 'mealModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2>Add Meal</h2>
        <input type="date" id="mealDate">
        <input type="text" id="mealName" placeholder="Meal Name">
        <button class="add-btn" onclick="saveMeal()">Save Meal</button>
        <button class="close-btn" onclick="closeModal('mealModal')">Cancel</button>
    </div>
</div>

<div class="modal" id="rewardModal" onclick="handleModalBackdropClick(event, 'rewardModal')">
    <div class="modal-content task-modal" onclick="event.stopPropagation()">
        <div class="task-modal-header">
            <button class="task-modal-back" onclick="closeModal('rewardModal')">←</button>
            <h2>Add Reward</h2>
        </div>
        
        <div class="task-modal-body">
            <div class="task-form-group">
                <label class="task-form-icon">≡</label>
                <input type="text" id="rewardTitle" placeholder="Reward Title" class="task-input">
            </div>
            
            <div class="task-form-group emoji-picker-container">
                <label class="task-form-icon">😊</label>
                <div style="position: relative; flex: 1;">
                    <input type="text" id="rewardEmoji" placeholder="Emoji" class="task-input" readonly style="color: transparent; text-shadow: 0 0 0 #000;">
                    <span id="rewardEmojiDisplay" style="position: absolute; left: 15px; top: 50%; transform: translateY(-50%); font-size: 20px; pointer-events: none;"></span>
                </div>
                <button class="task-dropdown-btn" onclick="toggleRewardEmojiPicker(event)">▼</button>
                
                <div class="emoji-picker-dropdown" id="rewardEmojiPickerDropdown">
                    <input type="text" class="emoji-search-input" id="rewardEmojiSearchInput" placeholder="Search emojis..." onkeyup="filterRewardEmojis()" onclick="event.stopPropagation()">
                    <div class="emoji-picker-grid" id="rewardEmojiPickerGrid"></div>
                </div>
            </div>
            
            <div class="task-form-group">
                <label class="task-form-icon">👥</label>
                <div class="task-form-label">Profile</div>
            </div>
            
            <div class="task-profile-grid" id="rewardProfileGrid"></div>
            
            <div class="task-form-group">
                <label class="task-form-icon">⭐</label>
                <div class="task-form-label">Stars Required</div>
                <input type="number" id="rewardStars" value="25" min="1" class="task-input-small" style="width: 80px;">
            </div>
            
            <button class="task-submit-btn" onclick="saveReward()">Add Reward</button>
        </div>
    </div>
</div>

<!-- Task Detail Modal -->
<div class="task-detail-modal" id="taskDetailModal" onclick="handleModalBackdropClick(event, 'taskDetailModal')">
    <div class="task-detail-content" onclick="event.stopPropagation()">
        <div class="task-detail-title" id="detailTaskTitle">Task Title</div>
        
        <div class="task-detail-actions">
            <button class="task-detail-btn task-detail-edit" onclick="openEditPanelFromDetail()">
                ✏️ Edit
            </button>
            <button class="task-detail-btn task-detail-delete" onclick="deleteCurrentTask()">
                🗑️ Delete
            </button>
        </div>
        
        <div class="task-detail-info">
            <div class="task-detail-row" id="detailTaskDate">
                <div class="task-detail-icon">📅</div>
                <span id="detailDateText">Tuesday, April 1, 8:00 PM</span>
            </div>
            
            <div class="task-detail-row" id="detailTaskRepeat" style="display: none;">
                <div class="task-detail-icon">🔄</div>
                <span id="detailRepeatText">Weekly on Tue</span>
            </div>
            
            <div class="task-detail-row">
                <div class="task-detail-icon">👥</div>
                <div class="task-detail-label">Assigned To</div>
            </div>
            
            <div class="task-detail-assigned" id="detailAssignedTo">
                <!-- Assigned members will be populated here -->
            </div>
        </div>
        
        <button class="task-detail-complete-btn" id="detailCompleteBtn" onclick="toggleCurrentTask()">
            Mark as Complete
        </button>
    </div>
</div>

<!-- Edit Side Panel -->
<div class="edit-panel-overlay" id="editPanelOverlay" onclick="closeEditPanel()"></div>
<div class="edit-side-panel" id="editSidePanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeEditPanel()">←</button>
        <div class="edit-panel-title">Edit Task</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">Title</label>
            <input type="text" class="edit-form-input" id="editTaskTitle" placeholder="Task title">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Emoji (Optional)</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" class="edit-form-input" id="editTaskEmoji" placeholder="😊" readonly style="flex: 1;">
                <button class="task-dropdown-btn" onclick="toggleEditEmojiPicker(event)" style="padding: 15px; font-size: 18px;">▼</button>
            </div>
            <div class="emoji-picker-dropdown" id="editEmojiPickerDropdown" style="position: relative; margin-top: 10px;">
                <input type="text" class="emoji-search-input" id="editEmojiSearchInput" placeholder="Search emojis..." onkeyup="filterEditEmojis()" onclick="event.stopPropagation()">
                <div class="emoji-picker-grid" id="editEmojiPickerGrid"></div>
            </div>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Profiles</label>
            <div class="edit-profile-grid" id="editProfileGrid">
                <!-- Profiles will be populated here -->
            </div>
        </div>
        
        <div class="edit-form-group">
            <div class="edit-type-toggle">
                <button class="edit-type-btn active" id="editChoreTypeBtn" onclick="setEditTaskType('chore')">Chore</button>
                <button class="edit-type-btn" id="editRoutineTypeBtn" onclick="setEditTaskType('routine')">Routine</button>
            </div>
        </div>
        
        <div class="edit-form-group">
            <div class="edit-toggle-row">
                <div class="edit-toggle-label">
                    <span class="edit-toggle-icon">📅</span>
                    <span>Date</span>
                </div>
                <label class="task-toggle">
                    <input type="checkbox" id="editTaskDateToggle" checked onchange="updateEditDateVisibility()">
                    <span class="task-toggle-slider"></span>
                </label>
            </div>
            <input type="date" class="edit-form-input" id="editTaskDate" style="margin-top: 10px;">
        </div>
        
        <div class="edit-form-group">
            <div class="edit-toggle-row">
                <div class="edit-toggle-label">
                    <span class="edit-toggle-icon">🕐</span>
                    <span>Time</span>
                </div>
                <label class="task-toggle">
                    <input type="checkbox" id="editTaskTimeToggle" onchange="updateEditTimeVisibility()">
                    <span class="task-toggle-slider"></span>
                </label>
            </div>
            <input type="time" class="edit-form-input" id="editTaskTime" style="margin-top: 10px; display: none;">
        </div>
        
        <div class="edit-form-group" id="editStarsSection">
            <label class="edit-form-label">Stars</label>
            <input type="number" class="edit-form-input" id="editTaskStars" value="5" min="0">
        </div>
        
        <button class="edit-save-btn" onclick="saveEditedTask()">Save</button>
        <button class="edit-delete-btn" onclick="deleteCurrentTask()">
            <span>🗑️</span>
            <span>Delete Task</span>
        </button>
    </div>
</div>

<!-- Meal Selector Side Panel -->
<div class="edit-panel-overlay" id="mealSelectorOverlay" onclick="closeMealSelector()"></div>
<div class="edit-side-panel" id="mealSelectorPanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeMealSelector()">←</button>
        <div class="edit-panel-title" id="mealSelectorTitle">Select Meal</div>
    </div>
    
    <div id="mealSelectorList" class="edit-panel-body" style="padding: 0;">
        <!-- Recipe list will be populated here -->
    </div>
</div>

<!-- Add Recipe Side Panel -->
<div class="edit-panel-overlay" id="addRecipePanelOverlay" onclick="closeAddRecipePanel()"></div>
<div class="edit-side-panel" id="addRecipePanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeAddRecipePanel()">←</button>
        <div class="edit-panel-title">Add Recipe</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">Import from URL (Optional)</label>
            <div style="display: flex; gap: 10px;">
                <input type="url" class="edit-form-input" id="addRecipeURL" placeholder="Paste recipe URL..." style="flex: 1;">
                <button class="task-dropdown-btn" onclick="importRecipeFromURL()" style="padding: 15px; background: #4A90E2; color: white; border-radius: 8px; font-weight: 600;">Import</button>
            </div>
            <div id="importStatus" style="margin-top: 5px; font-size: 12px; color: #666;"></div>
        </div>
        
        <div style="text-align: center; margin: 15px 0; color: #999; font-size: 14px;">— OR —</div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Recipe Name</label>
            <input type="text" class="edit-form-input" id="addRecipeName" placeholder="Enter recipe name">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Meal Type</label>
            <select class="edit-form-input" id="addRecipeMealType">
                <option value="Breakfast">Breakfast</option>
                <option value="Lunch">Lunch</option>
                <option value="Dinner">Dinner</option>
                <option value="Snack">Snack</option>
            </select>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Ingredients</label>
            <textarea class="edit-form-input" id="addRecipeIngredients" rows="4" placeholder="List ingredients..."></textarea>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Instructions</label>
            <textarea class="edit-form-input" id="addRecipeInstructions" rows="4" placeholder="Cooking instructions..."></textarea>
        </div>
        
        <button class="edit-save-btn" onclick="saveNewRecipe()">Save Recipe</button>
    </div>
</div>

<!-- Add List Side Panel -->
<div class="edit-panel-overlay" id="addListPanelOverlay" onclick="closeAddListPanel()"></div>
<div class="edit-side-panel" id="addListPanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeAddListPanel()">←</button>
        <div class="edit-panel-title">Add List</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">List Name</label>
            <input type="text" class="edit-form-input" id="addListName" placeholder="Enter list name">
        </div>
        
        <div class="task-form-group">
            <label class="task-form-icon">👥</label>
            <div class="task-form-label">Assigned To</div>
        </div>
        
        <div class="task-profile-grid" id="addListProfileGrid"></div>
        
        <button class="edit-save-btn" onclick="saveNewList()">Create List</button>
    </div>
</div>

<!-- Add Section Modal -->
<div class="modal" id="addSectionModal" onclick="handleModalBackdropClick(event, 'addSectionModal')">
    <div class="modal-content" onclick="event.stopPropagation()">
        <h2>Add Section</h2>
        <input type="text" id="sectionNameInput" placeholder="Section name" onkeypress="if(event.key==='Enter') saveNewSection()">
        <input type="hidden" id="sectionListId">
        <button class="add-btn" onclick="saveNewSection()">Add Section</button>
        <button class="close-btn" onclick="closeModal('addSectionModal')">Cancel</button>
    </div>
</div>

<!-- Meal Detail Modal -->
<div class="meal-detail-modal" id="mealDetailModal" onclick="if(event.target === this) closeMealDetail()">
    <div class="meal-detail-content" onclick="event.stopPropagation()">
        <div class="meal-detail-header">
            <div class="meal-detail-title" id="mealDetailTitle">Recipe Name</div>
            <div class="meal-detail-actions">
                <button class="meal-detail-btn meal-detail-edit" onclick="editMealFromDetail()">
                    ✏️ Edit
                </button>
                <button class="meal-detail-btn meal-detail-delete" onclick="deleteMealFromDetail()">
                    🗑️ Delete
                </button>
            </div>
        </div>
        
        <div class="meal-detail-info">
            <div class="meal-detail-info-row">
                📅 <span id="mealDetailDate">Date</span>
            </div>
            <div class="meal-detail-info-row">
                <span id="mealDetailCategoryDot" style="width: 12px; height: 12px; border-radius: 50%; background: #999; display: inline-block;"></span>
                <span id="mealDetailCategory">Category</span>
            </div>
        </div>
        
        <div class="meal-detail-section">
            <div class="meal-detail-section-title">INGREDIENTS:</div>
            <div class="meal-detail-text" id="mealDetailIngredients">Ingredients will appear here</div>
        </div>
        
        <div class="meal-detail-section">
            <div class="meal-detail-section-title">INSTRUCTIONS:</div>
            <div class="meal-detail-text" id="mealDetailInstructions">Instructions will appear here</div>
        </div>
    </div>
</div>

<!-- List Item Detail Modal -->
<div class="task-detail-modal" id="listItemDetailModal" onclick="if(event.target === this) closeListItemDetail()">
    <div class="task-detail-content" onclick="event.stopPropagation()">
        <div class="task-detail-title" id="listItemDetailTitle">Item</div>
        
        <div class="task-detail-actions">
            <button class="task-detail-btn task-detail-edit" onclick="editListItemFromDetail()">
                ✏️ Edit
            </button>
            <button class="task-detail-btn task-detail-delete" onclick="deleteListItemFromDetail()">
                🗑️ Delete
            </button>
        </div>
        
        <div class="task-detail-info">
            <div class="task-detail-row">
                <div class="task-detail-icon">📋</div>
                <div class="task-detail-label">List:</div>
                <span id="listItemDetailListName">List Name</span>
            </div>
            
            <div class="task-detail-row">
                <div class="task-detail-icon">👥</div>
                <div class="task-detail-label">Assigned To:</div>
                <div class="task-detail-assigned" id="listItemDetailAssignedTo">
                    <!-- Assigned member will be populated here -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Event Detail Side Panel -->
<div class="edit-panel-overlay" id="eventDetailPanelOverlay" onclick="closeEventDetailPanel()"></div>
<div class="edit-side-panel" id="eventDetailPanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeEventDetailPanel()">←</button>
        <div class="edit-panel-title">Event Details</div>
    </div>
    
    <div class="edit-panel-body">
        <div style="margin-bottom: 30px;">
            <div style="font-size: 24px; font-weight: 600; color: #000; margin-bottom: 20px;" id="eventDetailTitle">Event Title</div>
            
            <div class="task-detail-row" style="margin-bottom: 15px;">
                <div class="task-detail-icon">📅</div>
                <div style="flex: 1;">
                    <div style="color: #666; font-size: 14px;">Date & Time</div>
                    <div style="color: #000; font-size: 16px; font-weight: 500;" id="eventDetailDateTime">Monday, January 20, 2026 at 3:00 PM</div>
                </div>
            </div>
            
            <div class="task-detail-row" style="margin-bottom: 15px;" id="eventDetailReminderRow">
                <div class="task-detail-icon">🔔</div>
                <div style="flex: 1;">
                    <div style="color: #666; font-size: 14px;">Reminder</div>
                    <div style="color: #000; font-size: 16px; font-weight: 500;" id="eventDetailReminder">15 minutes before</div>
                </div>
            </div>
            
            <div class="task-detail-row" style="margin-bottom: 15px;" id="eventDetailMemberRow">
                <div class="task-detail-icon">👤</div>
                <div style="flex: 1;">
                    <div style="color: #666; font-size: 14px;">Assigned To</div>
                    <div class="task-detail-assigned" id="eventDetailMember">
                        <!-- Member will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="task-detail-row" style="margin-bottom: 15px;" id="eventDetailCalendarRow">
                <div class="task-detail-icon">📆</div>
                <div style="flex: 1;">
                    <div style="color: #666; font-size: 14px;">Calendar</div>
                    <div style="color: #000; font-size: 16px; font-weight: 500;" id="eventDetailCalendar">Google Calendar</div>
                </div>
            </div>
            
            <div class="task-detail-row" style="margin-bottom: 15px;" id="eventDetailInviteesRow">
                <div class="task-detail-icon">👥</div>
                <div style="flex: 1;">
                    <div style="color: #666; font-size: 14px;">Invitees</div>
                    <div style="color: #000; font-size: 16px; font-weight: 500;" id="eventDetailInvitees">None</div>
                </div>
            </div>
            
            <div class="task-detail-row" style="margin-bottom: 15px;" id="eventDetailNotesRow">
                <div class="task-detail-icon">📝</div>
                <div style="flex: 1;">
                    <div style="color: #666; font-size: 14px;">Notes</div>
                    <div style="color: #666; font-size: 15px; line-height: 1.5; margin-top: 5px;" id="eventDetailNotes">No notes</div>
                </div>
            </div>
        </div>
        
        <button class="edit-save-btn" onclick="editEventFromDetail()" id="eventDetailEditBtn">Edit Event</button>
        <button class="edit-delete-btn" onclick="deleteEventFromDetail()" id="eventDetailDeleteBtn">
            <span>🗑️</span>
            <span>Delete Event</span>
        </button>
    </div>
</div>

<!-- Edit List Side Panel -->
<div class="edit-panel-overlay" id="editListPanelOverlay" onclick="closeEditListPanel()"></div>
<div class="edit-side-panel" id="editListPanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeEditListPanel()">←</button>
        <div class="edit-panel-title">Edit List</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">List Name</label>
            <input type="text" class="edit-form-input" id="editListName" placeholder="List name">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Assigned To</label>
            <select class="edit-form-input" id="editListAssignedTo">
            </select>
        </div>
        
        <button class="edit-save-btn" onclick="saveEditedList()">Save</button>
        <button class="edit-delete-btn" onclick="deleteList()">Delete List</button>
    </div>
</div>

<!-- Edit List Item Side Panel -->
<div class="edit-panel-overlay" id="editListItemPanelOverlay" onclick="closeEditListItemPanel()"></div>
<div class="edit-side-panel" id="editListItemPanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeEditListItemPanel()">←</button>
        <div class="edit-panel-title">Edit Item</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">Item Text</label>
            <input type="text" class="edit-form-input" id="editListItemText" placeholder="Item text">
        </div>
        
        <button class="edit-save-btn" onclick="saveEditedListItem()">Save</button>
    </div>
</div>

<!-- Edit Reward Side Panel -->
<div class="edit-panel-overlay" id="editRewardPanelOverlay" onclick="closeEditRewardPanel()"></div>
<div class="edit-side-panel" id="editRewardPanel">
    <div class="edit-panel-header">
        <button class="edit-panel-back" onclick="closeEditRewardPanel()">←</button>
        <div class="edit-panel-title">Edit Reward</div>
    </div>
    
    <div class="edit-panel-body">
        <div class="edit-form-group">
            <label class="edit-form-label">Title</label>
            <input type="text" class="edit-form-input" id="editRewardTitle" placeholder="Reward title">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Emoji (Optional)</label>
            <div style="display: flex; gap: 10px; align-items: center;">
                <input type="text" class="edit-form-input" id="editRewardEmoji" placeholder="🎁" readonly style="flex: 1;">
                <button class="task-dropdown-btn" onclick="toggleEditRewardEmojiPicker(event)" style="padding: 15px; font-size: 18px;">▼</button>
            </div>
            <div class="emoji-picker-dropdown" id="editRewardEmojiPickerDropdown" style="position: relative; margin-top: 10px;">
                <input type="text" class="emoji-search-input" id="editRewardEmojiSearchInput" placeholder="Search emojis..." onkeyup="filterEditRewardEmojis()" onclick="event.stopPropagation()">
                <div class="emoji-picker-grid" id="editRewardEmojiPickerGrid"></div>
            </div>
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Stars Required</label>
            <input type="number" class="edit-form-input" id="editRewardStars" value="25" min="1">
        </div>
        
        <button class="edit-save-btn" onclick="saveEditedReward()">Save</button>
        <button class="edit-delete-btn" onclick="deleteCurrentReward()">
            <span>🗑️</span>
            <span>Delete Reward</span>
        </button>
    </div>
</div>

<!-- Edit Profile Modal -->
<div class="task-detail-modal" id="editProfileModal" onclick="if(event.target === this) closeEditProfileModal()">
    <div class="task-detail-content" onclick="event.stopPropagation()">
        <div class="task-detail-title">Edit Profile</div>
        
        <div class="edit-form-group" style="margin-top: 30px;">
            <label class="edit-form-label">Name</label>
            <input type="text" class="edit-form-input" id="editProfileName" placeholder="Profile name">
        </div>
        
        <div class="edit-form-group">
            <label class="edit-form-label">Color</label>
            <div class="color-picker-container">
                <button class="color-picker-nav" onclick="scrollColorPicker(-1)">‹</button>
                <div class="color-picker-scroll" id="colorPickerScroll">
                    <div class="color-picker-grid" id="colorPickerGrid">
                        <!-- Colors will be populated here -->
                    </div>
                </div>
                <button class="color-picker-nav" onclick="scrollColorPicker(1)">›</button>
            </div>
        </div>
        
        <button class="edit-save-btn" onclick="saveEditedProfile()">Save Changes</button>
        <button class="task-detail-btn" style="width: 100%; margin-top: 10px; background: #f0f0f0; color: #666;" onclick="closeEditProfileModal()">Cancel</button>
    </div>
</div>

<!-- Reward Redemption Modal -->
<div class="reward-redemption-modal" id="rewardRedemptionModal">
    <div class="reward-redemption-overlay"></div>
    <div class="reward-redemption-content">
        <div class="reward-redemption-emoji" id="redemptionEmoji">🎁</div>
        <div class="reward-redemption-title" id="redemptionTitle">Great work! Trip to the aquarium! redeemed</div>
        <div class="reward-redemption-subtitle" id="redemptionSubtitle">By Willow for 50 stars on April 02, 2025.</div>
        <button class="reward-redemption-done-btn" onclick="closeRewardRedemptionModal()">Done</button>
        <div class="reward-redemption-unredeem" onclick="unredeemCurrentReward()">Unredeem</div>
    </div>
</div>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<script>
    // Visual debugging
```

window.onerror = function(msg, url, line, col, error) {
document.body.insertAdjacentHTML(‘beforeend’,
‘<div style="background:red;color:white;padding:10px;margin:5px;font-size:14px;word-break:break-all;z-index:99999;position:relative;">’ +
’ERROR: ’ + msg + ’<br>Line: ’ + line + ‘</div>’);
return false;
};

console.log = function(…args) {
document.body.insertAdjacentHTML(‘beforeend’,
‘<div style="background:yellow;padding:5px;margin:2px;font-size:12px;z-index:99999;position:relative;">’ +
args.join(’ ’) + ‘</div>’);
};
console.error = console.log;

console.log(‘Script started loading…’);
let currentDate = new Date();
let currentView = ‘month’;
let currentSection = ‘calendar’;
let scheduleDaysToShow = 14;
let familyMembers = JSON.parse(localStorage.getItem(‘familyMembers’)) || [
{ name: ‘Family’, color: ‘#9B59B6’, isGoogleCalendar: true, calendarId: ‘family’ },
{ name: ‘Mary’, color: ‘#FF6B6B’ },
{ name: ‘Bret’, color: ‘#4ECDC4’ },
{ name: ‘Levi’, color: ‘#D9B554’ },
{ name: ‘Elsie’, color: ‘#DDC2F0’ }
];

```
    // Ensure all family members have IDs (migration for existing data)
    let needsUpdate = false;
    familyMembers.forEach((member, index) => {
        if (!member.id) {
            member.id = index + 1;
            needsUpdate = true;
        }
    });
    if (needsUpdate) {
        localStorage.setItem('familyMembers', JSON.stringify(familyMembers));
    }
    let events = JSON.parse(localStorage.getItem('events')) || [];
    let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
    let chores = JSON.parse(localStorage.getItem('chores')) || [];
    let routines = JSON.parse(localStorage.getItem('routines')) || [];
    let meals = JSON.parse(localStorage.getItem('meals')) || [];
    let rewards = JSON.parse(localStorage.getItem('rewards')) || [];
    
    // Meal planning data
    let recipes = JSON.parse(localStorage.getItem('recipes')) || [];
    let mealPlan = JSON.parse(localStorage.getItem('mealPlan')) || [];
    let mealCategories = [
        { name: 'Breakfast', color: '#FFB3B3' },
        { name: 'Lunch', color: '#B3E5D9' },
        { name: 'Dinner', color: '#FFD9A3' },
        { name: 'Snack', color: '#E5D4B3' }
    ];
    let currentMealWeekStart = new Date();
    currentMealWeekStart.setHours(0, 0, 0, 0); // Start on today
    
    // Lists data
    let lists = JSON.parse(localStorage.getItem('lists')) || [];
    let currentListId = null;
    
    // Google Calendar API configuration

    // Google Calendar API configuration
    const CLIENT_ID = typeof CONFIG !== 'undefined' ? CONFIG.GOOGLE_CLIENT_ID : '';
    const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest';
    const SCOPES = 'https://www.googleapis.com/auth/calendar.readonly';
    
    let tokenClient;
    let gapiInited = false;
    let gisInited = false;
    let googleCalendarEvents = [];
    let isGoogleConnected = false;

    
    // Meal Planning Functions
    let mealHoldTimer = null;
    let mealHoldTarget = null;
    
    function renderMealPlanGrid() {
        const grid = document.getElementById('mealPlanGrid');
        const weekDays = [];
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Get 7 days starting from currentMealWeekStart
        for (let i = 0; i < 7; i++) {
            const day = new Date(currentMealWeekStart);
            day.setDate(currentMealWeekStart.getDate() + i);
            weekDays.push(day);
        }
        
        let html = '<div class="meal-grid-container">';
        
        // Empty corner cell
        html += '<div></div>';
        
        // Day headers
        weekDays.forEach(day => {
            const isToday = day.getTime() === today.getTime();
            const dayName = day.toLocaleDateString('en-US', { weekday: 'short' });
            const dayNum = day.getDate();
            html += `<div class="meal-day-header ${isToday ? 'today' : ''}">
                <div class="week-day-name">${dayName}</div>
                <div class="week-day-number">${dayNum}</div>
            </div>`;
        });
        
        // Rows for each meal type
        mealCategories.forEach(category => {
            // Row label
            html += `<div class="meal-row-label">${category.name}</div>`;
            
            // Cells for each day
            weekDays.forEach(day => {
                const dateStr = day.toISOString().split('T')[0];
                const meals = mealPlan.filter(m => m.date === dateStr && m.mealType === category.name);
                const mealTypeClass = category.name.toLowerCase();
                
                html += `<div class="meal-cell">`;
                
                if (meals.length === 0) {
                    // Show single empty box
                    html += `<div class="meal-box empty-box ${mealTypeClass}" onclick="toggleMealBoxSelection(event, '${dateStr}', '${category.name}'); openMealSelector('${dateStr}', '${category.name}')"></div>`;
                } else {
                    // Show existing meals
                    meals.forEach(meal => {
                        const recipe = recipes.find(r => r.id === meal.recipeId);
                        if (recipe) {
                            html += `<div class="meal-box" 
                                          style="background: ${category.color};" 
                                          onmousedown="startMealHold(event, '${meal.id}', '${dateStr}', '${category.name}')"
                                          onmouseup="endMealHold(event, '${meal.id}')"
                                          onmouseleave="cancelMealHold()"
                                          ontouchstart="startMealHold(event, '${meal.id}', '${dateStr}', '${category.name}')"
                                          ontouchend="endMealHold(event, '${meal.id}')"
                                          ontouchcancel="cancelMealHold()">${recipe.name}</div>`;
                        }
                    });
                }
                
                html += `</div>`;
            });
        });
        
        html += '</div>';
        grid.innerHTML = html;
    }
    
    function startMealHold(event, mealId, dateStr, mealType) {
        event.preventDefault();
        mealHoldTarget = { mealId, dateStr, mealType };
        mealHoldTimer = setTimeout(() => {
            // Hold detected - open meal selector to add another
            openMealSelector(dateStr, mealType);
            mealHoldTimer = null;
        }, 500); // 500ms hold time
    }
    
    function endMealHold(event, mealId) {
        event.preventDefault();
        if (mealHoldTimer) {
            // Quick click - show meal details
            clearTimeout(mealHoldTimer);
            mealHoldTimer = null;
            showMealDetail(mealId);
        }
    }
    
    function cancelMealHold() {
        if (mealHoldTimer) {
            clearTimeout(mealHoldTimer);
            mealHoldTimer = null;
        }
    }
    
    let currentMealType = '';
    let currentMealDate = '';
    
    function openMealSelector(date, mealType) {
        currentMealDate = date;
        currentMealType = mealType;
        
        const panel = document.getElementById('mealSelectorPanel');
        const overlay = document.getElementById('mealSelectorOverlay');
        const title = document.getElementById('mealSelectorTitle');
        
        title.textContent = `Select ${mealType}`;
        
        renderMealSelectorList();
        
        overlay.classList.add('active');
        panel.classList.add('active');
    }
    
    function toggleMealBoxSelection(event, date, mealType) {
        const box = event.target;
        box.classList.toggle('selected');
    }
    
    function closeMealSelector() {
        document.getElementById('mealSelectorPanel').classList.remove('active');
        document.getElementById('mealSelectorOverlay').classList.remove('active');
    }
    
    function renderMealSelectorList() {
        const list = document.getElementById('mealSelectorList');
        const categoryRecipes = recipes.filter(r => r.mealType === currentMealType);
        
        let html = `<div class="add-recipe-btn" onclick="openAddRecipePanel()">+ Add recipe</div>`;
        
        categoryRecipes.forEach(recipe => {
            html += `
                <div class="recipe-list-item" onclick="selectRecipe(${recipe.id})">
                    <span class="recipe-list-item-name">${recipe.name}</span>
                    <span class="recipe-list-item-menu">⋯</span>
                </div>
            `;
        });
        
        if (categoryRecipes.length === 0) {
            html += '<div style="padding: 40px; text-align: center; color: #999;">No recipes yet. Add one!</div>';
        }
        
        list.innerHTML = html;
    }
    
    function selectRecipe(recipeId) {
        // Always add a new meal (allow multiple meals per day/type)
        mealPlan.push({
            id: Date.now(),
            date: currentMealDate,
            mealType: currentMealType,
            recipeId: recipeId
        });
        
        localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
        closeMealSelector();
        renderMealPlanGrid();
    }
    
    function showMealDetail(mealId) {
        const meal = mealPlan.find(m => m.id == mealId);
        if (!meal) return;
        
        const recipe = recipes.find(r => r.id === meal.recipeId);
        if (!recipe) return;
        
        const modal = document.getElementById('mealDetailModal');
        const category = mealCategories.find(c => c.name === meal.mealType);
        
        // Format date
        const date = new Date(meal.date);
        const dateStr = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        
        document.getElementById('mealDetailTitle').textContent = recipe.name;
        document.getElementById('mealDetailDate').textContent = dateStr;
        document.getElementById('mealDetailCategory').textContent = meal.mealType;
        document.getElementById('mealDetailCategoryDot').style.background = category ? category.color : '#999';
        document.getElementById('mealDetailIngredients').textContent = recipe.ingredients || 'No ingredients listed';
        document.getElementById('mealDetailInstructions').textContent = recipe.instructions || 'No instructions provided';
        
        // Store current meal ID for edit/delete
        modal.dataset.mealId = mealId;
        
        modal.classList.add('active');
    }
    
    function closeMealDetail() {
        document.getElementById('mealDetailModal').classList.remove('active');
    }
    
    function editMealFromDetail() {
        const mealId = document.getElementById('mealDetailModal').dataset.mealId;
        const meal = mealPlan.find(m => m.id == mealId);
        if (meal) {
            closeMealDetail();
            // For now, just open the meal selector to replace
            // In future, could open edit panel with pre-filled data
            currentMealDate = meal.date;
            currentMealType = meal.mealType;
            openMealSelector(meal.date, meal.mealType);
        }
    }
    
    function deleteMealFromDetail() {
        const mealId = document.getElementById('mealDetailModal').dataset.mealId;
        if (confirm('Remove this meal?')) {
            const index = mealPlan.findIndex(m => m.id == mealId);
            if (index > -1) {
                mealPlan.splice(index, 1);
                localStorage.setItem('mealPlan', JSON.stringify(mealPlan));
                closeMealDetail();
                renderMealPlanGrid();
            }
        }
    }
    
    function editMeal(mealId) {
        // This is the old function - now replaced by showMealDetail
        showMealDetail(mealId);
    }
    
    function openAddRecipePanel() {
        closeMealSelector();
        document.getElementById('addRecipePanelOverlay').classList.add('active');
        document.getElementById('addRecipePanel').classList.add('active');
        document.getElementById('addRecipeMealType').value = currentMealType;
    }
    
    function closeAddRecipePanel() {
        document.getElementById('addRecipePanel').classList.remove('active');
        document.getElementById('addRecipePanelOverlay').classList.remove('active');
        // Clear form
        document.getElementById('addRecipeName').value = '';
        document.getElementById('addRecipeIngredients').value = '';
        document.getElementById('addRecipeInstructions').value = '';
    }
    
    async function importRecipeFromURL() {
        const url = document.getElementById('addRecipeURL').value.trim();
        const statusDiv = document.getElementById('importStatus');
        
        if (!url) {
            statusDiv.textContent = 'Please enter a URL';
            statusDiv.style.color = '#dc3545';
            return;
        }
        
        statusDiv.textContent = '⏳ Importing recipe...';
        statusDiv.style.color = '#4A90E2';
        
        try {
            // Use a CORS proxy to fetch the recipe page
            const proxyUrl = 'https://api.allorigins.win/raw?url=';
            const response = await fetch(proxyUrl + encodeURIComponent(url));
            
            if (!response.ok) {
                throw new Error('Failed to fetch recipe');
            }
            
            const html = await response.text();
            
            // Try to extract recipe data from JSON-LD schema
            const recipe = extractRecipeFromHTML(html);
            
            if (recipe) {
                // Populate the form with extracted data
                document.getElementById('addRecipeName').value = recipe.name || '';
                document.getElementById('addRecipeIngredients').value = recipe.ingredients || '';
                document.getElementById('addRecipeInstructions').value = recipe.instructions || '';
                
                // Try to guess meal type from recipe name or category
                const mealType = guessMealType(recipe.name, recipe.category);
                document.getElementById('addRecipeMealType').value = mealType;
                
                statusDiv.textContent = '✅ Recipe imported! Review and save.';
                statusDiv.style.color = '#4CAF50';
            } else {
                throw new Error('Could not extract recipe data from this URL');
            }
        } catch (error) {
            console.error('Import error:', error);
            statusDiv.textContent = '❌ Could not import recipe. Please enter manually.';
            statusDiv.style.color = '#dc3545';
        }
    }
    
    function extractRecipeFromHTML(html) {
        try {
            // Look for JSON-LD recipe schema
            const jsonLdMatch = html.match(/<script[^>]*type="application\/ld\+json"[^>]*>([\s\S]*?)<\/script>/gi);
            
            if (jsonLdMatch) {
                for (let script of jsonLdMatch) {
                    const jsonText = script.replace(/<script[^>]*>|<\/script>/gi, '');
                    try {
                        const data = JSON.parse(jsonText);
                        const recipe = Array.isArray(data) ? data.find(d => d['@type'] === 'Recipe') : 
                                      (data['@type'] === 'Recipe' ? data : (data['@graph'] && data['@graph'].find(d => d['@type'] === 'Recipe')));
                        
                        if (recipe) {
                            return {
                                name: recipe.name || '',
                                ingredients: Array.isArray(recipe.recipeIngredient) ? 
                                            recipe.recipeIngredient.join('\n') : 
                                            (recipe.recipeIngredient || ''),
                                instructions: extractInstructions(recipe.recipeInstructions),
                                category: recipe.recipeCategory || ''
                            };
                        }
                    } catch (e) {
                        continue;
                    }
                }
            }
            
            return null;
        } catch (error) {
            console.error('Extraction error:', error);
            return null;
        }
    }
    
    function extractInstructions(instructions) {
        if (!instructions) return '';
        
        if (typeof instructions === 'string') return instructions;
        
        if (Array.isArray(instructions)) {
            return instructions.map((step, i) => {
                if (typeof step === 'string') return step;
                if (step.text) return step.text;
                if (step.name) return step.name;
                return '';
            }).filter(Boolean).join('\n');
        }
        
        if (instructions.text) return instructions.text;
        
        return '';
    }
    
    function guessMealType(name, category) {
        const text = (name + ' ' + category).toLowerCase();
        
        if (text.includes('breakfast') || text.includes('pancake') || text.includes('waffle') || 
            text.includes('eggs') || text.includes('oatmeal')) {
            return 'Breakfast';
        }
        if (text.includes('lunch') || text.includes('sandwich') || text.includes('salad')) {
            return 'Lunch';
        }
        if (text.includes('dinner') || text.includes('pasta') || text.includes('chicken') || 
            text.includes('beef') || text.includes('fish')) {
            return 'Dinner';
        }
        if (text.includes('snack') || text.includes('cookie') || text.includes('dessert')) {
            return 'Snack';
        }
        
        return 'Dinner'; // Default
    }
    
    function saveNewRecipe() {
        const name = document.getElementById('addRecipeName').value.trim();
        const mealType = document.getElementById('addRecipeMealType').value;
        const ingredients = document.getElementById('addRecipeIngredients').value.trim();
        const instructions = document.getElementById('addRecipeInstructions').value.trim();
        
        if (!name) {
            alert('Please enter a recipe name');
            return;
        }
        
        const newRecipe = {
            id: Date.now(),
            name: name,
            mealType: mealType,
            ingredients: ingredients,
            instructions: instructions,
            category: 'Uncategorized'
        };
        
        recipes.push(newRecipe);
        localStorage.setItem('recipes', JSON.stringify(recipes));
        
        closeAddRecipePanel();
        
        // Add to meal plan
        selectRecipe(newRecipe.id);
    }
    
    function navigateMealWeek(direction) {
        currentMealWeekStart.setDate(currentMealWeekStart.getDate() + (direction * 7));
        renderMealPlanGrid();
    }
    
    function goToMealToday() {
        const today = new Date();
        currentMealWeekStart = new Date(today);
        currentMealWeekStart.setHours(0, 0, 0, 0); // Start on today
        renderMealPlanGrid();
    }
    
    function initializeSampleRecipes() {
        if (recipes.length === 0) {
            recipes = [
                { id: 1, name: 'Scrambled Eggs', mealType: 'Breakfast', category: 'Quick', ingredients: 'Eggs, butter, salt, pepper', instructions: 'Beat eggs, cook in butter until fluffy.' },
                { id: 2, name: 'Pancakes', mealType: 'Breakfast', category: 'Weekend', ingredients: 'Flour, eggs, milk, sugar, baking powder', instructions: 'Mix ingredients, cook on griddle.' },
                { id: 3, name: 'Oatmeal', mealType: 'Breakfast', category: 'Healthy', ingredients: 'Oats, milk, berries, honey', instructions: 'Cook oats with milk, top with berries.' },
                { id: 4, name: 'Caesar Salad', mealType: 'Lunch', category: 'Salads', ingredients: 'Romaine, croutons, parmesan, Caesar dressing', instructions: 'Toss ingredients together.' },
                { id: 5, name: 'Grilled Cheese', mealType: 'Lunch', category: 'Quick', ingredients: 'Bread, cheese, butter', instructions: 'Grill sandwich until golden.' },
                { id: 6, name: 'Chicken Soup', mealType: 'Lunch', category: 'Comfort', ingredients: 'Chicken, vegetables, broth, noodles', instructions: 'Simmer all ingredients.' },
                { id: 7, name: 'Spaghetti', mealType: 'Dinner', category: 'Italian', ingredients: 'Pasta, marinara sauce, ground beef, parmesan', instructions: 'Cook pasta, heat sauce with beef, combine.' },
                { id: 8, name: 'Tacos', mealType: 'Dinner', category: 'Mexican', ingredients: 'Tortillas, ground beef, lettuce, cheese, salsa', instructions: 'Cook beef, assemble tacos.' },
                { id: 9, name: 'Pizza', mealType: 'Dinner', category: 'Easy', ingredients: 'Pizza dough, sauce, mozzarella, toppings', instructions: 'Top pizza, bake at 450°F.' },
                { id: 10, name: 'Yogurt & Granola', mealType: 'Snack', category: 'Healthy', ingredients: 'Greek yogurt, granola, berries', instructions: 'Layer yogurt, granola, and berries.' },
                { id: 11, name: 'Fruit Bowl', mealType: 'Snack', category: 'Healthy', ingredients: 'Mixed fruits', instructions: 'Cut and combine fresh fruits.' },
                { id: 12, name: 'Crackers & Cheese', mealType: 'Snack', category: 'Quick', ingredients: 'Crackers, cheese slices', instructions: 'Arrange on plate.' }
            ];
            localStorage.setItem('recipes', JSON.stringify(recipes));
        }
    }
    
    // Lists Functions
    function initializeSampleLists() {
        if (lists.length === 0) {
            lists = [
                {
                    id: 1,
                    name: 'Grocery List',
                    color: familyMembers[0].color,
                    assignedTo: familyMembers[0].id,
                    items: [
                        { id: 1, text: '🥚 Eggs', completed: false },
                        { id: 2, text: '🥛 Milk', completed: false },
                        { id: 3, text: '🍞 Bread', completed: false },
                        { id: 4, text: '🍎 Apples', completed: false },
                        { id: 5, text: '🥬 Lettuce', completed: false }
                    ]
                },
                {
                    id: 2,
                    name: 'Packing List',
                    color: familyMembers[1].color,
                    assignedTo: familyMembers[1].id,
                    items: [
                        { id: 1, text: '👕 Shirts x5', completed: false },
                        { id: 2, text: '👖 Jeans x2', completed: false },
                        { id: 3, text: '🩲 Undies x7', completed: false }
                    ]
                },
                {
                    id: 3,
                    name: 'To-Do',
                    color: familyMembers[2].color,
                    assignedTo: familyMembers[2].id,
                    items: [
                        { id: 1, text: 'Pack for trip', completed: false },
                        { id: 2, text: 'Pet sitter (Allie?)', completed: false },
                        { id: 3, text: 'Stop mail', completed: false }
                    ]
                },
                {
                    id: 4,
                    name: 'Travel Bucket List',
                    color: familyMembers[3].color,
                    assignedTo: familyMembers[3].id,
                    items: [
                        { id: 1, text: '🗾 Japan', completed: false },
                        { id: 2, text: '🇮🇪 Ireland', completed: false },
                        { id: 3, text: '🇭🇷 Croatia', completed: false }
                    ]
                }
            ];
            localStorage.setItem('lists', JSON.stringify(lists));
        }
    }
    
    let selectedListsPerson = 'all';
    
    function renderFamilyPillsLists() {
        const container = document.getElementById('familyPillsLists');
        if (!container) return;
        
        let html = `<button class="family-pill ${selectedListsPerson === 'all' ? 'active' : ''}" onclick="filterListsByPerson('all')">All</button>`;
        
        familyMembers.forEach(member => {
            const activeClass = selectedListsPerson === member.id ? 'active' : '';
            html += `
                <button class="family-pill ${activeClass}" 
                        style="background: ${member.color}; color: white;" 
                        onclick="filterListsByPerson(${member.id})">
                    ${member.emoji} ${member.name}
                </button>
            `;
        });
        
        container.innerHTML = html;
    }
    
    function filterListsByPerson(personId) {
        // Convert to number if it's not 'all', to match member.id type
        selectedListsPerson = personId === 'all' ? 'all' : Number(personId);
        renderFamilyPillsLists();
        renderListsColumns();
    }
    
    function renderListsColumns() {
        const container = document.getElementById('listsColumnsContainer');
        if (!container) return;
        
        // Filter lists by selected person
        let filteredLists = lists;
        if (selectedListsPerson !== 'all') {
            filteredLists = lists.filter(list => list.assignedTo === selectedListsPerson);
        }
        
        let html = '';
        
        filteredLists.forEach(list => {
            const member = familyMembers.find(m => m.id === list.assignedTo);
            if (!member) return;
            
            // Convert hex color to rgba with 20% opacity for column background
            const columnBg = hexToRgba(member.color, 0.2);
            
            html += `<div class="chore-column" style="background: ${columnBg}">`;
            
            // Show list card with title and assigned person avatar
            html += `
                <div class="list-card">
                    <div class="list-card-header" onclick="openEditListPanel(${list.id})" style="cursor: pointer;">
                        <div class="list-card-title">${list.name}</div>
                        <div class="list-card-initial" style="background: ${member.color};">${member.name.charAt(0).toUpperCase()}</div>
                    </div>
            `;
            
            // Group items by section
            const sections = [];
            const itemsBySection = {};
            
            list.items.forEach(item => {
                const sectionName = item.section || 'Items';
                if (!itemsBySection[sectionName]) {
                    itemsBySection[sectionName] = [];
                    sections.push(sectionName);
                }
                itemsBySection[sectionName].push(item);
            });
            
            // If no sections exist, create default "Items" section
            if (sections.length === 0) {
                sections.push('Items');
                itemsBySection['Items'] = [];
            }
            
            // Render each section
            sections.forEach(sectionName => {
                const sectionItems = itemsBySection[sectionName] || [];
                const sectionId = sectionName.replace(/\s+/g, '-').toLowerCase();
                
                html += `
                    <div class="list-section">
                        <div class="list-section-header" onclick="toggleSection('${list.id}', '${sectionId}')">
                            <span class="list-section-title">${sectionName}</span>
                            <span class="list-section-count">${sectionItems.length}</span>
                            <span class="list-section-arrow">^</span>
                        </div>
                        <div class="list-section-items" id="section-${list.id}-${sectionId}">
                `;
                
                sectionItems.forEach(item => {
                    // Skip empty items (section placeholders)
                    if (!item.text) return;
                    
                    const checkedClass = item.completed ? 'checked' : '';
                    const textClass = item.completed ? 'completed' : '';
                    const itemBg = hexToRgba(member.color, 0.4);
                    html += `
                        <div class="list-item" style="background: ${itemBg};" onclick="openListItemDetail(${list.id}, ${item.id})">
                            <div class="list-item-checkbox ${checkedClass}" onclick="event.stopPropagation(); toggleListItem(${list.id}, ${item.id})"></div>
                            <div class="list-item-text ${textClass}">${item.text}</div>
                        </div>
                    `;
                });
                
                html += `
                            <input type="text" class="add-item-input" placeholder="Add an item..." onkeypress="if(event.key==='Enter') addListItemToSection(${list.id}, '${sectionName}', this)">
                        </div>
                    </div>
                `;
            });
            
            html += `
                    <div class="list-add-section-btn" onclick="addNewSection(${list.id})">
                        Add section
                    </div>
                </div>
            </div>`;
        });
        
        container.innerHTML = html;
    }
    
    function addListItemToList(listId, inputElement) {
        const text = inputElement.value.trim();
        if (!text) return;
        
        const list = lists.find(l => l.id === listId);
        if (!list) return;
        
        const newItem = {
            id: Date.now(),
            text: text,
            completed: false
        };
        
        list.items.push(newItem);
        localStorage.setItem('lists', JSON.stringify(lists));
        inputElement.value = '';
        renderListsColumns();
    }
    
    function addListItemToSection(listId, sectionName, inputElement) {
        const text = inputElement.value.trim();
        if (!text) return;
        
        const list = lists.find(l => l.id === listId);
        if (!list) return;
        
        const newItem = {
            id: Date.now(),
            text: text,
            completed: false,
            section: sectionName
        };
        
        list.items.push(newItem);
        localStorage.setItem('lists', JSON.stringify(lists));
        inputElement.value = '';
        renderListsColumns();
    }
    
    function addNewSection(listId) {
        // Store the list ID and open modal
        document.getElementById('sectionListId').value = listId;
        document.getElementById('sectionNameInput').value = '';
        document.getElementById('addSectionModal').classList.add('active');
        // Focus on input after modal opens
        setTimeout(() => {
            document.getElementById('sectionNameInput').focus();
        }, 100);
    }
    
    function saveNewSection() {
        const sectionName = document.getElementById('sectionNameInput').value.trim();
        const listId = Number(document.getElementById('sectionListId').value);
        
        if (!sectionName) {
            alert('Please enter a section name');
            return;
        }
        
        const list = lists.find(l => l.id === listId);
        if (!list) return;
        
        // Check if section already exists
        const existingSection = list.items.find(i => i.section === sectionName);
        if (existingSection) {
            alert('A section with this name already exists');
            return;
        }
        
        // Create an empty item to establish the section
        const newItem = {
            id: Date.now(),
            text: '',
            completed: false,
            section: sectionName
        };
        
        list.items.push(newItem);
        localStorage.setItem('lists', JSON.stringify(lists));
        
        closeModal('addSectionModal');
        renderListsColumns();
    }
    
    function toggleSection(listId, sectionId) {
        const sectionElement = document.getElementById(`section-${listId}-${sectionId}`);
        const headerElement = sectionElement.previousElementSibling;
        
        if (sectionElement.classList.contains('collapsed')) {
            sectionElement.classList.remove('collapsed');
            headerElement.classList.remove('collapsed');
        } else {
            sectionElement.classList.add('collapsed');
            headerElement.classList.add('collapsed');
        }
    }
    
    function toggleListItem(listId, itemId) {
        const list = lists.find(l => l.id === listId);
        if (!list) return;
        
        const item = list.items.find(i => i.id === itemId);
        if (item) {
            item.completed = !item.completed;
            localStorage.setItem('lists', JSON.stringify(lists));
            renderListsColumns();
        }
    }
    
    function addListItem() {
        // Legacy function - now replaced by addListItemToList
    }
    
    function openAddListPanel() {
        // Render profile grid
        renderAddListProfileGrid();
        
        document.getElementById('addListPanelOverlay').classList.add('active');
        document.getElementById('addListPanel').classList.add('active');
    }
    
    function closeAddListPanel() {
        document.getElementById('addListPanel').classList.remove('active');
        document.getElementById('addListPanelOverlay').classList.remove('active');
        // Clear form and selection
        document.getElementById('addListName').value = '';
        selectedAddListProfile = null;
    }
    
    function saveNewList() {
        const name = document.getElementById('addListName').value.trim();
        
        if (!name) {
            alert('Please enter a list name');
            return;
        }
        
        if (!selectedAddListProfile) {
            alert('Please select a family member');
            return;
        }
        
        const member = familyMembers.find(m => m.id === selectedAddListProfile);
        
        const newList = {
            id: Date.now(),
            name: name,
            color: member ? member.color : '#4A90E2',
            assignedTo: selectedAddListProfile,
            items: []
        };
        
        lists.push(newList);
        localStorage.setItem('lists', JSON.stringify(lists));
        
        // Reset
        selectedAddListProfile = null;
        document.getElementById('addListName').value = '';
        
        closeAddListPanel();
        renderListsColumns();
    }
    
    // Add List Profile Selection
    let selectedAddListProfile = null;
    
    function renderAddListProfileGrid() {
        const grid = document.getElementById('addListProfileGrid');
        const listMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        let html = '';
        listMembers.forEach(member => {
            html += `<div class="task-profile-item" onclick="selectAddListProfile(${member.id})">
                <div class="task-profile-avatar" id="add-list-avatar-${member.id}" style="background: ${member.color}">
                    ${member.name.charAt(0).toUpperCase()}
                </div>
                <div class="task-profile-name">${member.name}</div>
            </div>`;
        });
        
        grid.innerHTML = html;
    }
    
    function selectAddListProfile(profileId) {
        selectedAddListProfile = profileId;
        // Update visual selection
        document.querySelectorAll('#addListProfileGrid .task-profile-avatar').forEach(avatar => {
            avatar.classList.remove('selected');
        });
        document.getElementById(`add-list-avatar-${profileId}`).classList.add('selected');
    }
    
    // List Item Detail and Edit Functions
    let currentEditListId = null;
    let currentEditListItemId = null;
    
    function openListItemDetail(listId, itemId) {
        currentEditListId = listId;
        currentEditListItemId = itemId;
        
        const list = lists.find(l => l.id === listId);
        if (!list) return;
        
        const item = list.items.find(i => i.id === itemId);
        if (!item) return;
        
        const member = familyMembers.find(m => m.id === list.assignedTo);
        
        // Populate detail modal
        document.getElementById('listItemDetailTitle').textContent = item.text;
        document.getElementById('listItemDetailListName').textContent = list.name;
        
        // Show assigned member
        const assignedHtml = member ? 
            `<div class="task-detail-avatar" style="background: ${member.color}">${member.name.charAt(0).toUpperCase()}</div>
             <span>${member.name}</span>` : 
            '<span>Unassigned</span>';
        document.getElementById('listItemDetailAssignedTo').innerHTML = assignedHtml;
        
        document.getElementById('listItemDetailModal').classList.add('active');
    }
    
    function closeListItemDetail() {
        document.getElementById('listItemDetailModal').classList.remove('active');
    }
    
    function editListItemFromDetail() {
        closeListItemDetail();
        openEditListItemPanel();
    }
    
    function deleteListItemFromDetail() {
        if (!confirm('Are you sure you want to delete this item?')) return;
        
        const list = lists.find(l => l.id === currentEditListId);
        if (!list) return;
        
        const itemIndex = list.items.findIndex(i => i.id === currentEditListItemId);
        if (itemIndex > -1) {
            list.items.splice(itemIndex, 1);
            localStorage.setItem('lists', JSON.stringify(lists));
            closeListItemDetail();
            renderListsColumns();
        }
    }
    
    function openEditListItemPanel() {
        const list = lists.find(l => l.id === currentEditListId);
        if (!list) return;
        
        const item = list.items.find(i => i.id === currentEditListItemId);
        if (!item) return;
        
        document.getElementById('editListItemText').value = item.text || '';
        
        document.getElementById('editListItemPanelOverlay').classList.add('active');
        document.getElementById('editListItemPanel').classList.add('active');
    }
    
    function closeEditListItemPanel() {
        document.getElementById('editListItemPanel').classList.remove('active');
        document.getElementById('editListItemPanelOverlay').classList.remove('active');
    }
    
    function openEditListPanel(listId) {
        currentEditListId = listId;
        
        const list = lists.find(l => l.id === listId);
        if (!list) return;
        
        // Populate form
        document.getElementById('editListName').value = list.name || '';
        
        // Populate assigned to dropdown
        const select = document.getElementById('editListAssignedTo');
        select.innerHTML = familyMembers.map(m => 
            `<option value="${m.id}" ${m.id === list.assignedTo ? 'selected' : ''}>${m.name}</option>`
        ).join('');
        
        document.getElementById('editListPanelOverlay').classList.add('active');
        document.getElementById('editListPanel').classList.add('active');
    }
    
    function closeEditListPanel() {
        document.getElementById('editListPanel').classList.remove('active');
        document.getElementById('editListPanelOverlay').classList.remove('active');
    }
    
    function saveEditedList() {
        const newName = document.getElementById('editListName').value.trim();
        const newAssignedTo = Number(document.getElementById('editListAssignedTo').value);
        
        if (!newName) {
            alert('Please enter a list name');
            return;
        }
        
        const list = lists.find(l => l.id === currentEditListId);
        if (!list) return;
        
        list.name = newName;
        list.assignedTo = newAssignedTo;
        localStorage.setItem('lists', JSON.stringify(lists));
        
        closeEditListPanel();
        // Reset filter to 'all' so the list doesn't disappear after changing owner
        selectedListsPerson = 'all';
        renderFamilyPillsLists();
        renderListsColumns();
    }
    
    function deleteList() {
        if (!confirm('Are you sure you want to delete this list and all its items?')) return;
        
        const index = lists.findIndex(l => l.id === currentEditListId);
        if (index > -1) {
            lists.splice(index, 1);
            localStorage.setItem('lists', JSON.stringify(lists));
            closeEditListPanel();
            renderListsColumns();
        }
    }
    
    function saveEditedListItem() {
        const newText = document.getElementById('editListItemText').value.trim();
        
        if (!newText) {
            alert('Please enter item text');
            return;
        }
        
        const list = lists.find(l => l.id === currentEditListId);
        if (!list) return;
        
        const item = list.items.find(i => i.id === currentEditListItemId);
        if (!item) return;
        
        item.text = newText;
        localStorage.setItem('lists', JSON.stringify(lists));
        
        closeEditListItemPanel();
        renderListsColumns();
    }
    
    // Calendar Filter State
    let calendarFilterActive = [];
    
    function initCalendarFilter() {
        // Initialize all members as active (visible)
        calendarFilterActive = familyMembers.map(m => m.name);
        renderCalendarFilterList();
    }
    
    function renderCalendarFilterList() {
        const list = document.getElementById('calendarFilterList');
        if (!list) return;
        
        let html = '';
        familyMembers.forEach(member => {
            const isActive = calendarFilterActive.includes(member.name);
            html += `
                <div class="calendar-filter-item">
                    <div class="calendar-filter-avatar" style="background: ${member.color}" onclick="toggleCalendarFilterMember('${member.name}')">
                        ${member.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="calendar-filter-info" onclick="toggleCalendarFilterMember('${member.name}')">
                        <div class="calendar-filter-name">${member.name}</div>
                    </div>
                    <button class="calendar-filter-edit-btn" onclick="event.stopPropagation(); openEditProfileModal('${member.name}')" title="Edit profile">
                        ✏️
                    </button>
                    <div class="calendar-filter-toggle ${isActive ? 'active' : ''}" onclick="toggleCalendarFilterMember('${member.name}')"></div>
                </div>
            `;
        });
        list.innerHTML = html;
        
        // Update filter button state
        updateFilterButtonState();
    }
    
    function toggleCalendarFilter() {
        const dropdown = document.getElementById('calendarFilterDropdown');
        dropdown.classList.toggle('active');
    }
    
    function toggleCalendarFilterMember(memberName) {
        const index = calendarFilterActive.indexOf(memberName);
        if (index > -1) {
            calendarFilterActive.splice(index, 1);
        } else {
            calendarFilterActive.push(memberName);
        }
        
        renderCalendarFilterList();
        
        // Re-render current view
        if (currentView === 'month') renderCalendar();
        else if (currentView === 'week') renderWeekView();
        else if (currentView === 'schedule') renderScheduleView();
        else if (currentView === 'day') renderDayView();
    }
    
    function updateFilterButtonState() {
        const btn = document.getElementById('calendarFilterBtn');
        const allActive = calendarFilterActive.length === familyMembers.length;
        
        if (allActive) {
            btn.classList.remove('active');
        } else {
            btn.classList.add('active');
        }
    }
    
    // Edit Profile Functions
    let currentEditProfileName = null;
    const skylightColors = [
        '#FF6B6B', '#FF8E53', '#FFA07A', '#FFB6C1', '#DDA0DD',
        '#DA70D6', '#BA55D3', '#9370DB', '#8A7FD3', '#6495ED',
        '#4A90E2', '#5DADE2', '#48C9B0', '#45B39D', '#52BE80',
        '#58D68D', '#82E0AA', '#F4D03F', '#F7DC6F', '#F8B739',
        '#E67E22', '#DC7633', '#CA6F1E', '#AF7AC5', '#85929E'
    ];
    
    function openEditProfileModal(memberName) {
        currentEditProfileName = memberName;
        const member = familyMembers.find(m => m.name === memberName);
        
        if (!member) return;
        
        document.getElementById('editProfileName').value = member.name;
        renderColorPicker(member.color);
        
        document.getElementById('editProfileModal').classList.add('active');
    }
    
    function closeEditProfileModal() {
        document.getElementById('editProfileModal').classList.remove('active');
        currentEditProfileName = null;
    }
    
    function renderColorPicker(selectedColor) {
        const grid = document.getElementById('colorPickerGrid');
        
        let html = '';
        skylightColors.forEach(color => {
            const isSelected = color === selectedColor;
            html += `
                <div class="color-picker-item ${isSelected ? 'selected' : ''}" 
                     style="background: ${color}" 
                     data-color="${color}"
                     onclick="selectProfileColor('${color}')">
                </div>
            `;
        });
        
        grid.innerHTML = html;
    }
    
    function selectProfileColor(color) {
        const items = document.querySelectorAll('.color-picker-item');
        items.forEach(item => {
            if (item.dataset.color === color) {
                item.classList.add('selected');
            } else {
                item.classList.remove('selected');
            }
        });
    }
    
    function scrollColorPicker(direction) {
        const scroll = document.getElementById('colorPickerScroll');
        const scrollAmount = 200;
        scroll.scrollLeft += direction * scrollAmount;
    }
    
    function saveEditedProfile() {
        const newName = document.getElementById('editProfileName').value.trim();
        const selectedColorItem = document.querySelector('.color-picker-item.selected');
        const newColor = selectedColorItem ? selectedColorItem.dataset.color : null;
        
        if (!newName) {
            alert('Please enter a profile name');
            return;
        }
        
        if (!newColor) {
            alert('Please select a color');
            return;
        }
        
        const member = familyMembers.find(m => m.name === currentEditProfileName);
        if (!member) return;
        
        const oldName = member.name;
        
        // Update member
        member.name = newName;
        member.color = newColor;
        
        // Update localStorage
        localStorage.setItem('familyMembers', JSON.stringify(familyMembers));
        
        // Update all references in other data
        updateMemberReferences(oldName, newName);
        
        // Update calendar filter
        const filterIndex = calendarFilterActive.indexOf(oldName);
        if (filterIndex > -1) {
            calendarFilterActive[filterIndex] = newName;
        }
        
        closeEditProfileModal();
        renderCalendarFilterList();
        
        // Re-render current view
        if (currentView === 'month') renderCalendar();
        else if (currentView === 'week') renderWeekView();
        else if (currentView === 'schedule') renderScheduleView();
        else if (currentView === 'day') renderDayView();
    }
    
    function updateMemberReferences(oldName, newName) {
        // Update events
        events.forEach(event => {
            if (event.member === oldName) {
                event.member = newName;
            }
        });
        localStorage.setItem('events', JSON.stringify(events));
        
        // Update tasks
        tasks.forEach(task => {
            if (task.member === oldName) {
                task.member = newName;
            }
        });
        localStorage.setItem('tasks', JSON.stringify(tasks));
        
        // Update chores
        chores.forEach(chore => {
            if (chore.member === oldName) {
                chore.member = newName;
            }
        });
        localStorage.setItem('chores', JSON.stringify(chores));
        
        // Update routines
        routines.forEach(routine => {
            if (routine.member === oldName) {
                routine.member = newName;
            }
        });
        localStorage.setItem('routines', JSON.stringify(routines));
        
        // Update rewards
        rewards.forEach(reward => {
            if (reward.member === oldName) {
                reward.member = newName;
            }
        });
        localStorage.setItem('rewards', JSON.stringify(rewards));
        
        // Update lists
        lists.forEach(list => {
            if (familyMembers.find(m => m.id === list.assignedTo && m.name === oldName)) {
                const member = familyMembers.find(m => m.name === newName);
                if (member) list.assignedTo = member.id;
            }
        });
        localStorage.setItem('lists', JSON.stringify(lists));
    }
    
    function isEventVisible(event) {
        // If no member assigned, always show
        if (!event.member) return true;
        
        // Check if event's member is in active filter
        return calendarFilterActive.includes(event.member);
    }
    
    // Close filter dropdown when clicking outside
    document.addEventListener('click', function(e) {
        const dropdown = document.getElementById('calendarFilterDropdown');
        const btn = document.getElementById('calendarFilterBtn');
        if (dropdown && btn && !btn.contains(e.target)) {
            dropdown.classList.remove('active');
        }
    });
    
    // Utility function to convert hex color to rgba
    function hexToRgba(hex, alpha) {
        // Remove # if present
        hex = hex.replace('#', '');
        
        // Convert to RGB
        const r = parseInt(hex.substring(0, 2), 16);
        const g = parseInt(hex.substring(2, 4), 16);
        const b = parseInt(hex.substring(4, 6), 16);
        
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }
    
    function init() {
        updateDateTime();
        updateWeather();
        renderFamilyMembers();
        initCalendarFilter();
        
        // Initialize sample chores if none exist
        if (chores.length === 0) {
            initializeSampleChores();
        }
        
        // Initialize sample routines if none exist
        if (routines.length === 0) {
            initializeSampleRoutines();
        }
        
        // Initialize sample recipes
        initializeSampleRecipes();
        
        // Initialize sample lists
        initializeSampleLists();
        
        // Initialize sample rewards if none exist
        if (rewards.length === 0) {
            initializeSampleRewards();
        }
        
        switchSection('calendar');
        setInterval(updateDateTime, 1000);
        setInterval(updateWeather, 1800000); // Update every 30 minutes
        
        // Check for stored auth on startup
        checkStoredAuth();
    }
    
    function initializeSampleRoutines() {
        const sampleRoutines = [
            // Mary routines - Morning
            { id: Date.now() + 100, member: 'Mary', period: 'Morning', title: 'Brush teeth', icon: '🪥', completed: false, stars: 10 },
            { id: Date.now() + 101, member: 'Mary', period: 'Morning', title: 'Get dressed', icon: '👕', completed: false },
            { id: Date.now() + 102, member: 'Mary', period: 'Morning', title: 'Make bed', icon: '🛏️', completed: false },
            { id: Date.now() + 103, member: 'Mary', period: 'Morning', title: 'Wash face', icon: '🧼', completed: false },
            
            // Bret routines - Morning
            { id: Date.now() + 110, member: 'Bret', period: 'Morning', title: 'Brush teeth', icon: '🪥', completed: false },
            { id: Date.now() + 111, member: 'Bret', period: 'Morning', title: 'Get dressed', icon: '👕', completed: false },
            { id: Date.now() + 112, member: 'Bret', period: 'Morning', title: 'Make bed', icon: '🛏️', completed: false },
            
            // Levi routines - Morning
            { id: Date.now() + 120, member: 'Levi', period: 'Morning', title: 'Brush teeth', icon: '🪥', completed: false },
            { id: Date.now() + 121, member: 'Levi', period: 'Morning', title: 'Get dressed', icon: '👕', completed: false },
            { id: Date.now() + 122, member: 'Levi', period: 'Morning', title: 'Make bed', icon: '🛏️', completed: false },
            { id: Date.now() + 123, member: 'Levi', period: 'Morning', title: 'Wash face', icon: '🧼', completed: false },
            
            // Elsie routines - Morning
            { id: Date.now() + 130, member: 'Elsie', period: 'Morning', title: 'Brush teeth', icon: '🪥', completed: false },
            { id: Date.now() + 131, member: 'Elsie', period: 'Morning', title: 'Get dressed', icon: '👕', completed: false },
            { id: Date.now() + 132, member: 'Elsie', period: 'Morning', title: 'Make bed', icon: '🛏️', completed: false },
        ];
        
        routines = sampleRoutines;
        localStorage.setItem('routines', JSON.stringify(routines));
    }
    
    function initializeSampleChores() {
        const sampleChores = [
            // Mary chores
            { id: Date.now() + 1, member: 'Mary', title: 'Water plants', frequency: 'Daily', icon: '💧', completed: false, stars: 5 },
            { id: Date.now() + 2, member: 'Mary', title: 'Pack lunches', frequency: 'Daily', icon: '🍱', completed: false, stars: 5 },
            { id: Date.now() + 3, member: 'Mary', title: 'Load dishwasher', frequency: 'Daily', completed: false, stars: 5 },
            { id: Date.now() + 4, member: 'Mary', title: 'Grocery Run', frequency: 'Weekly', icon: '🛒', completed: false, stars: 5 },
            { id: Date.now() + 5, member: 'Mary', title: 'Sweep kitchen', frequency: 'Daily', icon: '🧹', completed: false, stars: 5 },
            { id: Date.now() + 6, member: 'Mary', title: 'Laundry', frequency: 'Daily', icon: '🧺', completed: false, stars: 5 },
            
            // Bret chores
            { id: Date.now() + 7, member: 'Bret', title: 'Laundry', frequency: 'Weekly', icon: '🧺', completed: false, stars: 250 },
            { id: Date.now() + 8, member: 'Bret', title: 'Sign Permission Slip', frequency: 'Daily', icon: '⭐', completed: false, stars: 5 },
            { id: Date.now() + 9, member: 'Bret', title: 'Mow lawn', frequency: 'Weekly', icon: '🌱', completed: false, stars: 5 },
            { id: Date.now() + 10, member: 'Bret', title: 'Litter box', frequency: 'Daily', icon: '💩', completed: false, stars: 5 },
            { id: Date.now() + 11, member: 'Bret', title: 'Clean Bathrooms', frequency: 'Weekly', icon: '🚿', completed: false, stars: 10 },
            { id: Date.now() + 12, member: 'Bret', title: 'Unload dishwasher', frequency: 'Daily', completed: true, stars: 5 },
            
            // Levi chores
            { id: Date.now() + 13, member: 'Levi', title: 'Feed Cleo', frequency: 'Daily', icon: '⭐', completed: false, stars: 5 },
            { id: Date.now() + 14, member: 'Levi', title: 'Get the mail', frequency: 'Daily', icon: '📬', completed: false, stars: 10 },
            { id: Date.now() + 15, member: 'Levi', title: 'Make Bed', frequency: 'Daily', icon: '🛏️', completed: false, stars: 5 },
            { id: Date.now() + 16, member: 'Levi', title: 'Brush Teeth', frequency: 'Daily', icon: '🪥', completed: false, stars: 5 },
            
            // Elsie chores
            { id: Date.now() + 17, member: 'Elsie', title: 'Feed Cleo', frequency: 'Daily', icon: '⭐', completed: false, stars: 5 },
            { id: Date.now() + 18, member: 'Elsie', title: 'Water plants', frequency: 'Daily', icon: '💧', completed: false, stars: 5 },
            { id: Date.now() + 19, member: 'Elsie', title: 'Make Bed', frequency: 'Daily', icon: '🛏️', completed: false, stars: 5 },
        ];
        
        chores = sampleChores;
        localStorage.setItem('chores', JSON.stringify(chores));
    }
    
    function initializeSampleRewards() {
        const sampleRewards = [
            // Mary rewards
            { id: Date.now() + 1, member: 'Mary', title: 'Bagel run', emoji: '🥯', starsNeeded: 20, redeemed: false },
            { id: Date.now() + 2, member: 'Mary', title: 'New purse', emoji: '👜', starsNeeded: 300, redeemed: false },
            
            // Bret rewards
            { id: Date.now() + 3, member: 'Bret', title: 'Mini golf with Dad', emoji: '⛳', starsNeeded: 30, redeemed: false },
            { id: Date.now() + 4, member: 'Bret', title: 'New video game', emoji: '🎮', starsNeeded: 100, redeemed: false },
            
            // Levi rewards
            { id: Date.now() + 5, member: 'Levi', title: 'Gummy worms', emoji: '🪱', starsNeeded: 25, redeemed: false },
            { id: Date.now() + 6, member: 'Levi', title: 'Pick out a new toy', emoji: '🧸', starsNeeded: 30, redeemed: false },
            
            // Elsie rewards
            { id: Date.now() + 7, member: 'Elsie', title: 'Girls movie night', emoji: '🍿', starsNeeded: 20, redeemed: false },
            { id: Date.now() + 8, member: 'Elsie', title: 'Beach day', emoji: '🏖️', starsNeeded: 40, redeemed: false },
        ];
        
        rewards = sampleRewards;
        localStorage.setItem('rewards', JSON.stringify(rewards));
    }
    
    function checkStoredAuth() {
        const storedToken = localStorage.getItem('googleCalendarToken');
        const tokenExpiry = localStorage.getItem('googleCalendarTokenExpiry');
        
        if (storedToken && tokenExpiry) {
            const expiryTime = parseInt(tokenExpiry);
            const now = Date.now();
            
            // Check if token is still valid (with 5 minute buffer)
            if (expiryTime > now + (5 * 60 * 1000)) {
                // Token is still valid, restore it
                console.log('Restoring saved Google Calendar session...');
                restoreGoogleSession(storedToken);
            } else {
                // Token expired, clear it
                console.log('Saved token expired, clearing...');
                localStorage.removeItem('googleCalendarToken');
                localStorage.removeItem('googleCalendarTokenExpiry');
            }
        }
    }
    
    function restoreGoogleSession(token) {
        // Wait for gapi to be ready
        const checkGapi = setInterval(() => {
            if (gapiInited) {
                clearInterval(checkGapi);
                
                // Set the token in gapi client
                gapi.client.setToken({
                    access_token: token
                });
                
                isGoogleConnected = true;
                loadGoogleCalendarEvents();
            }
        }, 100);
    }

    function gapiLoaded() {
        if (typeof gapi !== 'undefined') {
            gapi.load('client', initializeGapiClient);
        }
    }

    async function initializeGapiClient() {
        try {
            await gapi.client.init({
                discoveryDocs: [DISCOVERY_DOC],
            });
            gapiInited = true;
        } catch (err) {
            console.error('Error initializing Google API:', err);
            // Set to true anyway - OAuth popup works without full gapi init
            gapiInited = true;
        }
    }

    function gisLoaded() {
        if (typeof google !== 'undefined' && google.accounts) {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: SCOPES,
                callback: async (response) => {
                    if (response.error !== undefined) {
                        console.error('Google auth error:', response);
                        return;
                    }
                    
                    // Store the token
                    if (response.access_token) {
                        localStorage.setItem('googleCalendarToken', response.access_token);
                        const expiryTime = Date.now() + (3600 * 1000);
                        localStorage.setItem('googleCalendarTokenExpiry', expiryTime.toString());
                        console.log('Google Calendar token saved');
                        
                        // Set token in gapi if available
                        if (typeof gapi !== 'undefined' && gapi.client && gapi.client.setToken) {
                            gapi.client.setToken({
                                access_token: response.access_token
                            });
                        }
                    }
                    
                    isGoogleConnected = true;
                    await loadGoogleCalendarEvents();
                    console.log('Google Calendar connected and synced');
                }
            });
            gisInited = true;
        }
    }
    
    // Check for OAuth hash fragment on page load (not used with popup, but keeping for compatibility)
    function checkOAuthRedirect() {
        const hash = window.location.hash;
        if (hash) {
            const params = new URLSearchParams(hash.substring(1));
            const accessToken = params.get('access_token');
            const expiresIn = params.get('expires_in');
            
            if (accessToken) {
                localStorage.setItem('googleCalendarToken', accessToken);
                const expiryTime = Date.now() + (parseInt(expiresIn || '3600') * 1000);
                localStorage.setItem('googleCalendarTokenExpiry', expiryTime.toString());
                console.log('Google Calendar token received and saved');
                
                window.history.replaceState({}, document.title, window.location.pathname);
                
                isGoogleConnected = true;
                loadGoogleCalendarEvents();
            }
        }
    }
    
    // Load Google APIs when script loads
    window.addEventListener('load', () => {
        setTimeout(() => {
            gapiLoaded();
            gisLoaded();
            checkOAuthRedirect();
            // Auto-connect to Google Calendar if credentials are set
            if (CLIENT_ID !== 'YOUR_CLIENT_ID_HERE') {
                // Only try auto-connect if not already connected and no stored token
                const storedToken = localStorage.getItem('googleCalendarToken');
                if (!storedToken && !isGoogleConnected) {
                    setTimeout(connectGoogleCalendar, 2000);
                }
            }
        }, 1000);
    });

    function connectGoogleCalendar() {
        if (!gapiInited || !gisInited) {
            console.log('Google Calendar is still loading...');
            return;
        }
        
        // Use the token client which handles the OAuth flow
        tokenClient.requestAccessToken({prompt: 'consent'});
    }

    async function loadGoogleCalendarEvents() {
        try {
            googleCalendarEvents = [];
            const token = localStorage.getItem('googleCalendarToken');
            
            if (!token) {
                console.error('No access token available');
                return;
            }
            
            // Get list of all calendars using fetch
            const calendarListResponse = await fetch('https://www.googleapis.com/calendar/v3/users/me/calendarList', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!calendarListResponse.ok) {
                throw new Error(`Calendar list fetch failed: ${calendarListResponse.status}`);
            }
            
            const calendarListData = await calendarListResponse.json();
            const calendars = calendarListData.items;
            
            // Find the Family calendar
            const familyCalendar = calendars.find(cal => 
                cal.summary.toLowerCase() === 'family' || 
                (cal.summaryOverride && cal.summaryOverride.toLowerCase() === 'family')
            );
            
            // Load events from primary calendar
            await loadEventsFromCalendar('primary', '');
            
            // Load events from Family calendar if it exists
            if (familyCalendar) {
                await loadEventsFromCalendar(familyCalendar.id, 'Family');
            }
            
            // Re-render calendar with Google events
            if (currentView === 'month') renderCalendar();
            else if (currentView === 'week') renderWeekView();
            else if (currentView === 'schedule') renderScheduleView();
            else if (currentView === 'day') renderDayView();
            
            console.log('Google Calendar synced successfully');
            
        } catch (err) {
            console.error('Error loading Google Calendar events:', err);
            // If there's an auth error, clear stored token
            if (err.message && (err.message.includes('401') || err.message.includes('403'))) {
                localStorage.removeItem('googleCalendarToken');
                localStorage.removeItem('googleCalendarTokenExpiry');
                isGoogleConnected = false;
            }
        }
    }
    
    async function loadEventsFromCalendar(calendarId, memberName) {
        const token = localStorage.getItem('googleCalendarToken');
        
        // Load events from 1 month ago to 2 months in the future to cover all views
        const timeMin = new Date(currentDate.getFullYear(), currentDate.getMonth() - 1, 1).toISOString();
        const timeMax = new Date(currentDate.getFullYear(), currentDate.getMonth() + 2, 0, 23, 59, 59).toISOString();
        
        const url = `https://www.googleapis.com/calendar/v3/calendars/${encodeURIComponent(calendarId)}/events?` +
            `timeMin=${encodeURIComponent(timeMin)}&` +
            `timeMax=${encodeURIComponent(timeMax)}&` +
            `showDeleted=false&singleEvents=true&maxResults=100&orderBy=startTime`;
        
        const response = await fetch(url, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (!response.ok) {
            throw new Error(`Events fetch failed: ${response.status}`);
        }
        
        const data = await response.json();
        const events = data.items || [];
        
        events.forEach(event => {
            const start = event.start.dateTime || event.start.date;
            const startDate = new Date(start);
            const title = event.summary;
            
            console.log('Google Calendar event:', title);
            
            // Try to auto-assign based on title first
            let assignedMember = autoAssignEventMember(title);
            
            // If no name found in title, use the calendar's member name as fallback
            if (!assignedMember) {
                assignedMember = memberName || '';
                console.log('No name in title, using calendar default:', assignedMember);
            } else {
                console.log('Auto-assigned from title to:', assignedMember);
            }
            
            googleCalendarEvents.push({
                id: event.id + '_' + calendarId,
                title: title,
                date: startDate.toISOString().split('T')[0],
                time: event.start.dateTime ? startDate.toTimeString().substring(0, 5) : null,
                notes: event.description || '',
                member: assignedMember,
                isGoogle: true
            });
        });
    }

    function getAllEvents() {
        return [...events, ...googleCalendarEvents];
    }

    function updateDateTime() {
        const now = new Date();
        const dateOptions = { month: 'long', day: 'numeric' };
        document.getElementById('dateDisplay').textContent = now.toLocaleDateString('en-US', dateOptions);
        document.getElementById('timeDisplay').textContent = now.toLocaleTimeString('en-US', { 
            hour: 'numeric', 
            minute: '2-digit' 
        });
    }

    async function updateWeather() {
        try {
            const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=33.4484&longitude=-112.0740&current=temperature_2m,weather_code&temperature_unit=fahrenheit&timezone=America/Phoenix');
            const data = await response.json();
            const temp = Math.round(data.current.temperature_2m);
            const weatherCode = data.current.weather_code;
            const weatherEmoji = getWeatherEmoji(weatherCode);
            document.getElementById('weatherDisplay').textContent = `${weatherEmoji} ${temp}°F`;
        } catch (error) {
            document.getElementById('weatherDisplay').textContent = 'Weather unavailable';
        }
    }

    function getWeatherEmoji(code) {
        if (code === 0) return '☀️';
        if (code <= 3) return '⛅';
        if (code <= 67) return '🌧️';
        if (code <= 77) return '🌨️';
        return '🌤️';
    }

    function renderFamilyMembers() {
        const container = document.getElementById('familyMembers');
        container.innerHTML = familyMembers.map(member => 
            `<div class="member" style="background: ${member.color}20; border-left: 4px solid ${member.color}">
                <strong>${member.name}</strong>
            </div>`
        ).join('');

        // Update dropdowns
        const selects = document.querySelectorAll('#eventMember, #taskMember');
        selects.forEach(select => {
            select.innerHTML = '<option value="">Select Family Member</option>' +
                familyMembers.map(m => `<option value="${m.name}">${m.name}</option>`).join('');
        });
    }

    function addFamilyMember() {
        const name = prompt('Enter family member name:');
        if (name) {
            const colors = ['#FF6B6B', '#4ECDC4', '#FFE66D', '#95E1D3', '#F38181', '#AA96DA'];
            const color = colors[familyMembers.length % colors.length];
            familyMembers.push({ name, color });
            localStorage.setItem('familyMembers', JSON.stringify(familyMembers));
            if (currentSection === 'calendar') {
                renderFamilyPills();
            }
            renderPersonAvatars();
            
            // Update dropdowns
            const selects = document.querySelectorAll('#eventMember, #taskMember');
            selects.forEach(select => {
                select.innerHTML = '<option value="">Select Family Member</option>' +
                    familyMembers.map(m => `<option value="${m.name}">${m.name}</option>`).join('');
            });
        }
    }

    function renderPersonAvatars() {
        const container = document.getElementById('personAvatars');
        if (!container) return;
        
        container.innerHTML = familyMembers.filter(m => !m.isGoogleCalendar).map(member => {
            const initial = member.name.charAt(0).toUpperCase();
            return `<div class="person-avatar" style="background: ${member.color}" onclick="viewPersonTasks('${member.name}')">
                ${initial}
            </div>`;
        }).join('');
    }

    function viewPersonTasks(memberName) {
        // Switch to tasks section and filter by person
        switchSection('tasks');
        // You can add filtering logic here if desired
    }

    function renderCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        
        document.getElementById('monthYear').textContent = 
            new Date(year, month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();

        const grid = document.getElementById('calendarGrid');
        grid.innerHTML = `
            <div class="day-header">Sun</div>
            <div class="day-header">Mon</div>
            <div class="day-header">Tue</div>
            <div class="day-header">Wed</div>
            <div class="day-header">Thu</div>
            <div class="day-header">Fri</div>
            <div class="day-header">Sat</div>
        `;

        for (let i = firstDay - 1; i >= 0; i--) {
            const day = daysInPrevMonth - i;
            grid.innerHTML += `<div class="day-cell other-month"><div class="day-number">${day}</div></div>`;
        }

        const today = new Date();
        const allEvents = getAllEvents();
        
        for (let day = 1; day <= daysInMonth; day++) {
            const isToday = day === today.getDate() && month === today.getMonth() && year === today.getFullYear();
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const dayEvents = allEvents.filter(e => e.date === dateStr && isEventVisible(e)).sort((a, b) => {
                if (!a.time) return -1;
                if (!b.time) return 1;
                return a.time.localeCompare(b.time);
            });

            let eventsHtml = '';
            dayEvents.slice(0, 3).forEach(event => {
                const member = familyMembers.find(m => m.name === event.member);
                const color = (member && member.color) || '#667eea';
                const bgColor = color + '40'; // Add transparency like week view
                
                // Format time to 12-hour format
                let timeStr = '';
                if (event.time) {
                    const [hours, minutes] = event.time.split(':').map(Number);
                    const period = hours >= 12 ? 'PM' : 'AM';
                    const displayHours = hours % 12 || 12;
                    timeStr = `${displayHours}:${String(minutes).padStart(2, '0')} ${period}`;
                } else {
                    timeStr = 'All day';
                }
                
                eventsHtml += `
                    <div class="day-event-item" style="background: ${bgColor}; color: #000;" onclick="event.stopPropagation(); showEventDetails('${event.id}')">
                        <span class="day-event-time">${timeStr}</span>
                        <span class="day-event-title">${event.title}</span>
                    </div>
                `;
            });

            if (dayEvents.length > 3) {
                eventsHtml += `<div class="day-event-item" style="color: #999;">${dayEvents.length - 3} More...</div>`;
            }

            grid.innerHTML += `
                <div class="day-cell ${isToday ? 'today' : ''}" onclick="showDayEvents('${dateStr}')">
                    <div class="day-number">${day}</div>
                    <div class="day-events">${eventsHtml}</div>
                </div>
            `;
        }

        const remainingCells = 42 - (firstDay + daysInMonth);
        for (let day = 1; day <= remainingCells; day++) {
            grid.innerHTML += `<div class="day-cell other-month"><div class="day-number">${day}</div></div>`;
        }
    }

    function navigateMonth(direction) {
        currentDate.setMonth(currentDate.getMonth() + direction);
        renderCalendar();
    }

    function navigateView(direction) {
        if (currentSection === 'meals') {
            navigateMealWeek(direction);
        } else if (currentView === 'month') {
            currentDate.setMonth(currentDate.getMonth() + direction);
            renderCalendar();
        } else if (currentView === 'week') {
            currentDate.setDate(currentDate.getDate() + (direction * 7));
            renderWeekView();
        } else if (currentView === 'schedule') {
            currentDate.setDate(currentDate.getDate() + (direction * scheduleDaysToShow));
            renderScheduleView();
        } else if (currentView === 'day') {
            currentDate.setDate(currentDate.getDate() + direction);
            renderDayView();
        }
        updateViewHeader();
    }

    function updateViewHeader() {
        const todayNav = document.getElementById('todayNav');
        const monthNav = document.getElementById('monthNav');
        const weekNav = document.getElementById('weekNav');
        const monthDisplay = document.getElementById('monthDisplay');
        const weekDisplay = document.getElementById('weekDisplay');
        
        // Hide all navs first
        todayNav.classList.remove('active');
        monthNav.classList.remove('active');
        weekNav.classList.remove('active');
        
        if (currentSection === 'meals') {
            // Meals section: show only today nav
            todayNav.classList.add('active');
        } else if (currentView === 'month') {
            // Month view: show view dropdown + month nav
            monthNav.classList.add('active');
            monthDisplay.textContent = currentDate.toLocaleDateString('en-US', { month: 'long' });
            
        } else if (currentView === 'week') {
            // Week view: show week nav with date range
            weekNav.classList.add('active');
            const weekStart = getWeekStart(currentDate);
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            
            const startDay = weekStart.toLocaleDateString('en-US', { weekday: 'short' });
            const startDate = weekStart.getDate();
            const endDate = weekEnd.getDate();
            
            weekDisplay.textContent = `${startDay} ${startDate}-${endDate}`;
            
        } else if (currentView === 'day') {
            // Day view: show view dropdown + today nav
            todayNav.classList.add('active');
            
        } else if (currentView === 'schedule') {
            // Schedule view: show only view dropdown (no additional nav)
        }
    }

    function getWeekStart(date) {
        const d = new Date(date);
        const day = d.getDay();
        const diff = d.getDate() - day;
        return new Date(d.setDate(diff));
    }

    function renderWeekView() {
        const container = document.getElementById('weekView');
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const weekStart = new Date(currentDate);
        const weekDays = [];
        
        // Get 7 days starting from currentDate
        for (let i = 0; i < 7; i++) {
            const day = new Date(weekStart);
            day.setDate(weekStart.getDate() + i);
            weekDays.push(day);
        }
        
        let html = '<div class="simple-week-grid">';
        
        // Render 7 day boxes
        weekDays.forEach(day => {
            const isToday = day.getTime() === today.getTime();
            const dayName = day.toLocaleDateString('en-US', { weekday: 'short' });
            const dayNum = day.getDate();
            const dateStr = day.toISOString().split('T')[0];
            
            html += `<div class="simple-week-day" onclick="openEventModalForDate('${dateStr}')">
                <div class="simple-week-day-header ${isToday ? 'today' : ''}">
                    <div class="week-day-name">${dayName}</div>
                    <div class="week-day-number">${dayNum}</div>
                </div>
                <div class="simple-week-add-btn">+ Add Event</div>
            </div>`;
        });
        
        // Add "Next Week" box
        const nextWeekDate = new Date(weekStart);
        nextWeekDate.setDate(nextWeekDate.getDate() + 7);
        html += `<div class="simple-week-day simple-week-next-week" onclick="navigateView(1)">
            Next Week
        </div>`;
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    function renderDayView() {
        const container = document.getElementById('dayView');
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        const viewDate = new Date(currentDate);
        viewDate.setHours(0, 0, 0, 0);
        const dateStr = viewDate.toISOString().split('T')[0];
        const isToday = viewDate.getTime() === today.getTime();
        
        const dayName = viewDate.toLocaleDateString('en-US', { weekday: 'long' });
        const dayNum = viewDate.getDate();
        const monthName = viewDate.toLocaleDateString('en-US', { month: 'long' });
        
        const allEvents = getAllEvents();
        const dayEvents = allEvents.filter(e => e.date === dateStr && isEventVisible(e)).sort((a, b) => {
            if (!a.time) return -1;
            if (!b.time) return 1;
            return a.time.localeCompare(b.time);
        });
        
        let html = '<div class="day-view-container">';
        
        // Day header
        html += `<div class="day-view-header">
            <div class="day-view-title ${isToday ? 'today' : ''}">
                <div class="week-day-name">${dayName}</div>
                <div class="week-day-number">${dayNum}</div>
            </div>
            <div class="day-view-month">${monthName}</div>
        </div>`;
        
        // Events list
        if (dayEvents.length === 0) {
            html += `<div style="text-align: center; color: #999; padding: 40px; font-style: italic;">No events for this day</div>`;
        } else {
            html += '<div class="day-view-events">';
            dayEvents.forEach(event => {
                const member = familyMembers.find(m => m.name === event.member);
                const color = (member && member.color) || '#667eea';
                const initial = member ? member.name.charAt(0).toUpperCase() : '';
                
                html += `<div class="day-view-event" style="background: ${color}40; border-left-color: ${color}" onclick="showEventDetails('${event.id}')">
                    <div class="day-view-event-time">${event.time || 'All day'}</div>
                    <div class="day-view-event-title">${event.title}</div>
                    ${event.member ? `<div class="day-view-event-member">${event.member}</div>` : ''}
                    ${initial ? `<div class="day-view-event-dot" style="background: ${color}">${initial}</div>` : ''}
                </div>`;
            });
            html += '</div>';
        }
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    function formatTime(time) {
        if (!time) return '';
        const [hours, minutes] = time.split(':').map(Number);
        const period = hours >= 12 ? 'PM' : 'AM';
        const displayHours = hours % 12 || 12;
        return `${displayHours}:${String(minutes).padStart(2, '0')} ${period}`;
    }

    function renderScheduleView() {
        const container = document.getElementById('scheduleContainer');
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Get the week start to calculate next week's dates
        const weekStart = getWeekStart(currentDate);
        const nextWeekStart = new Date(weekStart);
        nextWeekStart.setDate(nextWeekStart.getDate() + 7);
        const nextWeekEnd = new Date(nextWeekStart);
        nextWeekEnd.setDate(nextWeekEnd.getDate() + 6);
        
        const nextWeekStartStr = nextWeekStart.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
        const nextWeekEndStr = nextWeekEnd.toLocaleDateString('en-US', { month: 'long', day: 'numeric' });
        
        let html = '';
        
        for (let i = 0; i < scheduleDaysToShow; i++) {
            const day = new Date(currentDate);
            day.setDate(currentDate.getDate() + i);
            day.setHours(0, 0, 0, 0);
            
            const dateStr = day.toISOString().split('T')[0];
            const isToday = day.getTime() === today.getTime();
            const dayName = day.toLocaleDateString('en-US', { weekday: 'short' });
            const dayNum = day.getDate();
            
            const allEvents = getAllEvents();
            const dayEvents = allEvents.filter(e => e.date === dateStr && isEventVisible(e)).sort((a, b) => {
                if (!a.time) return -1;
                if (!b.time) return 1;
                return a.time.localeCompare(b.time);
            });

            html += `<div class="schedule-day-column">`;
            
            // Header with day title and add button
            html += `<div class="schedule-day-header">
                <div class="schedule-day-title ${isToday ? 'today' : ''}">
                    <div class="week-day-name">${dayName}</div>
                    <div class="week-day-number">${dayNum}</div>
                </div>
                <button class="schedule-add-btn" onclick="openEventModalForDate('${dateStr}')">+ Add Event</button>
            </div>`;
            
            if (dayEvents.length === 0) {
                html += `<div style="text-align: center; color: #999; padding: 20px; font-style: italic;">No events</div>`;
            } else {
                html += '<div class="schedule-event-list">';
                dayEvents.forEach(event => {
                    const member = familyMembers.find(m => m.name === event.member);
                    const color = (member && member.color) || '#667eea';
                    const initial = member ? member.name.charAt(0).toUpperCase() : '';
                    
                    html += `<div class="schedule-event" style="background: ${color}40; border-left-color: ${color}" onclick="showEventDetails('${event.id}')">
                        <div class="schedule-event-content">
                            <div class="schedule-event-time">${event.time || 'All day'}</div>
                            <div class="schedule-event-title">${event.title}</div>
                            ${event.member ? `<div class="schedule-event-member">${event.member}</div>` : ''}
                        </div>
                        ${initial ? `<div class="schedule-event-dot" style="background: ${color}">${initial}</div>` : ''}
                    </div>`;
                });
                html += '</div>';
            }
            
            html += '</div>';
        }
        
        container.innerHTML = html;
    }

    function switchSection(section) {
        currentSection = section;
        
        // Update nav highlighting
        document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
        if (event && event.target) {
            event.target.closest('.nav-item').classList.add('active');
        } else {
            // If no event (called programmatically), find the nav item by section name
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.textContent.toLowerCase().includes(section)) {
                    item.classList.add('active');
                }
            });
        }
        
        const contentArea = document.getElementById('contentArea');
        
        // Hide all floating buttons
        document.getElementById('floatingAddBtn').classList.remove('active');
        document.getElementById('floatingAddTaskBtn').classList.remove('active');
        
        // Show relevant sections based on navigation
        if (section === 'calendar') {
            // Reset display styles that may have been set by other sections
            document.getElementById('monthNav').style.display = '';
            document.getElementById('todayNav').style.display = '';
            document.getElementById('mainViewSelector').style.display = '';
            
            contentArea.innerHTML = `
                <div class="family-pills" id="familyPills"></div>
                
                <div class="calendar-grid" id="calendarGrid"></div>
                
                <div class="week-view" id="weekView"></div>
                
                <div class="schedule-view" id="scheduleView">
                    <div class="schedule-container" id="scheduleContainer"></div>
                </div>
                
                <div class="day-view" id="dayView"></div>
            `;
            renderFamilyPills();
            renderCalendar();
            updateViewHeader();
            // Show floating add event button
            document.getElementById('floatingAddBtn').classList.add('active');
        } else if (section === 'chores') {
            // Hide calendar navigation
            document.getElementById('monthNav').style.display = 'none';
            document.getElementById('todayNav').style.display = 'none';
            document.getElementById('mainViewSelector').style.display = 'none';
            
            contentArea.innerHTML = `
                <div class="chores-container" id="choresContainer"></div>
            `;
            renderChoresView();
            // Show floating add task button
            document.getElementById('floatingAddTaskBtn').classList.add('active');
        } else if (section === 'rewards') {
            // Hide calendar navigation
            document.getElementById('monthNav').style.display = 'none';
            document.getElementById('todayNav').style.display = 'none';
            document.getElementById('mainViewSelector').style.display = 'none';
            
            contentArea.innerHTML = `
                <div class="rewards-container" id="rewardsContainer"></div>
            `;
            renderRewardsView();
            // Show floating add task button for adding rewards
            document.getElementById('floatingAddTaskBtn').classList.add('active');
        } else if (section === 'meals') {
            // Show Today navigation in the existing header
            document.getElementById('monthNav').style.display = 'none';
            document.getElementById('todayNav').style.display = 'flex';
            document.getElementById('mainViewSelector').style.display = 'none';
            
            contentArea.innerHTML = `<div id="mealPlanGrid"></div>`;
            renderMealPlanGrid();
            updateViewHeader();
        } else if (section === 'photos') {
            contentArea.innerHTML = `
                <div class="section-title">Photos</div>
                <p style="color: #999; padding: 20px; text-align: center;">Photos feature coming soon!</p>
            `;
        } else if (section === 'lists') {
            document.getElementById('monthNav').style.display = 'none';
            document.getElementById('todayNav').style.display = 'none';
            document.getElementById('mainViewSelector').style.display = 'none';
            document.getElementById('floatingAddTaskBtn').classList.add('active');
            
            contentArea.innerHTML = `
                <div id="listsColumnsContainer" class="chores-columns"></div>
            `;
            renderListsColumns();
        }
    }

    function renderFamilyPills() {
        const container = document.getElementById('familyPills');
        if (!container) return;
        
        container.innerHTML = familyMembers.map(member => {
            const initial = member.name.charAt(0).toUpperCase();
            
            // Get today's date
            const today = new Date().toISOString().split('T')[0];
            
            // For Google Calendar members, don't show task count
            if (member.isGoogleCalendar) {
                return `
                    <div class="family-pill" style="background: ${member.color}20; color: ${member.color}">
                        <div class="family-pill-content">
                            <div class="family-pill-avatar" style="background: ${member.color}">
                                ${initial}
                            </div>
                            <div class="family-pill-info">
                                <div class="family-pill-name">${member.name}</div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Count tasks for this member today
            const memberTasks = tasks.filter(t => t.member === member.name && t.date === today);
            const completedTasks = memberTasks.filter(t => t.completed).length;
            const totalTasks = memberTasks.length;
            
            // Calculate progress percentage
            const progressPercent = totalTasks > 0 ? (completedTasks / totalTasks) * 100 : 0;
            
            return `
                <div class="family-pill" style="background: ${member.color}20; color: ${member.color}">
                    <div class="family-pill-progress" style="background: ${member.color}; width: ${progressPercent}%"></div>
                    <div class="family-pill-content">
                        <div class="family-pill-avatar" style="background: ${member.color}">
                            ${initial}
                        </div>
                        <div class="family-pill-info">
                            <div class="family-pill-name">${member.name}</div>
                            <div class="family-pill-tasks">${completedTasks}/${totalTasks}</div>
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        container.innerHTML += `
            <div class="family-pill" style="background: #f0f0f0; color: #667eea; min-width: auto;" onclick="addFamilyMember()">
                <div class="family-pill-content">
                    + Add Member
                </div>
            </div>
        `;
    }

    function renderAllTasks() {
        const allTasks = tasks.sort((a, b) => a.date.localeCompare(b.date));
        const container = document.getElementById('allTasksList');
        
        if (allTasks.length === 0) {
            container.innerHTML = '<p style="color: #999; padding: 20px; text-align: center;">No tasks yet</p>';
            return;
        }

        let html = '<ul class="task-list">';
        allTasks.forEach(task => {
            const member = familyMembers.find(m => m.name === task.member);
            const taskDate = new Date(task.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            html += `
                <li class="task-item ${task.completed ? 'completed' : ''}" style="border-left: 4px solid ${(member && member.color) || '#667eea'}">
                    <input type="checkbox" ${task.completed ? 'checked' : ''} 
                           onchange="toggleTask(${task.id})">
                    <span>${task.title} - ${taskDate} ${task.member ? `(${task.member})` : ''}</span>
                </li>
            `;
        });
        html += '</ul>';
        container.innerHTML = html;
    }

    function renderAllMeals() {
        const allMeals = meals.sort((a, b) => a.date.localeCompare(b.date));
        const container = document.getElementById('allMealsList');
        
        if (allMeals.length === 0) {
            container.innerHTML = '<p style="color: #999; padding: 20px; text-align: center;">No meals planned yet</p>';
            return;
        }

        let html = '<div class="meal-plan">';
        allMeals.forEach(meal => {
            const mealDate = new Date(meal.date).toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
            html += `
                <div class="meal-day">
                    <div class="meal-day-name">${mealDate}</div>
                    <div>${meal.name}</div>
                </div>
            `;
        });
        html += '</div>';
        container.innerHTML = html;
    }
    
    function renderRewardsView() {
        const container = document.getElementById('rewardsContainer');
        let html = '';
        
        // Filter out Google Calendar members
        const rewardMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        rewardMembers.forEach(member => {
            // Get member's rewards
            const memberRewards = rewards.filter(r => r.member === member.name);
            
            // Calculate total stars earned from completed chores and routines
            const memberChores = chores.filter(c => c.member === member.name && c.completed && c.stars);
            const memberRoutines = routines.filter(r => r.member === member.name && r.completed && r.stars);
            const totalStarsEarned = 
                memberChores.reduce((sum, c) => sum + c.stars, 0) +
                memberRoutines.reduce((sum, r) => sum + r.stars, 0);
            
            const columnBg = hexToRgba(member.color, 0.2);
            
            html += `<div class="rewards-person-column" style="background: ${columnBg};">
                <div class="rewards-person-header">
                    <div class="rewards-person-avatar" style="background: ${member.color}">
                        ${member.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="rewards-person-info">
                        <div class="rewards-person-name">${member.name}</div>
                        <div class="rewards-person-total-stars">
                            <span>⭐</span>
                            <span>${totalStarsEarned}</span>
                        </div>
                    </div>
                </div>
                
                <div class="rewards-list">`;
            
            if (memberRewards.length === 0) {
                html += `<p style="color: #999; text-align: center; padding: 20px;">No rewards yet. Click + to add!</p>`;
            } else {
                memberRewards.forEach(reward => {
                    const starsRequired = reward.starsNeeded || reward.stars || 25;
                    const progressPercent = Math.min(100, (totalStarsEarned / starsRequired) * 100);
                    const canRedeem = totalStarsEarned >= starsRequired && !reward.redeemed;
                    
                    html += `<div class="reward-card" onclick="openRewardDetail(${reward.id})" style="cursor: pointer;">
                        <div class="reward-icon">${reward.emoji || reward.icon || '🎁'}</div>
                        <div class="reward-title">${reward.title}</div>
                        <div class="reward-progress-container">
                            <div class="reward-progress-bar">
                                <div class="reward-progress-fill" style="width: ${progressPercent}%; background: ${member.color}">
                                </div>
                            </div>
                            <div class="reward-stars-text">
                                <span>⭐</span>
                                <span>${Math.min(totalStarsEarned, reward.starsNeeded || reward.stars)}/${reward.starsNeeded || reward.stars}</span>
                            </div>
                        </div>`;
                    
                    if (reward.redeemed) {
                        html += `<div style="text-align: center; color: #666; font-style: italic; padding: 10px;">Redeemed! 🎉</div>`;
                    } else if (canRedeem) {
                        html += `<button class="reward-redeem-btn" style="background: ${member.color}" onclick="event.stopPropagation(); redeemReward(${reward.id}, '${member.name}')">
                            Redeem <span>⭐</span> ${starsRequired}
                        </button>`;
                    } else {
                        html += `<button class="reward-redeem-btn" style="background: ${member.color}" disabled>
                            <span>⭐</span> ${starsRequired}
                        </button>`;
                    }
                    
                    html += `</div>`;
                });
            }
            
            html += `</div>
            </div>`;
        });
        
        container.innerHTML = html;
    }
    
    function redeemReward(rewardId, memberName) {
        const reward = rewards.find(r => r.id === rewardId);
        if (!reward) return;
        
        // Get member's total stars
        const memberChores = chores.filter(c => c.member === memberName && c.completed && c.stars);
        const memberRoutines = routines.filter(r => r.member === memberName && r.completed && r.stars);
        const totalStarsEarned = 
            memberChores.reduce((sum, c) => sum + c.stars, 0) +
            memberRoutines.reduce((sum, r) => sum + r.stars, 0);
        
        if (totalStarsEarned >= reward.stars) {
            reward.redeemed = true;
            reward.redeemedDate = new Date().toISOString();
            localStorage.setItem('rewards', JSON.stringify(rewards));
            
            // Trigger confetti!
            triggerConfetti();
            
            // Re-render
            renderRewardsView();
        }
    }
    
    function renderChoresView() {
        const container = document.getElementById('choresContainer');
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Determine current time period
        const currentHour = new Date().getHours();
        let currentPeriod = 'Morning';
        if (currentHour >= 12 && currentHour < 18) {
            currentPeriod = 'Afternoon';
        } else if (currentHour >= 18) {
            currentPeriod = 'Evening';
        }
        
        let html = '';
        
        // Filter out Google Calendar members
        const choreMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        choreMembers.forEach(member => {
            const memberChores = chores.filter(c => c.member === member.name);
            const memberRoutines = routines.filter(r => r.member === member.name);
            
            const completedCount = memberChores.filter(c => c.completed).length;
            const totalCount = memberChores.length;
            const progressPercent = totalCount > 0 ? (completedCount / totalCount) * 100 : 0;
            
            // Calculate total stars earned
            const starsEarned = memberChores.filter(c => c.completed && c.stars).reduce((sum, c) => sum + c.stars, 0);
            
            const columnBg = hexToRgba(member.color, 0.2);
            
            html += `<div class="chore-person-card" style="background: ${columnBg};">
                <div class="chore-person-header">
                    <div class="chore-person-avatar" style="background: ${member.color}">
                        ${member.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="chore-person-info">
                        <div class="chore-person-name">${member.name}</div>
                        <div class="chore-person-stats">
                            <span class="chore-person-progress-text">${completedCount}/${totalCount}</span>
                            ${starsEarned > 0 ? `<span class="chore-person-stars">⭐ ${starsEarned}</span>` : ''}
                        </div>
                        <div class="chore-progress-bar">
                            <div class="chore-progress-fill" style="width: ${progressPercent}%; background: ${member.color}"></div>
                        </div>
                    </div>
                </div>`;
            
            // Show routine indicators if person has routines
            if (memberRoutines.length > 0) {
                html += `<div class="routine-indicators">`;
                
                ['Morning', 'Afternoon', 'Evening', 'Chores'].forEach(period => {
                    const hasRoutine = memberRoutines.some(r => r.period === period);
                    const isActive = period === currentPeriod;
                    const icon = period === 'Morning' ? '☀️' : period === 'Afternoon' ? '☀️' : period === 'Evening' ? '🌙' : '🧹';
                    
                    html += `<div class="routine-indicator ${isActive ? 'active' : ''} ${hasRoutine ? 'has-routine' : ''}" 
                                  onclick="${hasRoutine ? `showRoutine('${member.name}', '${period}')` : ''}">
                        <div class="routine-indicator-icon">${icon}</div>
                        <div class="routine-indicator-label">${period}</div>
                    </div>`;
                });
                
                html += `</div>`;
            }
            
            // Show current period's routine tasks
            const currentRoutine = memberRoutines.filter(r => r.period === currentPeriod);
            
            if (currentRoutine.length > 0) {
                html += `<div class="routine-section">
                    <div class="routine-section-title">${currentPeriod}</div>
                    <div class="routine-tasks">`;
                
                currentRoutine.forEach(task => {
                    html += `<div class="routine-task ${task.completed ? 'completed' : ''}" 
                                  style="background: ${member.color}${task.completed ? '80' : '30'}; cursor: pointer;"
                                  onclick="openTaskDetail(${task.id}, 'routine', event)">
                        <div class="routine-task-icon">${task.icon || '✓'}</div>
                        <div class="routine-task-content">
                            <div class="routine-task-title">${task.title}</div>
                            ${task.stars ? `<div class="routine-task-stars">⭐ ${task.stars}</div>` : ''}
                        </div>
                        <div class="chore-item-checkbox ${task.completed ? 'checked' : ''}" 
                             style="${task.completed ? `background: ${member.color}; border-color: ${member.color};` : ''}"
                             onclick="event.stopPropagation(); toggleRoutine(${task.id})">
                            ${task.completed ? '✓' : ''}
                        </div>
                    </div>`;
                });
                
                html += `</div></div>`;
            }
            
            // Show regular chores
            html += `<div class="chore-items">`;
            
            memberChores.forEach(chore => {
                const isLate = chore.dueDate && new Date(chore.dueDate) < today && !chore.completed;
                const daysLate = isLate ? Math.floor((today - new Date(chore.dueDate)) / (1000 * 60 * 60 * 24)) : 0;
                const lateText = isLate ? (daysLate === 0 ? 'Due today' : `${daysLate} day${daysLate > 1 ? 's' : ''} late`) : '';
                
                // Determine background opacity based on completion
                const bgOpacity = chore.completed ? '80' : '30';
                
                html += `<div class="chore-item ${chore.completed ? 'completed' : ''}" 
                              style="background: ${member.color}${bgOpacity}; cursor: pointer;"
                              onclick="openTaskDetail(${chore.id}, 'chore', event)">
                    ${chore.icon ? `<div class="chore-item-icon">${chore.icon}</div>` : ''}
                    <div class="chore-item-content">
                        <div class="chore-item-title">${chore.title}</div>
                        ${chore.frequency || isLate ? 
                            `<div class="chore-item-subtitle ${isLate ? 'late' : ''}">${isLate ? lateText : chore.frequency}</div>` 
                            : ''}
                        ${chore.stars ? `<div class="chore-item-stars">⭐ ${chore.stars}</div>` : ''}
                    </div>
                    <div class="chore-item-checkbox ${chore.completed ? 'checked' : ''}" 
                         style="${chore.completed ? `background: ${member.color}; border-color: ${member.color};` : ''}"
                         onclick="event.stopPropagation(); toggleChore(${chore.id})">
                        ${chore.completed ? '✓' : ''}
                    </div>
                </div>`;
            });
            
            html += `</div>
            </div>`;
        });
        
        container.innerHTML = html;
    }
    
    function renderRewardsView() {
        const container = document.getElementById('rewardsContainer');
        const choreMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        let html = '';
        
        choreMembers.forEach(member => {
            // Calculate total stars earned from completed chores and routines
            const memberChores = chores.filter(c => c.member === member.name && c.completed && c.stars);
            const memberRoutines = routines.filter(r => r.member === member.name && r.completed && r.stars);
            const totalStarsEarned = 
                memberChores.reduce((sum, c) => sum + c.stars, 0) +
                memberRoutines.reduce((sum, r) => sum + r.stars, 0);
            
            // Get rewards for this member
            const memberRewards = rewards.filter(r => r.member === member.name);
            
            const columnBg = hexToRgba(member.color, 0.2);
            
            html += `<div class="rewards-person-column" style="background: ${columnBg};">
                <div class="rewards-person-header">
                    <div class="rewards-person-avatar" style="background: ${member.color}">
                        ${member.name.charAt(0).toUpperCase()}
                    </div>
                    <div class="rewards-person-info">
                        <div class="rewards-person-name">${member.name}</div>
                        <div class="rewards-person-total-stars">
                            <span>⭐</span>
                            <span>${totalStarsEarned}</span>
                        </div>
                    </div>
                </div>`;
            
            // Render reward cards
            memberRewards.forEach(reward => {
                const currentStars = Math.min(totalStarsEarned, reward.starsNeeded);
                const progressPercent = (currentStars / reward.starsNeeded) * 100;
                const canRedeem = totalStarsEarned >= reward.starsNeeded && !reward.redeemed;
                
                html += `<div class="reward-card" onclick="openRewardDetail(${reward.id})" style="cursor: pointer;">
                    <div class="reward-emoji">${reward.emoji}</div>
                    <div class="reward-title">${reward.title}</div>
                    <div class="reward-progress-container">
                        <div class="reward-progress-bar">
                            <div class="reward-progress-fill" style="width: ${progressPercent}%; background: ${member.color}80;"></div>
                            <div class="reward-progress-text">
                                <span>⭐</span>
                                <span>${currentStars}/${reward.starsNeeded}</span>
                            </div>
                        </div>
                    </div>
                    ${canRedeem ? 
                        `<button class="reward-redeem-btn" style="background: ${member.color};" onclick="event.stopPropagation(); redeemReward(${reward.id})">
                            Redeem ⭐ ${reward.starsNeeded}
                        </button>` :
                        reward.redeemed ?
                        `<button class="reward-redeem-btn" style="background: #999;" disabled>
                            Redeemed ✓
                        </button>` :
                        ''
                    }
                </div>`;
            });
            
            html += `</div>`;
        });
        
        container.innerHTML = html;
    }
    
    let currentRedeemedRewardId = null;
    
    function redeemReward(rewardId) {
        const reward = rewards.find(r => r.id === rewardId);
        if (!reward) return;
        
        // Get member's total stars
        const memberChores = chores.filter(c => c.member === reward.member && c.completed && c.stars);
        const memberRoutines = routines.filter(r => r.member === reward.member && r.completed && r.stars);
        const totalStarsEarned = 
            memberChores.reduce((sum, c) => sum + c.stars, 0) +
            memberRoutines.reduce((sum, r) => sum + r.stars, 0);
        
        if (totalStarsEarned >= reward.starsNeeded && !reward.redeemed) {
            reward.redeemed = true;
            reward.redeemedDate = new Date().toISOString().split('T')[0];
            localStorage.setItem('rewards', JSON.stringify(rewards));
            currentRedeemedRewardId = rewardId;
            
            // Show celebration modal
            showRewardRedemptionModal(reward);
            
            // Trigger star confetti after a short delay
            setTimeout(() => {
                triggerStarConfetti();
            }, 400);
            
            // Re-render rewards view
            renderRewardsView();
        }
    }
    
    function showRewardRedemptionModal(reward) {
        const modal = document.getElementById('rewardRedemptionModal');
        const member = familyMembers.find(m => m.name === reward.member);
        
        // Populate modal
        document.getElementById('redemptionEmoji').textContent = reward.emoji || '🎁';
        document.getElementById('redemptionTitle').textContent = `Great work! ${reward.title} redeemed`;
        
        const redeemedDate = reward.redeemedDate ? new Date(reward.redeemedDate).toLocaleDateString('en-US', { 
            month: 'long', 
            day: 'numeric', 
            year: 'numeric' 
        }) : new Date().toLocaleDateString('en-US', { 
            month: 'long', 
            day: 'numeric', 
            year: 'numeric' 
        });
        
        document.getElementById('redemptionSubtitle').textContent = 
            `By ${reward.member} for ${reward.starsNeeded} stars on ${redeemedDate}.`;
        
        // Show modal
        modal.classList.add('active');
    }
    
    function closeRewardRedemptionModal() {
        const modal = document.getElementById('rewardRedemptionModal');
        modal.classList.remove('active');
        currentRedeemedRewardId = null;
    }
    
    function unredeemCurrentReward() {
        if (!currentRedeemedRewardId) return;
        
        const reward = rewards.find(r => r.id === currentRedeemedRewardId);
        if (reward) {
            reward.redeemed = false;
            delete reward.redeemedDate;
            localStorage.setItem('rewards', JSON.stringify(rewards));
            closeRewardRedemptionModal();
            renderRewardsView();
        }
    }
    
    // Reward Edit Functions
    let currentEditRewardId = null;
    
    function openRewardDetail(rewardId) {
        console.log('openRewardDetail called with ID:', rewardId);
        console.log('Current rewards:', rewards);
        
        currentEditRewardId = rewardId;
        const reward = rewards.find(r => r.id === rewardId);
        
        if (!reward) {
            console.error('Reward not found with ID:', rewardId);
            return;
        }
        
        console.log('Found reward:', reward);
        
        // Populate edit form
        const titleInput = document.getElementById('editRewardTitle');
        const emojiInput = document.getElementById('editRewardEmoji');
        const starsInput = document.getElementById('editRewardStars');
        
        if (!titleInput || !emojiInput || !starsInput) {
            console.error('Edit form elements not found!');
            return;
        }
        
        titleInput.value = reward.title || '';
        emojiInput.value = reward.emoji || reward.icon || '🎁';
        starsInput.value = reward.starsNeeded || reward.stars || 25;
        
        console.log('Form populated');
        
        // Initialize emoji picker
        initializeEditRewardEmojiPicker();
        
        // Show panel
        const overlay = document.getElementById('editRewardPanelOverlay');
        const panel = document.getElementById('editRewardPanel');
        
        if (!overlay || !panel) {
            console.error('Panel elements not found!');
            return;
        }
        
        overlay.classList.add('active');
        panel.classList.add('active');
        
        console.log('Panel should be visible now');
    }
    
    function closeEditRewardPanel() {
        document.getElementById('editRewardPanel').classList.remove('active');
        document.getElementById('editRewardPanelOverlay').classList.remove('active');
        currentEditRewardId = null;
    }
    
    function saveEditedReward() {
        const reward = rewards.find(r => r.id === currentEditRewardId);
        if (!reward) return;
        
        const title = document.getElementById('editRewardTitle').value.trim();
        const emoji = document.getElementById('editRewardEmoji').value.trim();
        const stars = parseInt(document.getElementById('editRewardStars').value) || 25;
        
        if (!title) {
            alert('Please enter a reward title');
            return;
        }
        
        reward.title = title;
        reward.emoji = emoji || '🎁';
        reward.icon = emoji || '🎁'; // Keep both for compatibility
        reward.starsNeeded = stars;
        reward.stars = stars; // Keep both for compatibility
        
        localStorage.setItem('rewards', JSON.stringify(rewards));
        closeEditRewardPanel();
        renderRewardsView();
    }
    
    function deleteCurrentReward() {
        if (!confirm('Are you sure you want to delete this reward?')) return;
        
        const index = rewards.findIndex(r => r.id === currentEditRewardId);
        if (index > -1) {
            rewards.splice(index, 1);
            localStorage.setItem('rewards', JSON.stringify(rewards));
            closeEditRewardPanel();
            renderRewardsView();
        }
    }
    
    function initializeEditRewardEmojiPicker() {
        const grid = document.getElementById('editRewardEmojiPickerGrid');
        if (grid.innerHTML) return; // Already initialized
        
        const emojiData = document.getElementById('emojiPickerGrid').innerHTML;
        grid.innerHTML = emojiData.replace(/onclick="selectEmoji/g, 'onclick="selectEditRewardEmoji');
        
        // Parse emojis with Twemoji after populating
        if (typeof twemoji !== 'undefined') {
            twemoji.parse(grid, {
                folder: 'svg',
                ext: '.svg'
            });
        }
    }
    
    function toggleEditRewardEmojiPicker(event) {
        event.stopPropagation();
        const dropdown = document.getElementById('editRewardEmojiPickerDropdown');
        dropdown.classList.toggle('active');
    }
    
    function selectEditRewardEmoji(emoji) {
        document.getElementById('editRewardEmoji').value = emoji;
        document.getElementById('editRewardEmojiPickerDropdown').classList.remove('active');
    }
    
    function filterEditRewardEmojis() {
        const searchTerm = document.getElementById('editRewardEmojiSearchInput').value.toLowerCase();
        const emojiItems = document.querySelectorAll('#editRewardEmojiPickerGrid .emoji-picker-item');
        
        emojiItems.forEach(item => {
            const emoji = item.textContent;
            const match = emoji.toLowerCase().includes(searchTerm);
            item.classList.toggle('hidden', !match);
        });
    }
    
    function toggleRoutine(routineId) {
        const routine = routines.find(r => r.id === routineId);
        if (routine) {
            const wasCompleted = routine.completed;
            routine.completed = !routine.completed;
            if (routine.completed) {
                routine.completedDate = new Date().toISOString().split('T')[0];
            } else {
                delete routine.completedDate;
            }
            localStorage.setItem('routines', JSON.stringify(routines));
            
            // Check if member completed all their tasks
            if (!wasCompleted && routine.completed) {
                checkAllTasksComplete(routine.member);
            }
            
            renderChoresView();
        }
    }
    
    function showRoutine(memberName, period) {
        // This could open a modal or change the view to show that routine
        console.log(`Show routine for ${memberName} - ${period}`);
    }
    
    let currentTaskType = 'chore';
    let selectedProfiles = [];
    
    function openTaskChoreModal() {
        document.getElementById('taskChorePanelOverlay').classList.add('active');
        document.getElementById('taskChoreModal').classList.add('active');
        renderProfileGrid();
        initializeEmojiPicker();
        // Set today's date
        document.getElementById('taskChoreDate').valueAsDate = new Date();
    }
    
    function updateAddDateVisibility() {
        const checked = document.getElementById('taskChoreDateToggle').checked;
        document.getElementById('taskChoreDate').style.display = checked ? 'block' : 'none';
    }
    
    function updateAddTimeVisibility() {
        const checked = document.getElementById('taskChoreTimeToggle').checked;
        document.getElementById('taskChoreTime').style.display = checked ? 'block' : 'none';
    }
    
    function updateRepeatVisibility() {
        const checked = document.getElementById('taskChoreRepeatToggle').checked;
        document.getElementById('taskRepeatDetails').style.display = checked ? 'block' : 'none';
    }
    
    function initializeEmojiPicker() {
        const emojiData = [
            // Smileys & Emotion
            { emoji: '😀', keywords: 'smile happy grin face' },
            { emoji: '😃', keywords: 'smile happy grin big face' },
            { emoji: '😄', keywords: 'smile happy grin eyes face' },
            { emoji: '😁', keywords: 'smile happy grin beam face' },
            { emoji: '😆', keywords: 'laugh smile happy face' },
            { emoji: '😅', keywords: 'laugh smile sweat face' },
            { emoji: '😂', keywords: 'laugh cry tears joy face' },
            { emoji: '🤣', keywords: 'laugh rolling floor face' },
            { emoji: '😊', keywords: 'smile blush happy face' },
            { emoji: '😇', keywords: 'smile angel halo innocent face' },
            { emoji: '🙂', keywords: 'smile slight happy face' },
            { emoji: '🙃', keywords: 'smile upside down face' },
            { emoji: '😉', keywords: 'wink smile face' },
            { emoji: '😌', keywords: 'relieved smile peaceful face' },
            { emoji: '😍', keywords: 'love heart eyes smile face' },
            { emoji: '🥰', keywords: 'love smile hearts face' },
            { emoji: '😘', keywords: 'kiss love smile face' },
            { emoji: '😗', keywords: 'kiss smile face' },
            { emoji: '😙', keywords: 'kiss smile eyes face' },
            { emoji: '😚', keywords: 'kiss smile closed eyes face' },
            { emoji: '😋', keywords: 'yum delicious tongue face' },
            { emoji: '😛', keywords: 'tongue out playful face' },
            { emoji: '😝', keywords: 'tongue wink playful face' },
            { emoji: '😜', keywords: 'tongue wink one eye face' },
            { emoji: '🤪', keywords: 'crazy zany wild face' },
            { emoji: '🤨', keywords: 'raised eyebrow suspicious face' },
            { emoji: '🧐', keywords: 'monocle smart thinking face' },
            { emoji: '🤓', keywords: 'nerd glasses smart face' },
            { emoji: '😎', keywords: 'cool sunglasses face' },
            { emoji: '🤩', keywords: 'star struck excited face' },
            { emoji: '🥳', keywords: 'party celebrate hat face' },
            { emoji: '😏', keywords: 'smirk smile face' },
            { emoji: '😒', keywords: 'unamused unhappy face' },
            { emoji: '😞', keywords: 'disappointed sad face' },
            { emoji: '😔', keywords: 'pensive sad thoughtful face' },
            { emoji: '😟', keywords: 'worried anxious face' },
            { emoji: '😕', keywords: 'confused puzzled face' },
            { emoji: '🙁', keywords: 'frown sad face' },
            { emoji: '😣', keywords: 'persevere struggling face' },
            { emoji: '😖', keywords: 'confounded frustrated face' },
            { emoji: '😫', keywords: 'tired exhausted face' },
            { emoji: '😩', keywords: 'weary tired face' },
            { emoji: '🥺', keywords: 'pleading puppy eyes face' },
            { emoji: '😢', keywords: 'cry sad tears face' },
            { emoji: '😭', keywords: 'cry sobbing loudly face' },
            { emoji: '😤', keywords: 'triumph huff steam face' },
            { emoji: '😠', keywords: 'angry mad face' },
            { emoji: '😡', keywords: 'angry rage pouting face' },
            { emoji: '🤬', keywords: 'curse swear symbols face' },
            { emoji: '🤯', keywords: 'exploding mind blown face' },
            { emoji: '😳', keywords: 'flushed embarrassed face' },
            { emoji: '🥵', keywords: 'hot sweating face' },
            { emoji: '🥶', keywords: 'cold freezing face' },
            { emoji: '😱', keywords: 'scream fear shocked face' },
            { emoji: '😨', keywords: 'fearful scared face' },
            { emoji: '😰', keywords: 'anxious worried sweat face' },
            { emoji: '😥', keywords: 'sad relieved disappointed face' },
            { emoji: '😓', keywords: 'downcast sweat face' },
            { emoji: '🤗', keywords: 'hugging hug face' },
            { emoji: '🤔', keywords: 'thinking hmm wonder face' },
            { emoji: '🤭', keywords: 'hand mouth giggle oops face' },
            { emoji: '🤫', keywords: 'shush quiet silence face' },
            { emoji: '🤥', keywords: 'lying pinocchio nose face' },
            { emoji: '😶', keywords: 'no mouth silent face' },
            { emoji: '😐', keywords: 'neutral meh face' },
            { emoji: '😑', keywords: 'expressionless blank face' },
            { emoji: '😬', keywords: 'grimace awkward face' },
            { emoji: '🙄', keywords: 'eye roll annoyed face' },
            { emoji: '😯', keywords: 'hushed surprised face' },
            { emoji: '😦', keywords: 'frown open mouth face' },
            { emoji: '😧', keywords: 'anguish worried face' },
            { emoji: '😮', keywords: 'surprised open mouth face' },
            { emoji: '😲', keywords: 'astonished shocked face' },
            { emoji: '🥱', keywords: 'yawn tired sleepy face' },
            { emoji: '😴', keywords: 'sleeping zzz face' },
            { emoji: '🤤', keywords: 'drooling sleeping face' },
            { emoji: '😪', keywords: 'sleepy tired face' },
            { emoji: '😵', keywords: 'dizzy face' },
            { emoji: '🤐', keywords: 'zipper mouth quiet face' },
            { emoji: '🥴', keywords: 'woozy drunk dizzy face' },
            { emoji: '🤢', keywords: 'nauseated sick face' },
            { emoji: '🤮', keywords: 'vomit sick face' },
            { emoji: '🤧', keywords: 'sneeze sick face' },
            { emoji: '😷', keywords: 'mask sick medical face' },
            { emoji: '🤒', keywords: 'thermometer sick face' },
            { emoji: '🤕', keywords: 'bandage hurt injured face' },
            
            // Hearts & Love
            { emoji: '❤️', keywords: 'heart love red favorite' },
            { emoji: '🧡', keywords: 'heart love orange favorite' },
            { emoji: '💛', keywords: 'heart love yellow favorite' },
            { emoji: '💚', keywords: 'heart love green favorite' },
            { emoji: '💙', keywords: 'heart love blue favorite' },
            { emoji: '💜', keywords: 'heart love purple favorite' },
            { emoji: '🖤', keywords: 'heart love black favorite' },
            { emoji: '🤍', keywords: 'heart love white favorite' },
            { emoji: '🤎', keywords: 'heart love brown favorite' },
            { emoji: '💔', keywords: 'broken heart sad' },
            { emoji: '❤️‍🔥', keywords: 'heart fire love passion' },
            { emoji: '❤️‍🩹', keywords: 'heart bandage healing' },
            { emoji: '💕', keywords: 'two hearts love' },
            { emoji: '💞', keywords: 'revolving hearts love' },
            { emoji: '💓', keywords: 'beating heart love' },
            { emoji: '💗', keywords: 'growing heart love' },
            { emoji: '💖', keywords: 'sparkle heart love favorite' },
            { emoji: '💘', keywords: 'arrow heart love cupid' },
            { emoji: '💝', keywords: 'heart box gift love favorite' },
            
            // Hand Gestures
            { emoji: '👍', keywords: 'thumbs up good yes like' },
            { emoji: '👎', keywords: 'thumbs down bad no dislike' },
            { emoji: '👊', keywords: 'fist bump punch' },
            { emoji: '✊', keywords: 'raised fist power' },
            { emoji: '🤛', keywords: 'left fist bump' },
            { emoji: '🤜', keywords: 'right fist bump' },
            { emoji: '🤞', keywords: 'crossed fingers luck hope' },
            { emoji: '✌️', keywords: 'victory peace two fingers' },
            { emoji: '🤟', keywords: 'love you sign hand' },
            { emoji: '🤘', keywords: 'rock on horns hand' },
            { emoji: '👌', keywords: 'ok okay perfect hand' },
            { emoji: '🤌', keywords: 'pinched fingers italian hand' },
            { emoji: '🤏', keywords: 'pinch small tiny hand' },
            { emoji: '👈', keywords: 'point left finger hand' },
            { emoji: '👉', keywords: 'point right finger hand' },
            { emoji: '👆', keywords: 'point up finger hand' },
            { emoji: '👇', keywords: 'point down finger hand' },
            { emoji: '☝️', keywords: 'point up index finger hand' },
            { emoji: '✋', keywords: 'raised hand stop palm' },
            { emoji: '🤚', keywords: 'raised back hand' },
            { emoji: '🖐️', keywords: 'hand fingers spread' },
            { emoji: '🖖', keywords: 'vulcan salute spock hand' },
            { emoji: '👋', keywords: 'wave hello goodbye hand' },
            { emoji: '🤙', keywords: 'call me hand shaka' },
            { emoji: '💪', keywords: 'muscle strong flex arm' },
            { emoji: '🙏', keywords: 'pray please thank you hands' },
            { emoji: '✍️', keywords: 'write writing hand' },
            { emoji: '👏', keywords: 'clap applause hands' },
            { emoji: '🙌', keywords: 'raising hands celebrate' },
            { emoji: '👐', keywords: 'open hands hug' },
            { emoji: '🤲', keywords: 'palms together prayer' },
            { emoji: '🤝', keywords: 'handshake deal agreement' },
            
            // Animals & Nature
            { emoji: '🐶', keywords: 'dog puppy pet animal' },
            { emoji: '🐕', keywords: 'dog pet animal walk feed' },
            { emoji: '🐩', keywords: 'poodle dog pet animal' },
            { emoji: '🐺', keywords: 'wolf animal wild' },
            { emoji: '🦊', keywords: 'fox animal' },
            { emoji: '🦝', keywords: 'raccoon animal' },
            { emoji: '🐱', keywords: 'cat kitty pet animal' },
            { emoji: '🐈', keywords: 'cat pet animal feed' },
            { emoji: '🐈‍⬛', keywords: 'black cat pet animal' },
            { emoji: '🦁', keywords: 'lion animal wild' },
            { emoji: '🐯', keywords: 'tiger animal wild' },
            { emoji: '🐅', keywords: 'tiger animal wild' },
            { emoji: '🐆', keywords: 'leopard animal wild' },
            { emoji: '🐴', keywords: 'horse animal' },
            { emoji: '🐎', keywords: 'horse racing animal' },
            { emoji: '🦄', keywords: 'unicorn fantasy animal' },
            { emoji: '🦓', keywords: 'zebra animal' },
            { emoji: '🦌', keywords: 'deer animal' },
            { emoji: '🦬', keywords: 'bison animal' },
            { emoji: '🐮', keywords: 'cow animal farm' },
            { emoji: '🐂', keywords: 'ox animal' },
            { emoji: '🐃', keywords: 'water buffalo animal' },
            { emoji: '🐄', keywords: 'cow animal farm' },
            { emoji: '🐷', keywords: 'pig animal farm' },
            { emoji: '🐖', keywords: 'pig animal farm' },
            { emoji: '🐗', keywords: 'boar pig animal' },
            { emoji: '🐽', keywords: 'pig nose animal' },
            { emoji: '🐏', keywords: 'ram sheep animal' },
            { emoji: '🐑', keywords: 'sheep animal farm' },
            { emoji: '🐐', keywords: 'goat animal' },
            { emoji: '🐪', keywords: 'camel animal desert' },
            { emoji: '🐫', keywords: 'camel two hump animal' },
            { emoji: '🦙', keywords: 'llama alpaca animal' },
            { emoji: '🦒', keywords: 'giraffe animal' },
            { emoji: '🐘', keywords: 'elephant animal' },
            { emoji: '🦣', keywords: 'mammoth elephant animal' },
            { emoji: '🦏', keywords: 'rhino animal' },
            { emoji: '🦛', keywords: 'hippo animal' },
            { emoji: '🐭', keywords: 'mouse animal pet' },
            { emoji: '🐁', keywords: 'mouse animal' },
            { emoji: '🐀', keywords: 'rat animal' },
            { emoji: '🐹', keywords: 'hamster pet animal' },
            { emoji: '🐰', keywords: 'rabbit bunny animal' },
            { emoji: '🐇', keywords: 'rabbit bunny pet animal' },
            { emoji: '🐿️', keywords: 'squirrel chipmunk animal' },
            { emoji: '🦫', keywords: 'beaver animal' },
            { emoji: '🦔', keywords: 'hedgehog pet animal' },
            { emoji: '🦇', keywords: 'bat animal night' },
            { emoji: '🐻', keywords: 'bear animal' },
            { emoji: '🐻‍❄️', keywords: 'polar bear animal' },
            { emoji: '🐨', keywords: 'koala animal' },
            { emoji: '🐼', keywords: 'panda animal' },
            { emoji: '🦥', keywords: 'sloth animal slow' },
            { emoji: '🦦', keywords: 'otter animal' },
            { emoji: '🦨', keywords: 'skunk animal' },
            { emoji: '🦘', keywords: 'kangaroo animal' },
            { emoji: '🦡', keywords: 'badger animal' },
            { emoji: '🐾', keywords: 'paw prints animal' },
            { emoji: '🦃', keywords: 'turkey bird animal' },
            { emoji: '🐔', keywords: 'chicken bird animal farm' },
            { emoji: '🐓', keywords: 'rooster chicken bird' },
            { emoji: '🐣', keywords: 'hatching chick bird' },
            { emoji: '🐤', keywords: 'baby chick bird' },
            { emoji: '🐥', keywords: 'chick bird' },
            { emoji: '🐦', keywords: 'bird pet animal' },
            { emoji: '🐧', keywords: 'penguin bird animal' },
            { emoji: '🕊️', keywords: 'dove peace bird' },
            { emoji: '🦅', keywords: 'eagle bird animal' },
            { emoji: '🦆', keywords: 'duck bird animal' },
            { emoji: '🦢', keywords: 'swan bird animal' },
            { emoji: '🦉', keywords: 'owl bird animal night' },
            { emoji: '🦤', keywords: 'dodo bird extinct' },
            { emoji: '🦩', keywords: 'flamingo bird pink animal' },
            { emoji: '🦚', keywords: 'peacock bird animal' },
            { emoji: '🦜', keywords: 'parrot bird pet animal' },
            { emoji: '🐸', keywords: 'frog animal' },
            { emoji: '🐊', keywords: 'crocodile animal' },
            { emoji: '🐢', keywords: 'turtle pet animal slow' },
            { emoji: '🦎', keywords: 'lizard animal' },
            { emoji: '🐍', keywords: 'snake animal' },
            { emoji: '🐲', keywords: 'dragon face fantasy' },
            { emoji: '🐉', keywords: 'dragon fantasy' },
            { emoji: '🦕', keywords: 'dinosaur sauropod animal' },
            { emoji: '🦖', keywords: 'dinosaur t-rex animal' },
            { emoji: '🐳', keywords: 'whale animal ocean' },
            { emoji: '🐋', keywords: 'whale animal ocean' },
            { emoji: '🐬', keywords: 'dolphin animal ocean' },
            { emoji: '🦭', keywords: 'seal animal ocean' },
            { emoji: '🐟', keywords: 'fish animal ocean' },
            { emoji: '🐠', keywords: 'fish pet animal aquarium' },
            { emoji: '🐡', keywords: 'blowfish puffer fish animal' },
            { emoji: '🦈', keywords: 'shark fish animal ocean' },
            { emoji: '🐙', keywords: 'octopus animal ocean' },
            { emoji: '🐚', keywords: 'shell ocean beach' },
            { emoji: '🐌', keywords: 'snail slow animal' },
            { emoji: '🦋', keywords: 'butterfly insect animal' },
            { emoji: '🐛', keywords: 'bug caterpillar insect' },
            { emoji: '🐜', keywords: 'ant insect animal' },
            { emoji: '🐝', keywords: 'bee honey insect' },
            { emoji: '🪲', keywords: 'beetle insect animal' },
            { emoji: '🐞', keywords: 'ladybug insect animal' },
            { emoji: '🦗', keywords: 'cricket insect animal' },
            { emoji: '🪳', keywords: 'cockroach insect' },
            { emoji: '🕷️', keywords: 'spider insect animal' },
            { emoji: '🕸️', keywords: 'spider web' },
            { emoji: '🦂', keywords: 'scorpion animal' },
            { emoji: '🦟', keywords: 'mosquito insect' },
            { emoji: '🪰', keywords: 'fly insect' },
            { emoji: '🪱', keywords: 'worm animal' },
            
            // Food & Drink
            { emoji: '🍎', keywords: 'apple fruit food healthy' },
            { emoji: '🍏', keywords: 'green apple fruit food' },
            { emoji: '🍊', keywords: 'orange fruit food' },
            { emoji: '🍋', keywords: 'lemon fruit food' },
            { emoji: '🍌', keywords: 'banana fruit food' },
            { emoji: '🍉', keywords: 'watermelon fruit food' },
            { emoji: '🍇', keywords: 'grapes fruit food' },
            { emoji: '🍓', keywords: 'strawberry fruit food' },
            { emoji: '🫐', keywords: 'blueberries fruit food' },
            { emoji: '🍈', keywords: 'melon fruit food' },
            { emoji: '🍒', keywords: 'cherries fruit food' },
            { emoji: '🍑', keywords: 'peach fruit food' },
            { emoji: '🥭', keywords: 'mango fruit food' },
            { emoji: '🍍', keywords: 'pineapple fruit food' },
            { emoji: '🥥', keywords: 'coconut fruit food' },
            { emoji: '🥝', keywords: 'kiwi fruit food' },
            { emoji: '🍅', keywords: 'tomato vegetable food' },
            { emoji: '🍆', keywords: 'eggplant vegetable food' },
            { emoji: '🥑', keywords: 'avocado food' },
            { emoji: '🥦', keywords: 'broccoli vegetable food' },
            { emoji: '🥬', keywords: 'leafy greens vegetable food' },
            { emoji: '🥒', keywords: 'cucumber vegetable food' },
            { emoji: '🌶️', keywords: 'hot pepper spicy food' },
            { emoji: '🫑', keywords: 'bell pepper vegetable food' },
            { emoji: '🌽', keywords: 'corn vegetable food' },
            { emoji: '🥕', keywords: 'carrot vegetable food' },
            { emoji: '🫒', keywords: 'olive food' },
            { emoji: '🧄', keywords: 'garlic food cooking' },
            { emoji: '🧅', keywords: 'onion food cooking' },
            { emoji: '🥔', keywords: 'potato vegetable food' },
            { emoji: '🍠', keywords: 'sweet potato food' },
            { emoji: '🥐', keywords: 'croissant bread pastry food' },
            { emoji: '🥯', keywords: 'bagel bread food breakfast' },
            { emoji: '🍞', keywords: 'bread food' },
            { emoji: '🥖', keywords: 'baguette bread food' },
            { emoji: '🥨', keywords: 'pretzel food snack' },
            { emoji: '🧀', keywords: 'cheese food' },
            { emoji: '🥚', keywords: 'egg food breakfast' },
            { emoji: '🍳', keywords: 'pan cook breakfast kitchen egg' },
            { emoji: '🧈', keywords: 'butter food' },
            { emoji: '🥞', keywords: 'pancakes breakfast food' },
            { emoji: '🧇', keywords: 'waffle breakfast food' },
            { emoji: '🥓', keywords: 'bacon breakfast food' },
            { emoji: '🥩', keywords: 'meat steak food' },
            { emoji: '🍗', keywords: 'poultry leg chicken food' },
            { emoji: '🍖', keywords: 'meat bone food' },
            { emoji: '🌭', keywords: 'hot dog food' },
            { emoji: '🍔', keywords: 'hamburger burger food' },
            { emoji: '🍟', keywords: 'fries french fries food' },
            { emoji: '🍕', keywords: 'pizza food' },
            { emoji: '🫓', keywords: 'flatbread food' },
            { emoji: '🥪', keywords: 'sandwich food' },
            { emoji: '🥙', keywords: 'stuffed flatbread food' },
            { emoji: '🧆', keywords: 'falafel food' },
            { emoji: '🌮', keywords: 'taco food mexican' },
            { emoji: '🌯', keywords: 'burrito food mexican' },
            { emoji: '🫔', keywords: 'tamale food' },
            { emoji: '🥗', keywords: 'salad food healthy meal' },
            { emoji: '🥘', keywords: 'pan cook dinner kitchen shallow' },
            { emoji: '🫕', keywords: 'fondue food' },
            { emoji: '🥫', keywords: 'canned food' },
            { emoji: '🍝', keywords: 'spaghetti pasta food italian' },
            { emoji: '🍜', keywords: 'ramen noodles food' },
            { emoji: '🍲', keywords: 'pot cook soup kitchen stew' },
            { emoji: '🍛', keywords: 'curry rice food' },
            { emoji: '🍣', keywords: 'sushi food japanese' },
            { emoji: '🍱', keywords: 'lunch bento meal food box' },
            { emoji: '🥟', keywords: 'dumpling food' },
            { emoji: '🦪', keywords: 'oyster seafood food' },
            { emoji: '🍤', keywords: 'fried shrimp food' },
            { emoji: '🍙', keywords: 'rice ball food japanese' },
            { emoji: '🍚', keywords: 'cooked rice food' },
            { emoji: '🍘', keywords: 'rice cracker food' },
            { emoji: '🍥', keywords: 'fish cake food' },
            { emoji: '🥠', keywords: 'fortune cookie food' },
            { emoji: '🥮', keywords: 'moon cake food' },
            { emoji: '🍢', keywords: 'oden food' },
            { emoji: '🍡', keywords: 'dango food sweet' },
            { emoji: '🍧', keywords: 'shaved ice dessert food' },
            { emoji: '🍨', keywords: 'ice cream dessert food' },
            { emoji: '🍦', keywords: 'soft ice cream dessert food' },
            { emoji: '🥧', keywords: 'pie dessert food' },
            { emoji: '🧁', keywords: 'cupcake cake dessert food' },
            { emoji: '🍰', keywords: 'cake dessert food' },
            { emoji: '🎂', keywords: 'birthday cake celebration food' },
            { emoji: '🍮', keywords: 'custard pudding dessert food' },
            { emoji: '🍭', keywords: 'lollipop candy sweet food' },
            { emoji: '🍬', keywords: 'candy sweet food' },
            { emoji: '🍫', keywords: 'chocolate bar sweet food' },
            { emoji: '🍿', keywords: 'popcorn movie snack food' },
            { emoji: '🍩', keywords: 'doughnut donut sweet food' },
            { emoji: '🍪', keywords: 'cookie sweet food' },
            { emoji: '🌰', keywords: 'chestnut nut food' },
            { emoji: '🥜', keywords: 'peanuts nuts food' },
            { emoji: '🍯', keywords: 'honey pot sweet food' },
            { emoji: '🥛', keywords: 'milk glass drink' },
            { emoji: '🍼', keywords: 'baby bottle milk' },
            { emoji: '🫖', keywords: 'teapot tea drink' },
            { emoji: '☕', keywords: 'coffee hot drink' },
            { emoji: '🍵', keywords: 'tea cup drink' },
            { emoji: '🧃', keywords: 'juice box drink' },
            { emoji: '🥤', keywords: 'cup straw drink soda' },
            { emoji: '🧋', keywords: 'bubble tea drink' },
            { emoji: '🍶', keywords: 'sake bottle drink' },
            { emoji: '🍺', keywords: 'beer mug drink' },
            { emoji: '🍻', keywords: 'beers clinking drink cheers' },
            { emoji: '🥂', keywords: 'glasses clinking toast drink' },
            { emoji: '🍷', keywords: 'wine glass drink' },
            { emoji: '🥃', keywords: 'whiskey glass drink' },
            { emoji: '🍸', keywords: 'cocktail glass drink' },
            { emoji: '🍹', keywords: 'tropical drink cocktail' },
            { emoji: '🧉', keywords: 'mate drink' },
            { emoji: '🍾', keywords: 'champagne bottle celebrate' },
            { emoji: '🧊', keywords: 'ice cube cold' },
            
            // Activities & Sports
            { emoji: '⚽', keywords: 'soccer ball sport football' },
            { emoji: '🏀', keywords: 'basketball ball sport' },
            { emoji: '🏈', keywords: 'football american sport' },
            { emoji: '⚾', keywords: 'baseball ball sport' },
            { emoji: '🥎', keywords: 'softball ball sport' },
            { emoji: '🎾', keywords: 'tennis ball sport' },
            { emoji: '🏐', keywords: 'volleyball ball sport' },
            { emoji: '🏉', keywords: 'rugby football ball sport' },
            { emoji: '🥏', keywords: 'frisbee flying disc sport' },
            { emoji: '🎱', keywords: 'pool billiards 8 ball' },
            { emoji: '🪀', keywords: 'yo-yo toy' },
            { emoji: '🏓', keywords: 'ping pong table tennis sport' },
            { emoji: '🏸', keywords: 'badminton racket sport' },
            { emoji: '🏒', keywords: 'ice hockey stick sport' },
            { emoji: '🏑', keywords: 'field hockey stick sport' },
            { emoji: '🥍', keywords: 'lacrosse stick sport' },
            { emoji: '🏏', keywords: 'cricket game sport' },
            { emoji: '🪃', keywords: 'boomerang sport' },
            { emoji: '🥅', keywords: 'goal net sport' },
            { emoji: '⛳', keywords: 'flag hole golf sport' },
            { emoji: '🪁', keywords: 'kite flying toy' },
            { emoji: '🏹', keywords: 'bow arrow archery sport' },
            { emoji: '🎣', keywords: 'fishing pole rod' },
            { emoji: '🤿', keywords: 'diving mask snorkel' },
            { emoji: '🥊', keywords: 'boxing glove sport' },
            { emoji: '🥋', keywords: 'martial arts uniform karate' },
            { emoji: '🎽', keywords: 'running shirt sport' },
            { emoji: '🛹', keywords: 'skateboard sport' },
            { emoji: '🛼', keywords: 'roller skate sport' },
            { emoji: '🛷', keywords: 'sled snow sport' },
            { emoji: '⛸️', keywords: 'ice skate sport' },
            { emoji: '🥌', keywords: 'curling stone sport' },
            { emoji: '🎿', keywords: 'skis snow sport' },
            { emoji: '⛷️', keywords: 'skier snow sport' },
            { emoji: '🏂', keywords: 'snowboarder snow sport' },
            { emoji: '🪂', keywords: 'parachute skydiving' },
            { emoji: '🏋️', keywords: 'weight lifting gym exercise' },
            { emoji: '🤼', keywords: 'wrestling sport' },
            { emoji: '🤸', keywords: 'cartwheel gymnastics' },
            { emoji: '⛹️', keywords: 'basketball person sport' },
            { emoji: '🤺', keywords: 'fencing sport' },
            { emoji: '🤾', keywords: 'handball sport' },
            { emoji: '🏌️', keywords: 'golf person sport' },
            { emoji: '🏇', keywords: 'horse racing jockey' },
            { emoji: '🧘', keywords: 'yoga meditation lotus' },
            { emoji: '🏊', keywords: 'swimming person sport' },
            { emoji: '🏄', keywords: 'surfing person sport' },
            { emoji: '🚣', keywords: 'rowing boat person' },
            { emoji: '🧗', keywords: 'climbing person sport' },
            { emoji: '🚴', keywords: 'biking cycling person' },
            { emoji: '🚵', keywords: 'mountain biking person sport' },
            { emoji: '🤹', keywords: 'juggling person' },
            
            // Travel & Places
            { emoji: '🚗', keywords: 'car automobile vehicle' },
            { emoji: '🚕', keywords: 'taxi cab vehicle' },
            { emoji: '🚙', keywords: 'suv vehicle car' },
            { emoji: '🚌', keywords: 'bus vehicle' },
            { emoji: '🚎', keywords: 'trolleybus vehicle' },
            { emoji: '🏎️', keywords: 'race car fast vehicle' },
            { emoji: '🚓', keywords: 'police car vehicle' },
            { emoji: '🚑', keywords: 'ambulance vehicle emergency' },
            { emoji: '🚒', keywords: 'fire truck engine vehicle' },
            { emoji: '🚐', keywords: 'minibus vehicle' },
            { emoji: '🛻', keywords: 'pickup truck vehicle' },
            { emoji: '🚚', keywords: 'delivery truck vehicle' },
            { emoji: '🚛', keywords: 'articulated lorry truck vehicle' },
            { emoji: '🚜', keywords: 'tractor vehicle farm' },
            { emoji: '🏍️', keywords: 'motorcycle bike vehicle' },
            { emoji: '🛵', keywords: 'motor scooter vehicle' },
            { emoji: '🦽', keywords: 'wheelchair manual' },
            { emoji: '🦼', keywords: 'wheelchair motorized' },
            { emoji: '🛴', keywords: 'scooter kick' },
            { emoji: '🚲', keywords: 'bicycle bike' },
            { emoji: '🛺', keywords: 'auto rickshaw vehicle' },
            { emoji: '🚁', keywords: 'helicopter vehicle' },
            { emoji: '🛩️', keywords: 'small airplane plane' },
            { emoji: '✈️', keywords: 'airplane plane travel' },
            { emoji: '🛫', keywords: 'airplane departure takeoff' },
            { emoji: '🛬', keywords: 'airplane arrival landing' },
            { emoji: '🪂', keywords: 'parachute skydiving' },
            { emoji: '💺', keywords: 'seat airplane' },
            { emoji: '🚀', keywords: 'rocket space launch' },
            { emoji: '🛸', keywords: 'ufo flying saucer alien' },
            { emoji: '🚉', keywords: 'station train' },
            { emoji: '🚊', keywords: 'tram vehicle' },
            { emoji: '🚝', keywords: 'monorail vehicle' },
            { emoji: '🚞', keywords: 'mountain railway' },
            { emoji: '🚋', keywords: 'tram car vehicle' },
            { emoji: '🚃', keywords: 'railway car train' },
            { emoji: '🚄', keywords: 'high speed train bullet' },
            { emoji: '🚅', keywords: 'bullet train high speed' },
            { emoji: '🚆', keywords: 'train vehicle' },
            { emoji: '🚇', keywords: 'metro subway train' },
            { emoji: '🚈', keywords: 'light rail train' },
            { emoji: '🚂', keywords: 'locomotive steam train' },
            { emoji: '🚝', keywords: 'monorail vehicle' },
            { emoji: '🚄', keywords: 'high speed train' },
            { emoji: '🚢', keywords: 'ship boat cruise' },
            { emoji: '⛴️', keywords: 'ferry boat' },
            { emoji: '🛳️', keywords: 'passenger ship cruise' },
            { emoji: '⛵', keywords: 'sailboat boat' },
            { emoji: '🚤', keywords: 'speedboat boat' },
            { emoji: '🛥️', keywords: 'motor boat' },
            { emoji: '🛶', keywords: 'canoe boat' },
            { emoji: '⚓', keywords: 'anchor ship' },
            { emoji: '⛽', keywords: 'fuel pump gas station' },
            { emoji: '🚏', keywords: 'bus stop' },
            { emoji: '🚦', keywords: 'traffic light signal' },
            { emoji: '🚥', keywords: 'horizontal traffic light' },
            { emoji: '🏗️', keywords: 'construction building' },
            { emoji: '🗼', keywords: 'tokyo tower landmark' },
            { emoji: '🗽', keywords: 'statue liberty landmark' },
            { emoji: '⛪', keywords: 'church building religion' },
            { emoji: '🕌', keywords: 'mosque building religion' },
            { emoji: '🛕', keywords: 'hindu temple building religion' },
            { emoji: '🕍', keywords: 'synagogue building religion' },
            { emoji: '⛩️', keywords: 'shinto shrine torii' },
            { emoji: '🕋', keywords: 'kaaba mecca religion' },
            { emoji: '⛲', keywords: 'fountain water' },
            { emoji: '⛺', keywords: 'tent camping' },
            { emoji: '🌁', keywords: 'foggy fog weather' },
            { emoji: '🌃', keywords: 'night stars city' },
            { emoji: '🏙️', keywords: 'cityscape buildings' },
            { emoji: '🌄', keywords: 'sunrise mountains' },
            { emoji: '🌅', keywords: 'sunrise ocean' },
            { emoji: '🌆', keywords: 'cityscape dusk' },
            { emoji: '🌇', keywords: 'sunset city' },
            { emoji: '🌉', keywords: 'bridge night' },
            { emoji: '🎠', keywords: 'carousel horse ride' },
            { emoji: '🎡', keywords: 'ferris wheel fair' },
            { emoji: '🎢', keywords: 'roller coaster ride' },
            { emoji: '🎪', keywords: 'circus tent fun event' },
            
            // Objects
            { emoji: '⌚', keywords: 'watch time clock' },
            { emoji: '📱', keywords: 'phone mobile smartphone' },
            { emoji: '📲', keywords: 'phone arrow mobile' },
            { emoji: '💻', keywords: 'laptop computer' },
            { emoji: '⌨️', keywords: 'keyboard computer' },
            { emoji: '🖥️', keywords: 'desktop computer' },
            { emoji: '🖨️', keywords: 'printer computer' },
            { emoji: '🖱️', keywords: 'computer mouse' },
            { emoji: '🖲️', keywords: 'trackball mouse' },
            { emoji: '🕹️', keywords: 'joystick game controller' },
            { emoji: '🗜️', keywords: 'clamp compression tool' },
            { emoji: '💾', keywords: 'floppy disk save' },
            { emoji: '💿', keywords: 'optical disc cd' },
            { emoji: '📀', keywords: 'dvd disc' },
            { emoji: '📼', keywords: 'videocassette vhs tape' },
            { emoji: '📷', keywords: 'camera photo' },
            { emoji: '📸', keywords: 'camera flash photo' },
            { emoji: '📹', keywords: 'video camera' },
            { emoji: '🎥', keywords: 'movie camera film' },
            { emoji: '📽️', keywords: 'film projector movie' },
            { emoji: '🎞️', keywords: 'film frames movie' },
            { emoji: '📞', keywords: 'telephone receiver phone' },
            { emoji: '☎️', keywords: 'telephone phone' },
            { emoji: '📟', keywords: 'pager beeper' },
            { emoji: '📠', keywords: 'fax machine' },
            { emoji: '📺', keywords: 'television tv' },
            { emoji: '📻', keywords: 'radio music' },
            { emoji: '🎙️', keywords: 'microphone studio' },
            { emoji: '🎚️', keywords: 'level slider music' },
            { emoji: '🎛️', keywords: 'control knobs music' },
            { emoji: '🧭', keywords: 'compass navigation direction' },
            { emoji: '⏱️', keywords: 'stopwatch timer' },
            { emoji: '⏲️', keywords: 'timer clock alarm' },
            { emoji: '⏰', keywords: 'alarm clock time' },
            { emoji: '🕰️', keywords: 'mantelpiece clock time' },
            { emoji: '⏳', keywords: 'hourglass time flowing' },
            { emoji: '⌛', keywords: 'hourglass done time' },
            { emoji: '📡', keywords: 'satellite antenna' },
            { emoji: '🔋', keywords: 'battery power' },
            { emoji: '🔌', keywords: 'electric plug power' },
            { emoji: '💡', keywords: 'light bulb idea electricity' },
            { emoji: '🔦', keywords: 'flashlight torch' },
            { emoji: '🕯️', keywords: 'candle light fire' },
            { emoji: '🪔', keywords: 'diya lamp light' },
            { emoji: '🧯', keywords: 'fire extinguisher safety' },
            { emoji: '🛢️', keywords: 'oil drum barrel' },
            { emoji: '💸', keywords: 'money wings flying cash' },
            { emoji: '💵', keywords: 'dollar banknote money' },
            { emoji: '💴', keywords: 'yen banknote money' },
            { emoji: '💶', keywords: 'euro banknote money' },
            { emoji: '💷', keywords: 'pound banknote money' },
            { emoji: '🪙', keywords: 'coin money' },
            { emoji: '💰', keywords: 'money bag cash' },
            { emoji: '💳', keywords: 'credit card payment' },
            { emoji: '🧾', keywords: 'receipt bill' },
            { emoji: '💎', keywords: 'gem stone diamond' },
            { emoji: '⚖️', keywords: 'balance scale justice' },
            { emoji: '🪜', keywords: 'ladder climb high' },
            { emoji: '🧰', keywords: 'toolbox tools' },
            { emoji: '🪛', keywords: 'screwdriver tool' },
            { emoji: '🔧', keywords: 'wrench tool fix repair' },
            { emoji: '🔨', keywords: 'hammer tool' },
            { emoji: '⚒️', keywords: 'hammer pick tools' },
            { emoji: '🛠️', keywords: 'hammer wrench tools' },
            { emoji: '⛏️', keywords: 'pick tool mining' },
            { emoji: '🪚', keywords: 'saw tool carpentry' },
            { emoji: '🔩', keywords: 'nut bolt tool' },
            { emoji: '⚙️', keywords: 'gear settings mechanical' },
            { emoji: '🪤', keywords: 'mouse trap' },
            { emoji: '🧱', keywords: 'brick wall building' },
            { emoji: '⛓️', keywords: 'chains links' },
            { emoji: '🧲', keywords: 'magnet magnetic' },
            { emoji: '🔫', keywords: 'water gun pistol toy' },
            { emoji: '💣', keywords: 'bomb explosive' },
            { emoji: '🧨', keywords: 'firecracker dynamite' },
            { emoji: '🪓', keywords: 'axe tool chop' },
            { emoji: '🔪', keywords: 'knife cook kitchen cut' },
            { emoji: '🗡️', keywords: 'dagger sword weapon' },
            { emoji: '⚔️', keywords: 'crossed swords fight' },
            { emoji: '🛡️', keywords: 'shield protection' },
            { emoji: '🚬', keywords: 'cigarette smoking' },
            { emoji: '⚰️', keywords: 'coffin funeral' },
            { emoji: '🪦', keywords: 'headstone grave cemetery' },
            { emoji: '⚱️', keywords: 'funeral urn ashes' },
            { emoji: '🏺', keywords: 'amphora vase jar' },
            { emoji: '🔮', keywords: 'crystal ball fortune' },
            { emoji: '📿', keywords: 'prayer beads rosary' },
            { emoji: '🧿', keywords: 'nazar amulet evil eye' },
            { emoji: '💈', keywords: 'barber pole haircut' },
            { emoji: '⚗️', keywords: 'alembic chemistry science' },
            { emoji: '🔭', keywords: 'telescope astronomy space' },
            { emoji: '🔬', keywords: 'microscope science lab' },
            { emoji: '🕳️', keywords: 'hole' },
            { emoji: '🩹', keywords: 'adhesive bandage medical' },
            { emoji: '🩺', keywords: 'stethoscope medical doctor' },
            { emoji: '💊', keywords: 'pill medicine medical' },
            { emoji: '💉', keywords: 'syringe needle medical' },
            { emoji: '🩸', keywords: 'drop blood medical' },
            { emoji: '🧬', keywords: 'dna genetics science' },
            { emoji: '🦠', keywords: 'microbe virus bacteria' },
            { emoji: '🧫', keywords: 'petri dish science lab' },
            { emoji: '🧪', keywords: 'test tube science lab' },
            { emoji: '🌡️', keywords: 'thermometer temperature sick' },
            { emoji: '🧹', keywords: 'broom sweep clean chore' },
            { emoji: '🧺', keywords: 'basket laundry clean chore' },
            { emoji: '🧻', keywords: 'toilet paper bathroom roll' },
            { emoji: '🪣', keywords: 'bucket water clean mop chore' },
            { emoji: '🧼', keywords: 'soap clean wash bathroom bar' },
            { emoji: '🪥', keywords: 'toothbrush teeth brush dental' },
            { emoji: '🧽', keywords: 'sponge clean wash dish chore' },
            { emoji: '🧴', keywords: 'lotion soap bottle bathroom pump' },
            { emoji: '🛁', keywords: 'bath bathtub bathroom clean tub' },
            { emoji: '🪒', keywords: 'razor shave bathroom blade' },
            { emoji: '🪮', keywords: 'hair pick comb' },
            { emoji: '🚿', keywords: 'shower bathroom clean water' },
            { emoji: '🚽', keywords: 'toilet bathroom' },
            { emoji: '🪠', keywords: 'plunger toilet bathroom' },
            { emoji: '🚰', keywords: 'potable water tap drink' },
            { emoji: '🚿', keywords: 'shower head bathroom' },
            { emoji: '🛀', keywords: 'bath person bathtub' },
            { emoji: '🧖', keywords: 'person steamy room sauna spa' },
            { emoji: '🧴', keywords: 'lotion bottle' },
            { emoji: '💅', keywords: 'nail polish beauty' },
            { emoji: '💄', keywords: 'lipstick makeup beauty' },
            { emoji: '💍', keywords: 'ring diamond wedding' },
            { emoji: '💎', keywords: 'gem diamond jewel' },
            
            // School & Office
            { emoji: '🎒', keywords: 'backpack bag school book' },
            { emoji: '📚', keywords: 'books read study school homework pile' },
            { emoji: '📖', keywords: 'book read study school open' },
            { emoji: '📕', keywords: 'closed book red' },
            { emoji: '📗', keywords: 'green book closed' },
            { emoji: '📘', keywords: 'blue book closed' },
            { emoji: '📙', keywords: 'orange book closed' },
            { emoji: '📓', keywords: 'notebook school' },
            { emoji: '📔', keywords: 'notebook decorative cover' },
            { emoji: '📒', keywords: 'ledger notebook' },
            { emoji: '📃', keywords: 'page curl paper' },
            { emoji: '📜', keywords: 'scroll paper' },
            { emoji: '📄', keywords: 'page document paper' },
            { emoji: '📰', keywords: 'newspaper news paper' },
            { emoji: '🗞️', keywords: 'rolled newspaper news' },
            { emoji: '📑', keywords: 'bookmark tabs paper' },
            { emoji: '🔖', keywords: 'bookmark tag' },
            { emoji: '🏷️', keywords: 'label tag price' },
            { emoji: '💰', keywords: 'money bag dollar' },
            { emoji: '🪙', keywords: 'coin money' },
            { emoji: '💴', keywords: 'yen money' },
            { emoji: '💵', keywords: 'dollar money' },
            { emoji: '💶', keywords: 'euro money' },
            { emoji: '💷', keywords: 'pound money' },
            { emoji: '💸', keywords: 'money flying wings' },
            { emoji: '💳', keywords: 'credit card payment' },
            { emoji: '🧾', keywords: 'receipt bill invoice' },
            { emoji: '✉️', keywords: 'envelope mail letter' },
            { emoji: '📧', keywords: 'email mail letter' },
            { emoji: '📨', keywords: 'incoming envelope mail' },
            { emoji: '📩', keywords: 'envelope arrow mail' },
            { emoji: '📤', keywords: 'outbox tray mail' },
            { emoji: '📥', keywords: 'inbox tray mail' },
            { emoji: '📦', keywords: 'package box delivery' },
            { emoji: '📫', keywords: 'mailbox closed flag up' },
            { emoji: '📪', keywords: 'mailbox closed flag down' },
            { emoji: '📬', keywords: 'mailbox open flag up' },
            { emoji: '📭', keywords: 'mailbox open flag down' },
            { emoji: '📮', keywords: 'postbox mail' },
            { emoji: '🗳️', keywords: 'ballot box vote' },
            { emoji: '✏️', keywords: 'pencil write school homework draw' },
            { emoji: '✒️', keywords: 'pen nib write' },
            { emoji: '🖋️', keywords: 'fountain pen write' },
            { emoji: '🖊️', keywords: 'pen write school ballpoint' },
            { emoji: '🖌️', keywords: 'paintbrush art paint' },
            { emoji: '🖍️', keywords: 'crayon draw color' },
            { emoji: '📝', keywords: 'memo note write school paper' },
            { emoji: '📁', keywords: 'file folder documents' },
            { emoji: '📂', keywords: 'open file folder' },
            { emoji: '🗂️', keywords: 'card index dividers' },
            { emoji: '📅', keywords: 'calendar date' },
            { emoji: '📆', keywords: 'tear off calendar' },
            { emoji: '🗒️', keywords: 'spiral notepad paper' },
            { emoji: '🗓️', keywords: 'spiral calendar' },
            { emoji: '📇', keywords: 'card index rolodex' },
            { emoji: '📈', keywords: 'chart increasing graph' },
            { emoji: '📉', keywords: 'chart decreasing graph' },
            { emoji: '📊', keywords: 'bar chart graph' },
            { emoji: '📋', keywords: 'clipboard list checklist paper' },
            { emoji: '📌', keywords: 'pushpin pin note tack' },
            { emoji: '📍', keywords: 'round pushpin pin location' },
            { emoji: '📎', keywords: 'paperclip attach school clip' },
            { emoji: '🖇️', keywords: 'linked paperclips' },
            { emoji: '📏', keywords: 'straight ruler measure' },
            { emoji: '📐', keywords: 'triangular ruler triangle math school angle' },
            { emoji: '✂️', keywords: 'scissors cut craft snip' },
            { emoji: '🗃️', keywords: 'card file box storage' },
            { emoji: '🗄️', keywords: 'file cabinet storage' },
            { emoji: '🗑️', keywords: 'wastebasket trash bin' },
            
            // Symbols & Misc
            { emoji: '🔒', keywords: 'locked lock secure' },
            { emoji: '🔓', keywords: 'unlocked open lock' },
            { emoji: '🔏', keywords: 'locked pen key' },
            { emoji: '🔐', keywords: 'locked key secure' },
            { emoji: '🔑', keywords: 'key lock unlock' },
            { emoji: '🗝️', keywords: 'old key vintage' },
            { emoji: '🔨', keywords: 'hammer tool' },
            { emoji: '🪓', keywords: 'axe tool' },
            { emoji: '⛏️', keywords: 'pick tool' },
            { emoji: '⚒️', keywords: 'hammer pick tools' },
            { emoji: '🛠️', keywords: 'hammer wrench tools' },
            { emoji: '🗡️', keywords: 'dagger sword' },
            { emoji: '⚔️', keywords: 'crossed swords' },
            { emoji: '💣', keywords: 'bomb explosive' },
            { emoji: '🏹', keywords: 'bow arrow' },
            { emoji: '🛡️', keywords: 'shield protect' },
            { emoji: '🔧', keywords: 'wrench spanner tool' },
            { emoji: '🔩', keywords: 'nut bolt screw' },
            { emoji: '⚙️', keywords: 'gear cog settings' },
            { emoji: '⚗️', keywords: 'alembic chemistry' },
            { emoji: '⚖️', keywords: 'balance scale justice' },
            { emoji: '🔗', keywords: 'link chain connection' },
            { emoji: '⛓️', keywords: 'chains links' },
            { emoji: '💉', keywords: 'syringe medical needle' },
            { emoji: '💊', keywords: 'pill capsule medicine' },
            { emoji: '🩹', keywords: 'bandage adhesive medical' },
            { emoji: '🩺', keywords: 'stethoscope medical' },
            { emoji: '🚪', keywords: 'door entrance room exit' },
            { emoji: '🪟', keywords: 'window clean glass pane' },
            { emoji: '🛏️', keywords: 'bed bedroom sleep make furniture' },
            { emoji: '🛋️', keywords: 'couch sofa furniture living room lamp' },
            { emoji: '🪑', keywords: 'chair furniture room seat' },
            { emoji: '🚽', keywords: 'toilet bathroom' },
            { emoji: '🚿', keywords: 'shower bathroom' },
            { emoji: '🛁', keywords: 'bathtub bath bathroom' },
            { emoji: '🪒', keywords: 'razor shave' },
            { emoji: '🧴', keywords: 'lotion bottle' },
            { emoji: '🧷', keywords: 'safety pin' },
            { emoji: '🧹', keywords: 'broom sweep clean' },
            { emoji: '🧺', keywords: 'basket laundry' },
            { emoji: '🧻', keywords: 'roll paper toilet' },
            { emoji: '🧼', keywords: 'soap bar wash' },
            { emoji: '🧽', keywords: 'sponge clean' },
            { emoji: '🧯', keywords: 'fire extinguisher' },
            { emoji: '🛒', keywords: 'shopping cart trolley' },
            
            // Star and Achievement
            { emoji: '⭐', keywords: 'star reward achievement white' },
            { emoji: '🌟', keywords: 'glowing star shine' },
            { emoji: '💫', keywords: 'dizzy star spinning' },
            { emoji: '✨', keywords: 'sparkles sparkle shine clean star' },
            { emoji: '🎯', keywords: 'target goal achievement bullseye direct hit' },
            { emoji: '🎖️', keywords: 'military medal achievement' },
            { emoji: '🏆', keywords: 'trophy win achievement' },
            { emoji: '🥇', keywords: 'first place medal gold' },
            { emoji: '🥈', keywords: 'second place medal silver' },
            { emoji: '🥉', keywords: 'third place medal bronze' },
            { emoji: '🏅', keywords: 'sports medal achievement' },
            { emoji: '🎗️', keywords: 'reminder ribbon' },
            { emoji: '🎫', keywords: 'ticket admission' },
        ];
        
        const grid = document.getElementById('emojiPickerGrid');
        grid.innerHTML = emojiData.map(item => 
            `<div class="emoji-picker-item" data-keywords="${item.keywords}" onclick="selectEmoji('${item.emoji}')">${item.emoji}</div>`
        ).join('');
        
        // Parse emojis with Twemoji after populating
        if (typeof twemoji !== 'undefined') {
            twemoji.parse(grid, {
                folder: 'svg',
                ext: '.svg'
            });
        }
    }
    
    function filterEmojis() {
        const searchTerm = document.getElementById('emojiSearchInput').value.toLowerCase();
        const emojiItems = document.querySelectorAll('.emoji-picker-item');
        
        emojiItems.forEach(item => {
            const keywords = item.getAttribute('data-keywords');
            if (keywords.includes(searchTerm) || searchTerm === '') {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });
    }
    
    function toggleEmojiPicker(event) {
        event.stopPropagation();
        const dropdown = document.getElementById('emojiPickerDropdown');
        const searchInput = document.getElementById('emojiSearchInput');
        
        dropdown.classList.toggle('active');
        
        // Clear search and reset view when opening
        if (dropdown.classList.contains('active')) {
            searchInput.value = '';
            filterEmojis();
            setTimeout(() => searchInput.focus(), 100);
            
            // Close dropdown when clicking outside
            setTimeout(() => {
                document.addEventListener('click', closeEmojiPicker);
            }, 0);
        }
    }
    
    function closeEmojiPicker() {
        const dropdown = document.getElementById('emojiPickerDropdown');
        dropdown.classList.remove('active');
        document.removeEventListener('click', closeEmojiPicker);
    }
    
    function selectEmoji(emoji) {
        document.getElementById('taskChoreEmoji').value = emoji;
        closeEmojiPicker();
    }
    
    function renderProfileGrid() {
        const grid = document.getElementById('taskProfileGrid');
        const choreMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        let html = '';
        choreMembers.forEach(member => {
            const isSelected = selectedProfiles.includes(member.name);
            html += `<div class="edit-profile-item" onclick="toggleProfile('${member.name}')">
                <div class="edit-profile-avatar ${isSelected ? 'selected' : ''}" style="background: ${member.color}" data-member="${member.name}">
                    ${member.name.charAt(0).toUpperCase()}
                </div>
                <div class="edit-profile-name">${member.name}</div>
            </div>`;
        });
        
        html += `<div class="edit-profile-item">
            <div class="edit-profile-avatar" style="background: #e0e0e0; color: #666;">+</div>
            <div class="edit-profile-name">Add</div>
        </div>`;
        
        grid.innerHTML = html;
    }
    
    function toggleProfile(profileName) {
        const index = selectedProfiles.indexOf(profileName);
        if (index > -1) {
            selectedProfiles.splice(index, 1);
        } else {
            selectedProfiles.push(profileName);
        }
        renderProfileGrid();
    }
    
    function setTaskType(type) {
        currentTaskType = type;
        document.getElementById('choreTypeBtn').classList.toggle('active', type === 'chore');
        document.getElementById('routineTypeBtn').classList.toggle('active', type === 'routine');
        
        // Show/hide repeat section based on type
        document.getElementById('taskRepeatSection').style.display = type === 'chore' ? 'flex' : 'none';
        
        // Show/hide stars section based on type (both chores and routines can have stars)
        document.getElementById('taskStarsSection').style.display = 'flex';
    }
    
    function changeRepeatEvery(delta) {
        const input = document.getElementById('taskRepeatEvery');
        const currentValue = parseInt(input.value) || 1;
        const newValue = Math.max(1, currentValue + delta);
        input.value = newValue;
    }
    
    function saveTaskChore() {
        const title = document.getElementById('taskChoreTitle').value;
        const emoji = document.getElementById('taskChoreEmoji').value;
        const date = document.getElementById('taskChoreDate').value;
        const time = document.getElementById('taskChoreTime').value;
        const stars = parseInt(document.getElementById('taskChoreStars').value) || 0;
        const hasDate = document.getElementById('taskChoreDateToggle').checked;
        const hasTime = document.getElementById('taskChoreTimeToggle').checked;
        const hasRepeat = document.getElementById('taskChoreRepeatToggle') && getElementById('taskChoreRepeatToggle').checked;
        
        if (!title || selectedProfiles.length === 0) {
            alert('Please enter a title and select at least one profile');
            return;
        }
        
        selectedProfiles.forEach(profileName => {
            if (currentTaskType === 'routine') {
                // Determine period based on time
                let period = 'Morning';
                if (hasTime && time) {
                    const hour = parseInt(time.split(':')[0]);
                    if (hour >= 12 && hour < 18) period = 'Afternoon';
                    else if (hour >= 18) period = 'Evening';
                }
                
                const newRoutine = {
                    id: Date.now() + Math.random(),
                    member: profileName,
                    period: period,
                    title: title,
                    icon: emoji,
                    completed: false,
                    stars: stars
                };
                
                routines.push(newRoutine);
            } else {
                const newChore = {
                    id: Date.now() + Math.random(),
                    member: profileName,
                    title: title,
                    icon: emoji,
                    frequency: hasRepeat ? getFrequencyText() : 'Once',
                    dueDate: hasDate ? date : null,
                    time: hasTime ? time : null,
                    completed: false,
                    stars: stars
                };
                
                chores.push(newChore);
            }
        });
        
        localStorage.setItem('chores', JSON.stringify(chores));
        localStorage.setItem('routines', JSON.stringify(routines));
        
        // Reset form
        document.getElementById('taskChoreTitle').value = '';
        document.getElementById('taskChoreEmoji').value = '';
        document.getElementById('taskChoreStars').value = '5';
        selectedProfiles = [];
        
        closeModal('taskChoreModal');
        renderChoresView();
    }
    
    function getFrequencyText() {
        const every = document.getElementById('taskRepeatEvery').value;
        const unit = document.getElementById('taskRepeatUnit').value;
        return `Every ${every} ${unit}${every > 1 ? 's' : ''}`;
    }
    
    // Toggle repeat details when repeat checkbox is changed
    document.addEventListener('DOMContentLoaded', function() {
        const repeatToggle = document.getElementById('taskChoreRepeatToggle');
        if (repeatToggle) {
            repeatToggle.addEventListener('change', function() {
                document.getElementById('taskRepeatDetails').style.display = this.checked ? 'block' : 'none';
            });
        }
    });
    
    // Edit and Detail Modal Functions
    let currentEditTaskId = null;
    let currentEditTaskType = null;
    
    function openTaskDetail(taskId, taskType, event) {
        if (event) event.stopPropagation();
        
        currentEditTaskId = taskId;
        currentEditTaskType = taskType;
        
        const task = taskType === 'chore' ? chores.find(c => c.id === taskId) : routines.find(r => r.id === taskId);
        if (!task) return;
        
        // Populate detail modal
        document.getElementById('detailTaskTitle').textContent = task.title;
        
        // Format date/time
        if (task.dueDate || task.time) {
            const dateText = task.dueDate ? new Date(task.dueDate).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' }) : 'Any day';
            const timeText = task.time ? `, ${task.time}` : '';
            document.getElementById('detailDateText').textContent = dateText + timeText;
        } else {
            document.getElementById('detailDateText').textContent = 'No specific date';
        }
        
        // Show repeat info if applicable
        if (task.frequency && taskType === 'chore') {
            document.getElementById('detailTaskRepeat').style.display = 'flex';
            document.getElementById('detailRepeatText').textContent = task.frequency;
        } else {
            document.getElementById('detailTaskRepeat').style.display = 'none';
        }
        
        // Show assigned member
        const member = familyMembers.find(m => m.name === task.member);
        const assignedHtml = member ? 
            `<div class="task-detail-avatar" style="background: ${member.color}">${member.name.charAt(0).toUpperCase()}</div>
             <span>${member.name}</span>` : 
            '<span>Unassigned</span>';
        document.getElementById('detailAssignedTo').innerHTML = assignedHtml;
        
        // Update complete button
        const completeBtn = document.getElementById('detailCompleteBtn');
        if (member) {
            completeBtn.style.background = member.color;
        }
        completeBtn.textContent = task.completed ? 'Mark as Incomplete' : 'Mark as Complete';
        
        document.getElementById('taskDetailModal').classList.add('active');
    }
    
    function toggleCurrentTask() {
        if (currentEditTaskType === 'chore') {
            toggleChore(currentEditTaskId);
        } else {
            toggleRoutine(currentEditTaskId);
        }
        closeModal('taskDetailModal');
    }
    
    function deleteCurrentTask() {
        if (!confirm('Are you sure you want to delete this task?')) return;
        
        if (currentEditTaskType === 'chore') {
            const index = chores.findIndex(c => c.id === currentEditTaskId);
            if (index > -1) {
                chores.splice(index, 1);
                localStorage.setItem('chores', JSON.stringify(chores));
            }
        } else {
            const index = routines.findIndex(r => r.id === currentEditTaskId);
            if (index > -1) {
                routines.splice(index, 1);
                localStorage.setItem('routines', JSON.stringify(routines));
            }
        }
        
        closeModal('taskDetailModal');
        closeEditPanel();
        renderChoresView();
    }
    
    function openEditPanelFromDetail() {
        closeModal('taskDetailModal');
        openEditPanel();
    }
    
    function openEditPanel() {
        const task = currentEditTaskType === 'chore' ? 
            chores.find(c => c.id === currentEditTaskId) : 
            routines.find(r => r.id === currentEditTaskId);
        
        if (!task) return;
        
        // Populate edit form
        document.getElementById('editTaskTitle').value = task.title || '';
        document.getElementById('editTaskEmoji').value = task.icon || '';
        document.getElementById('editTaskDate').value = task.dueDate || '';
        document.getElementById('editTaskTime').value = task.time || '';
        document.getElementById('editTaskStars').value = task.stars || 5;
        
        // Set toggles
        document.getElementById('editTaskDateToggle').checked = !!task.dueDate;
        document.getElementById('editTaskTimeToggle').checked = !!task.time;
        updateEditDateVisibility();
        updateEditTimeVisibility();
        
        // Set task type
        setEditTaskType(currentEditTaskType);
        
        // Render profile grid with current member selected
        renderEditProfileGrid(task.member);
        
        // Initialize emoji picker for edit panel
        initializeEditEmojiPicker();
        
        // Show panel
        document.getElementById('editPanelOverlay').classList.add('active');
        document.getElementById('editSidePanel').classList.add('active');
    }
    
    function closeEditPanel() {
        document.getElementById('editPanelOverlay').classList.remove('active');
        document.getElementById('editSidePanel').classList.remove('active');
    }
    
    function renderEditProfileGrid(selectedMember) {
        const grid = document.getElementById('editProfileGrid');
        const choreMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        let html = '';
        choreMembers.forEach(member => {
            const isSelected = member.name === selectedMember;
            html += `<div class="edit-profile-item" onclick="selectEditProfile('${member.name}')">
                <div class="edit-profile-avatar ${isSelected ? 'selected' : ''}" style="background: ${member.color}" data-member="${member.name}">
                    ${member.name.charAt(0).toUpperCase()}
                </div>
                <div class="edit-profile-name">${member.name}</div>
            </div>`;
        });
        
        grid.innerHTML = html;
    }
    
    function selectEditProfile(memberName) {
        document.querySelectorAll('.edit-profile-avatar').forEach(avatar => {
            avatar.classList.remove('selected');
        });
        document.querySelector(`.edit-profile-avatar[data-member="${memberName}"]`).classList.add('selected');
    }
    
    function setEditTaskType(type) {
        currentEditTaskType = type;
        document.getElementById('editChoreTypeBtn').classList.toggle('active', type === 'chore');
        document.getElementById('editRoutineTypeBtn').classList.toggle('active', type === 'routine');
    }
    
    function updateEditDateVisibility() {
        const checked = document.getElementById('editTaskDateToggle').checked;
        document.getElementById('editTaskDate').style.display = checked ? 'block' : 'none';
    }
    
    function updateEditTimeVisibility() {
        const checked = document.getElementById('editTaskTimeToggle').checked;
        document.getElementById('editTaskTime').style.display = checked ? 'block' : 'none';
    }
    
    function initializeEditEmojiPicker() {
        const grid = document.getElementById('editEmojiPickerGrid');
        if (grid.innerHTML) return; // Already initialized
        
        const emojiData = document.getElementById('emojiPickerGrid').innerHTML;
        grid.innerHTML = emojiData.replace(/onclick="selectEmoji/g, 'onclick="selectEditEmoji');
        
        // Parse emojis with Twemoji after populating
        if (typeof twemoji !== 'undefined') {
            twemoji.parse(grid, {
                folder: 'svg',
                ext: '.svg'
            });
        }
    }
    
    function toggleEditEmojiPicker(event) {
        event.stopPropagation();
        const dropdown = document.getElementById('editEmojiPickerDropdown');
        dropdown.classList.toggle('active');
    }
    
    function filterEditEmojis() {
        const searchTerm = document.getElementById('editEmojiSearchInput').value.toLowerCase();
        const emojiItems = document.querySelectorAll('#editEmojiPickerGrid .emoji-picker-item');
        
        emojiItems.forEach(item => {
            const keywords = item.getAttribute('data-keywords');
            if (keywords && (keywords.includes(searchTerm) || searchTerm === '')) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });
    }
    
    function selectEditEmoji(emoji) {
        document.getElementById('editTaskEmoji').value = emoji;
        document.getElementById('editEmojiPickerDropdown').classList.remove('active');
    }
    
    function saveEditedTask() {
        const title = document.getElementById('editTaskTitle').value;
        const emoji = document.getElementById('editTaskEmoji').value;
        const date = document.getElementById('editTaskDate').value;
        const time = document.getElementById('editTaskTime').value;
        const stars = parseInt(document.getElementById('editTaskStars').value) || 0;
        const hasDate = document.getElementById('editTaskDateToggle').checked;
        const hasTime = document.getElementById('editTaskTimeToggle').checked;
        
        const selectedAvatar = document.querySelector('.edit-profile-avatar.selected');
        const member = selectedAvatar ? selectedAvatar.getAttribute('data-member') : null;
        
        if (!title || !member) {
            alert('Please enter a title and select a profile');
            return;
        }
        
        if (currentEditTaskType === 'chore') {
            const chore = chores.find(c => c.id === currentEditTaskId);
            if (chore) {
                chore.title = title;
                chore.icon = emoji;
                chore.member = member;
                chore.dueDate = hasDate ? date : null;
                chore.time = hasTime ? time : null;
                chore.stars = stars;
                localStorage.setItem('chores', JSON.stringify(chores));
            }
        } else {
            const routine = routines.find(r => r.id === currentEditTaskId);
            if (routine) {
                routine.title = title;
                routine.icon = emoji;
                routine.member = member;
                routine.stars = stars;
                
                // Determine period based on time if available
                if (hasTime && time) {
                    const hour = parseInt(time.split(':')[0]);
                    if (hour >= 12 && hour < 18) routine.period = 'Afternoon';
                    else if (hour >= 18) routine.period = 'Evening';
                    else routine.period = 'Morning';
                }
                
                localStorage.setItem('routines', JSON.stringify(routines));
            }
        }
        
        closeEditPanel();
        renderChoresView();
    }
    
    function toggleChore(choreId) {
        const chore = chores.find(c => c.id === choreId);
        if (chore) {
            const wasCompleted = chore.completed;
            chore.completed = !chore.completed;
            if (chore.completed) {
                chore.completedDate = new Date().toISOString().split('T')[0];
            } else {
                delete chore.completedDate;
            }
            localStorage.setItem('chores', JSON.stringify(chores));
            
            // Check if member completed all their chores
            if (!wasCompleted && chore.completed) {
                checkAllTasksComplete(chore.member);
            }
            
            renderChoresView();
            // Update family pills if on calendar view
            if (currentSection === 'calendar') {
                renderFamilyPills();
            }
        }
    }
    
    function checkAllTasksComplete(memberName) {
        console.log(`Checking completion for ${memberName}`);
        
        // Check all chores assigned to this person
        const memberChores = chores.filter(c => c.member === memberName);
        const completedChores = memberChores.filter(c => c.completed);
        const allChoresComplete = memberChores.length > 0 && memberChores.length === completedChores.length;
        
        // Check all routines assigned to this person
        const memberRoutines = routines.filter(r => r.member === memberName);
        const completedRoutines = memberRoutines.filter(r => r.completed);
        const allRoutinesComplete = memberRoutines.length > 0 && memberRoutines.length === completedRoutines.length;
        
        console.log(`${memberName} - Chores: ${completedChores.length}/${memberChores.length}, Routines: ${completedRoutines.length}/${memberRoutines.length}`);
        
        // Trigger confetti if all chores complete
        if (allChoresComplete) {
            console.log(`🎉 All chores complete for ${memberName}!`);
            triggerConfetti();
        }
        
        // Also trigger if all routines complete (separate celebration)
        if (allRoutinesComplete) {
            console.log(`🎉 All routines complete for ${memberName}!`);
            triggerConfetti();
        }
    }
    
    function triggerConfetti() {
        console.log('🎉 Confetti function called!');
        // Create confetti container
        const container = document.createElement('div');
        container.className = 'confetti-container';
        document.body.appendChild(container);
        
        const colors = ['#FF6B6B', '#4ECDC4', '#D9B554', '#DDC2F0', '#95E1D3', '#F38181', '#AA96DA', '#4A90E2'];
        const confettiCount = 200;
        
        for (let i = 0; i < confettiCount; i++) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            confetti.style.width = (Math.random() * 8 + 6) + 'px';
            confetti.style.height = (Math.random() * 8 + 6) + 'px';
            confetti.style.animationDelay = (Math.random() * 0.3) + 's';
            confetti.style.animationDuration = (Math.random() * 1.5 + 2.5) + 's';
            confetti.style.animationName = 'confetti-fall';
            confetti.style.animationTimingFunction = 'linear';
            confetti.style.animationFillMode = 'forwards';
            
            container.appendChild(confetti);
        }
        
        console.log(`✨ Created ${confettiCount} confetti pieces!`);
        
        // Remove container after animation
        setTimeout(() => {
            if (container.parentNode) {
                container.remove();
                console.log('Confetti removed');
            }
        }, 5000);
    }
    
    function triggerStarConfetti() {
        console.log('⭐ Star confetti function called!');
        // Create star container
        const container = document.createElement('div');
        container.className = 'confetti-container';
        document.body.appendChild(container);
        
        const starColors = ['#FFD700', '#FFA500', '#FFDF00', '#FFE55C', '#FFC107', '#FFEB3B'];
        const starCount = 100;
        const starEmojis = ['⭐', '✨', '🌟', '💫'];
        
        // Get center of screen
        const centerX = window.innerWidth / 2;
        const centerY = window.innerHeight / 2;
        
        for (let i = 0; i < starCount; i++) {
            const star = document.createElement('div');
            star.className = 'star-confetti';
            star.textContent = starEmojis[Math.floor(Math.random() * starEmojis.length)];
            
            // Position at center
            star.style.left = centerX + 'px';
            star.style.top = centerY + 'px';
            
            // Random explosion direction and distance
            const angle = (Math.random() * 360) * (Math.PI / 180);
            const distance = Math.random() * 400 + 200; // 200-600px
            const tx = Math.cos(angle) * distance;
            const ty = Math.sin(angle) * distance;
            
            star.style.setProperty('--tx', tx + 'px');
            star.style.setProperty('--ty', ty + 'px');
            
            star.style.color = starColors[Math.floor(Math.random() * starColors.length)];
            star.style.fontSize = (Math.random() * 15 + 15) + 'px';
            star.style.animationDelay = (Math.random() * 0.2) + 's';
            star.style.animationDuration = (Math.random() * 1 + 1.5) + 's';
            star.style.animationName = 'star-explode';
            star.style.animationTimingFunction = 'ease-out';
            star.style.animationFillMode = 'forwards';
            
            container.appendChild(star);
        }
        
        console.log(`✨ Created ${starCount} exploding stars!`);
        
        // Remove container after animation
        setTimeout(() => {
            if (container.parentNode) {
                container.remove();
                console.log('Star confetti removed');
            }
        }, 3000);
    }

    function switchView(view) {
        currentView = view;
        
        // Update dropdown
        const dropdown = document.getElementById('mainViewSelector');
        if (dropdown) dropdown.value = view;
        
        // Hide all views
        document.getElementById('calendarGrid').style.display = 'none';
        document.getElementById('weekView').classList.remove('active');
        document.getElementById('scheduleView').classList.remove('active');
        document.getElementById('dayView').classList.remove('active');
        
        // Show floating add button for all calendar views
        document.getElementById('floatingAddBtn').classList.add('active');
        
        // Show selected view
        if (view === 'month') {
            document.getElementById('calendarGrid').style.display = 'grid';
            renderCalendar();
        } else if (view === 'week') {
            document.getElementById('weekView').classList.add('active');
            renderWeekView();
        } else if (view === 'schedule') {
            document.getElementById('scheduleView').classList.add('active');
            renderScheduleView();
        } else if (view === 'day') {
            document.getElementById('dayView').classList.add('active');
            renderDayView();
        }
        
        updateViewHeader();
    }

    function switchViewFromDropdown(view) {
        switchView(view);
    }

    function goToToday() {
        if (currentSection === 'meals') {
            goToMealToday();
        } else {
            currentDate = new Date();
            if (currentView === 'month') renderCalendar();
            else if (currentView === 'week') renderWeekView();
            else if (currentView === 'schedule') renderScheduleView();
            else if (currentView === 'day') renderDayView();
            updateViewHeader();
        }
    }

    function navigateDay(direction) {
        if (currentSection === 'meals') {
            navigateMealWeek(direction);
        } else {
            currentDate.setDate(currentDate.getDate() + direction);
            if (currentView === 'day') renderDayView();
            updateViewHeader();
        }
    }

    function openEventModal() {
        document.getElementById('eventPanelOverlay').classList.add('active');
        document.getElementById('eventModal').classList.add('active');
        document.getElementById('eventDate').valueAsDate = new Date();
        updateEventTimeVisibility();
    }

    function openTaskModal() {
        document.getElementById('taskModal').classList.add('active');
        document.getElementById('taskDate').valueAsDate = new Date();
    }

    function openMealModal() {
        document.getElementById('mealModal').classList.add('active');
        document.getElementById('mealDate').valueAsDate = new Date();
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
        // Also close panel overlays
        if (modalId === 'taskChoreModal') {
            document.getElementById('taskChorePanelOverlay').classList.remove('active');
        }
        if (modalId === 'eventModal') {
            document.getElementById('eventPanelOverlay').classList.remove('active');
        }
    }
    
    function handleModalBackdropClick(event, modalId) {
        // Only close if clicking the backdrop (not the modal content)
        if (event.target.classList.contains('modal')) {
            closeModal(modalId);
        }
    }

    function autoAssignEventMember(title) {
        console.log('Auto-assigning for title:', title);
        
        // Check if title contains any family member's name
        const lowerTitle = title.toLowerCase();
        
        for (let member of familyMembers) {
            const lowerName = member.name.toLowerCase();
            
            console.log('Checking member:', member.name);
            
            // Check for exact name match (with word boundaries)
            const nameRegex = new RegExp(`\\b${lowerName}\\b`, 'i');
            if (nameRegex.test(title)) {
                console.log('✅ Match found (exact):', member.name);
                return member.name;
            }
            
            // Check for possessive forms like "Mary's" or "Bret's"
            if (lowerTitle.includes(lowerName + "'s") || lowerTitle.includes(lowerName + "s")) {
                console.log('✅ Match found (possessive):', member.name);
                return member.name;
            }
        }
        
        console.log('❌ No match found');
        // No match found, return empty string (unassigned)
        return '';
    }
    
    function saveEvent() {
        const isAllDay = document.getElementById('eventAllDayToggle').checked;
        const title = document.getElementById('eventTitle').value;
        const selectedMember = document.getElementById('eventMember').value;
        
        console.log('Event title:', title);
        console.log('Selected member:', selectedMember);
        
        // Auto-assign member if not manually selected or if empty string
        let assignedMember = selectedMember;
        if (!selectedMember || selectedMember === '') {
            assignedMember = autoAssignEventMember(title);
            console.log('Auto-assigned to:', assignedMember);
        }
        
        const event = {
            id: Date.now(),
            title: title,
            date: document.getElementById('eventDate').value,
            endDate: document.getElementById('eventEndDate').value,
            time: isAllDay ? '' : document.getElementById('eventTime').value,
            endTime: isAllDay ? '' : document.getElementById('eventEndTime').value,
            member: assignedMember,
            notes: document.getElementById('eventNotes').value
        };
        
        console.log('Saving event:', event);
        
        events.push(event);
        localStorage.setItem('events', JSON.stringify(events));
        closeModal('eventModal');
        
        // Re-render current view
        if (currentView === 'month') renderCalendar();
        else if (currentView === 'week') renderWeekView();
        else if (currentView === 'schedule') renderScheduleView();
        else if (currentView === 'day') renderDayView();
        
        // Clear form
        document.getElementById('eventTitle').value = '';
        document.getElementById('eventEndDate').value = '';
        document.getElementById('eventTime').value = '';
        document.getElementById('eventEndTime').value = '';
        document.getElementById('eventNotes').value = '';
        document.getElementById('eventMember').value = '';
        document.getElementById('eventAllDayToggle').checked = true;
    }

    function saveTask() {
        const task = {
            id: Date.now(),
            title: document.getElementById('taskTitle').value,
            date: document.getElementById('taskDate').value,
            member: document.getElementById('taskMember').value,
            completed: false
        };
        tasks.push(task);
        localStorage.setItem('tasks', JSON.stringify(tasks));
        closeModal('taskModal');
        renderTasks();
        renderAllTasks();
        // Update family pills if on calendar view
        if (currentSection === 'calendar') {
            renderFamilyPills();
        }
        document.getElementById('taskTitle').value = '';
    }

    function saveMeal() {
        const meal = {
            id: Date.now(),
            date: document.getElementById('mealDate').value,
            name: document.getElementById('mealName').value
        };
        meals.push(meal);
        localStorage.setItem('meals', JSON.stringify(meals));
        closeModal('mealModal');
        renderMeals();
        document.getElementById('mealName').value = '';
    }
    
    function handleFloatingAdd() {
        if (currentSection === 'rewards') {
            openRewardModal();
        } else if (currentSection === 'lists') {
            openAddListPanel();
        } else {
            openTaskChoreModal();
        }
    }
    
    function openRewardModal() {
        document.getElementById('rewardModal').classList.add('active');
        renderRewardProfileGrid();
        initializeRewardEmojiPicker();
    }
    
    function renderRewardProfileGrid() {
        const grid = document.getElementById('rewardProfileGrid');
        const rewardMembers = familyMembers.filter(m => !m.isGoogleCalendar);
        
        let html = '';
        rewardMembers.forEach(member => {
            html += `<div class="task-profile-item" onclick="selectRewardProfile('${member.name}')">
                <div class="task-profile-avatar" id="reward-avatar-${member.name}" style="background: ${member.color}">
                    ${member.name.charAt(0).toUpperCase()}
                </div>
                <div class="task-profile-name">${member.name}</div>
            </div>`;
        });
        
        grid.innerHTML = html;
    }
    
    let selectedRewardProfile = null;
    
    function selectRewardProfile(profileName) {
        selectedRewardProfile = profileName;
        // Update visual selection
        document.querySelectorAll('#rewardProfileGrid .task-profile-avatar').forEach(avatar => {
            avatar.classList.remove('selected');
        });
        document.getElementById(`reward-avatar-${profileName}`).classList.add('selected');
    }
    
    function initializeRewardEmojiPicker() {
        const emojiData = [
            { emoji: '🧸', keywords: 'teddy bear toy stuffed' },
            { emoji: '🎮', keywords: 'game controller video game' },
            { emoji: '🍿', keywords: 'popcorn movie snack' },
            { emoji: '🎬', keywords: 'movie film cinema' },
            { emoji: '🏖️', keywords: 'beach vacation sand' },
            { emoji: '⛱️', keywords: 'umbrella beach' },
            { emoji: '🎡', keywords: 'ferris wheel fair carnival' },
            { emoji: '🎢', keywords: 'roller coaster amusement park' },
            { emoji: '🎪', keywords: 'circus tent' },
            { emoji: '🎨', keywords: 'art paint palette' },
            { emoji: '🛍️', keywords: 'shopping bags mall' },
            { emoji: '👗', keywords: 'dress clothes shopping' },
            { emoji: '👟', keywords: 'shoes sneaker' },
            { emoji: '🍕', keywords: 'pizza food' },
            { emoji: '🍔', keywords: 'burger hamburger food' },
            { emoji: '🍦', keywords: 'ice cream dessert' },
            { emoji: '🍰', keywords: 'cake dessert birthday' },
            { emoji: '🍩', keywords: 'donut doughnut dessert' },
            { emoji: '🍪', keywords: 'cookie dessert' },
            { emoji: '🎁', keywords: 'gift present' },
            { emoji: '🎈', keywords: 'balloon party' },
            { emoji: '🎉', keywords: 'party celebration' },
            { emoji: '✨', keywords: 'sparkle shine' },
            { emoji: '⭐', keywords: 'star' },
            { emoji: '🌟', keywords: 'glowing star' },
            { emoji: '💎', keywords: 'gem diamond' },
            { emoji: '👑', keywords: 'crown king queen' },
            { emoji: '🏆', keywords: 'trophy award winner' },
            { emoji: '🥇', keywords: 'gold medal first place' },
            { emoji: '🎯', keywords: 'target goal' },
            { emoji: '🚗', keywords: 'car vehicle' },
            { emoji: '🚲', keywords: 'bike bicycle' },
            { emoji: '🛴', keywords: 'scooter kick' },
            { emoji: '⚽', keywords: 'soccer ball sports' },
            { emoji: '🏀', keywords: 'basketball sports' },
            { emoji: '⚾', keywords: 'baseball sports' },
            { emoji: '🏈', keywords: 'football sports' },
            { emoji: '🎾', keywords: 'tennis sports' },
            { emoji: '🏐', keywords: 'volleyball sports' },
            { emoji: '🏊', keywords: 'swimming pool' },
            { emoji: '🎣', keywords: 'fishing' },
            { emoji: '⛳', keywords: 'golf flag' },
            { emoji: '🎳', keywords: 'bowling' },
            { emoji: '🎯', keywords: 'dart target' },
            { emoji: '🎲', keywords: 'dice game' },
            { emoji: '🧩', keywords: 'puzzle piece' },
            { emoji: '🪁', keywords: 'kite flying' },
            { emoji: '🎸', keywords: 'guitar music' },
            { emoji: '🎹', keywords: 'piano keyboard music' },
            { emoji: '🎤', keywords: 'microphone singing karaoke' },
            { emoji: '🎧', keywords: 'headphones music' },
            { emoji: '📱', keywords: 'phone mobile' },
            { emoji: '💻', keywords: 'laptop computer' },
            { emoji: '🖥️', keywords: 'desktop computer' },
            { emoji: '📚', keywords: 'books reading' },
            { emoji: '📖', keywords: 'book reading' },
            { emoji: '🥤', keywords: 'drink soda cup' },
            { emoji: '🧃', keywords: 'juice box drink' },
            { emoji: '💰', keywords: 'money bag cash' },
            { emoji: '💵', keywords: 'dollar money cash' }
        ];
        
        const grid = document.getElementById('rewardEmojiPickerGrid');
        grid.innerHTML = emojiData.map(item => 
            `<div class="emoji-picker-item" data-keywords="${item.keywords}" onclick="selectRewardEmoji('${item.emoji}')">${item.emoji}</div>`
        ).join('');
        
        // Parse emojis with Twemoji after populating
        if (typeof twemoji !== 'undefined') {
            twemoji.parse(grid, {
                folder: 'svg',
                ext: '.svg'
            });
        }
    }
    
    function toggleRewardEmojiPicker(event) {
        event.stopPropagation();
        const dropdown = document.getElementById('rewardEmojiPickerDropdown');
        const searchInput = document.getElementById('rewardEmojiSearchInput');
        
        dropdown.classList.toggle('active');
        
        if (dropdown.classList.contains('active')) {
            searchInput.value = '';
            filterRewardEmojis();
            setTimeout(() => searchInput.focus(), 100);
            
            setTimeout(() => {
                document.addEventListener('click', closeRewardEmojiPicker);
            }, 0);
        }
    }
    
    function closeRewardEmojiPicker() {
        const dropdown = document.getElementById('rewardEmojiPickerDropdown');
        dropdown.classList.remove('active');
        document.removeEventListener('click', closeRewardEmojiPicker);
    }
    
    function selectRewardEmoji(emoji) {
        document.getElementById('rewardEmoji').value = emoji;
        const display = document.getElementById('rewardEmojiDisplay');
        display.textContent = emoji;
        closeRewardEmojiPicker();
        
        // Parse the emoji with Twemoji
        if (typeof twemoji !== 'undefined') {
            twemoji.parse(display, {
                folder: 'svg',
                ext: '.svg'
            });
        }
    }
    
    function filterRewardEmojis() {
        const searchTerm = document.getElementById('rewardEmojiSearchInput').value.toLowerCase();
        const emojiItems = document.querySelectorAll('#rewardEmojiPickerGrid .emoji-picker-item');
        
        emojiItems.forEach(item => {
            const keywords = item.getAttribute('data-keywords');
            if (keywords.includes(searchTerm) || searchTerm === '') {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });
    }
    
    function saveReward() {
        const title = document.getElementById('rewardTitle').value;
        const emoji = document.getElementById('rewardEmoji').value;
        const stars = parseInt(document.getElementById('rewardStars').value) || 25;
        
        if (!title || !selectedRewardProfile) {
            alert('Please enter a title and select a profile');
            return;
        }
        
        const newReward = {
            id: Date.now(),
            member: selectedRewardProfile,
            title: title,
            emoji: emoji || '🎁',
            starsNeeded: stars,
            redeemed: false
        };
        
        rewards.push(newReward);
        localStorage.setItem('rewards', JSON.stringify(rewards));
        
        // Reset form
        document.getElementById('rewardTitle').value = '';
        document.getElementById('rewardEmoji').value = '';
        document.getElementById('rewardStars').value = '25';
        selectedRewardProfile = null;
        
        closeModal('rewardModal');
        renderRewardsView();
    }


    function renderTasks() {
        const today = new Date().toISOString().split('T')[0];
        const todayTasks = tasks.filter(t => t.date === today);
        const list = document.getElementById('taskList');
        
        if (todayTasks.length === 0) {
            list.innerHTML = '<li style="padding: 10px; color: #999;">No tasks for today</li>';
            return;
        }

        list.innerHTML = todayTasks.map(task => {
            const member = familyMembers.find(m => m.name === task.member);
            return `
                <li class="task-item ${task.completed ? 'completed' : ''}" style="border-left: 4px solid ${(member && member.color) || '#667eea'}">
                    <input type="checkbox" ${task.completed ? 'checked' : ''} 
                           onchange="toggleTask(${task.id})">
                    <span>${task.title} ${task.member ? `(${task.member})` : ''}</span>
                </li>
            `;
        }).join('');
    }

    function toggleTask(id) {
        const task = tasks.find(t => t.id === id);
        if (task) {
            task.completed = !task.completed;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            renderTasks();
            renderAllTasks();
            // Update family pills if on calendar view
            if (currentSection === 'calendar') {
                renderFamilyPills();
            }
        }
    }

    function renderMeals() {
        const today = new Date();
        const weekMeals = [];
        
        for (let i = 0; i < 7; i++) {
            const date = new Date(today);
            date.setDate(today.getDate() + i);
            const dateStr = date.toISOString().split('T')[0];
            const meal = meals.find(m => m.date === dateStr);
            weekMeals.push({
                day: date.toLocaleDateString('en-US', { weekday: 'short' }),
                date: dateStr,
                meal: (meal && meal.name) || 'No meal planned'
            });
        }

        document.getElementById('mealPlan').innerHTML = weekMeals.map(m => `
            <div class="meal-day">
                <div class="meal-day-name">${m.day}</div>
                <div>${m.meal}</div>
            </div>
        `).join('');
    }

    function showDayEvents(dateStr) {
        const allEvents = getAllEvents();
        const dayEvents = allEvents.filter(e => {
            if (e.date !== dateStr || !e.time || !isEventVisible(e)) return false;
            const minutes = getMinutesFromTime(e.time);
            return minutes >= 7 * 60 && minutes < 21 * 60;
        });
        if (dayEvents.length === 0) {
            alert('No events for this day');
            return;
        }
        const eventList = dayEvents.map(e => 
            `${e.time || 'All day'}: ${e.title}${e.member ? ' (' + e.member + ')' : ''}`
        ).join('\n');
        alert(`Events for ${dateStr}:\n\n${eventList}`);
    }

    // Update current time indicator every minute
    function updateCurrentTimeIndicator() {
        if (currentView !== 'week') return;
        
        const indicator = document.querySelector('.current-time-indicator');
        if (!indicator) return;
        
        const now = new Date();
        const startHour = 7;
        const endHour = 21;
        const currentHour = now.getHours();
        const currentMinutes = now.getMinutes();
        
        if (currentHour >= startHour && currentHour < endHour) {
            const totalMinutesFromStart = (currentHour - startHour) * 60 + currentMinutes;
            const totalMinutesInRange = (endHour - startHour) * 60;
            const topPercent = (totalMinutesFromStart / totalMinutesInRange) * 100;
            
            indicator.style.top = topPercent + '%';
        }
    }
    
    // Update time indicator every minute
    setInterval(updateCurrentTimeIndicator, 60000);

    init();
</script>

<script>
    // Convert all emojis to images using Twemoji
    if (typeof twemoji !== 'undefined') {
        // Parse the entire page on load
        window.addEventListener('load', function() {
            twemoji.parse(document.body, {
                folder: 'svg',
                ext: '.svg'
            });
        });
        
        // Also parse when new content is added dynamically
        // Monitor DOM changes and re-parse
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                mutation.addedNodes.forEach(function(node) {
                    if (node.nodeType === 1) { // Element node
                        twemoji.parse(node, {
                            folder: 'svg',
                            ext: '.svg'
                        });
                    }
                });
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
    }
</script>

<script>
    // Auto-fullscreen when page loads
    function enterFullscreen() {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen().catch(err => {
                console.log('Fullscreen request failed:', err);
            });
        } else if (elem.webkitRequestFullscreen) { // Safari
            elem.webkitRequestFullscreen();
        } else if (elem.mozRequestFullScreen) { // Firefox
            elem.mozRequestFullScreen();
        } else if (elem.msRequestFullscreen) { // IE/Edge
            elem.msRequestFullscreen();
        }
    }
    
    // Try to enter fullscreen after page loads
    window.addEventListener('load', function() {
        setTimeout(enterFullscreen, 500);
    });
    
    // Re-enter fullscreen if user exits
    document.addEventListener('fullscreenchange', function() {
        if (!document.fullscreenElement) {
            setTimeout(enterFullscreen, 1000);
        }
    });
    
    // Also allow manual fullscreen trigger on first touch/click
    let hasInteracted = false;
    document.addEventListener('click', function() {
        if (!hasInteracted) {
            hasInteracted = true;
            enterFullscreen();
        }
    }, { once: true });
```

/*
// Import the functions you need from the SDKs you need
import { initializeApp } from “firebase/app”;
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app’s Firebase configuration
const firebaseConfig = {
apiKey: “AIzaSyAgEyHTkAE_4-Ua8uPHs8uUtRm8C6eDNi4”,
authDomain: “skylight-d1c07.firebaseapp.com”,
projectId: “skylight-d1c07”,
storageBucket: “skylight-d1c07.firebasestorage.app”,
messagingSenderId: “812789085658”,
appId: “1:812789085658:web:e9f3860a26e9e4ff3d3ce3”
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
*/

```
</script>
```

</body>
</html>